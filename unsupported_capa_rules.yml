rule:
  meta:
    name: block operations on executable memory pages using Arbitrary Code Guard
    namespace: anti-analysis/anti-av
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Impair Defenses::Disable or Modify Tools [T1562.001]
    mbc:
      - Defense Evasion::Disable or Evade Security Tools::Modify Policy [F0004.005]
    references:
      - https://blog.xpnsec.com/protecting-your-malware/
      - https://blogs.windows.com/msedgedev/2017/02/23/mitigating-arbitrary-native-code-execution/
    examples:
      - 2ebadd04f0ada89c36c1409b6e96423a68dd77b513db8db3da203c36d3753e5f:0x140002120
    capa/nursery: false
  features:
    - or:
      - and:
        - api: SetProcessMitigationPolicy
        - number: 4 = sizeof(PROCESS_MITIGATION_DYNAMIC_CODE_POLICY)
        - number: 1 = set policy.ProhibitDynamicCode to 1
        - number: 2 = ProcessDynamicCodePolicy
      - and:
        - api: SetProcessMitigationPolicy
        - number: 4 = sizeof(PROCESS_MITIGATION_BINARY_SIGNATURE_POLICY)
        - number: 1 = set policy.MicrosoftSignedOnly to 1
        - or:
          - number: 8 = ProcessSignaturePolicy
          - offset: 4 = lea ecx, [r8+4] ; with r8 equal to 4

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-av/block-operations-on-executable-memory-pages-using-arbitrary-code-guard.yml
----------------------------------------------
rule:
  meta:
    name: overwrite DLL .text section to remove hooks
    namespace: anti-analysis/anti-av
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Impair Defenses::Disable or Modify Tools [T1562.001]
    mbc:
      - Defense Evasion::Disable or Evade Security Tools [F0004]
    references:
      - https://www.ired.team/offensive-security/defense-evasion/how-to-unhook-a-dll-using-c++
    examples:
      - 282c32269a9893c5741ca682268369421c43ac21d73b1f6c23386d61c93bf3e9:0x1400014A4
    capa/nursery: false
  features:
    - and:
      - or:
        - api: GetModuleHandle
        - api: GetModuleHandleEx
      - or:
        - match: read file via mapping
        - match: read file on Windows
      - match: enumerate PE sections
      - string: ".text"
      # The rule was initially created for NTDLL unhooking technique but then made more generic to handle unhooking of any DLL.
      # Revert to `string: ntdll.dll` if it's too broad.
      - substring: ".dll"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-av/overwrite-dll-text-section-to-remove-hooks.yml
----------------------------------------------
rule:
  meta:
    name: protect spawned processes with mitigation policies
    namespace: anti-analysis/anti-av
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Impair Defenses::Disable or Modify Tools [T1562.001]
    mbc:
      - Defense Evasion::Disable or Evade Security Tools::Modify Policy [F0004.005]
    references:
      - https://blog.xpnsec.com/protecting-your-malware/
      - https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/blockdlls_acg_ppid_spoof_bin.nim
    examples:
      - 2ebadd04f0ada89c36c1409b6e96423a68dd77b513db8db3da203c36d3753e5f:0x140002120
    capa/nursery: false
  features:
    - and:
      - api: UpdateProcThreadAttribute
      - number: 0x20007 = PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY
      - or:
        - number: 0x1000000000 = PROCESS_CREATION_MITIGATION_POLICY_PROHIBIT_DYNAMIC_CODE_ALWAYS_ON
        - number: 0x100000000000 = PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON
        - number: 0x300000000000 = PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALLOW_STORE
        - number: 0x101000000000
        - number: 0x301000000000

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-av/protect-spawned-processes-with-mitigation-policies.yml
----------------------------------------------
rule:
  meta:
    name: check for hardware breakpoints
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Hardware Breakpoints [B0001.005]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/HardwareBreakpoints.cpp
    examples:
      - al-khaser_x86.exe_:0x42035D
    capa/nursery: false
  features:
    - and:
      - api: kernel32.GetThreadContext
      - number: 0x10010 = CONTEXT_DEBUG_REGISTERS
      - offset: 0x4 = DR0
      - offset: 0x8 = DR1
      - offset: 0xC = DR2
      - offset: 0x10 = DR3
      - count(mnemonic(cmp)): 4 or more

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-hardware-breakpoints.yml
----------------------------------------------
rule:
  meta:
    name: check for kernel debugger via shared user data structure
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection [B0001]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/SharedUserData_KernelDebugger.cpp
      - http://www.geoffchappell.com/studies/windows/km/ntoskrnl/structs/kuser_shared_data.htm
    examples:
      - al-khaser_x86.exe_:0x430E60
    capa/nursery: false
  features:
    - and:
      - number: 0x7FFE02D4 = UserSharedData->KdDebuggerEnabled
      - instruction:
        - mnemonic: and
        - number: 0x2 = KdDebuggerNotPresent
      - instruction:
        - mnemonic: and
        - number: 0x1 = KdDebuggerEnabled

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-kernel-debugger-via-shared-user-data-structure.yml
----------------------------------------------
rule:
  meta:
    name: check for PEB BeingDebugged flag
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Process Environment Block BeingDebugged [B0001.035]
    references:
      - Practical Malware Analysis, Chapter 16, p. 353
    examples:
      - Practical Malware Analysis Lab 16-01.exe_:0x403530
    capa/nursery: false
  features:
    - and:
      - match: PEB access
      - offset: 2 = PEB.BeingDebugged

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-peb-beingdebugged-flag.yml
----------------------------------------------
rule:
  meta:
    name: check for PEB NtGlobalFlag flag
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Process Environment Block NtGlobalFlag [B0001.036]
    references:
      - Practical Malware Analysis, Chapter 16, p. 355
      - https://www.geoffchappell.com/studies/windows/win32/ntdll/structs/peb/index.htm
    examples:
      - Practical Malware Analysis Lab 16-01.exe_:0x403530
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - match: PEB access
          - or:
            - and:
              - arch: i386
              - offset: 0x68 = PEB.NtGlobalFlag
            - and:
              - arch: amd64
              - offset: 0xBC = PEB.NtGlobalFlag
            - instruction:
              - arch: i386
              - mnemonic: add
              - offset: 0x68 = PEB.NtGlobalFlag
            - instruction:
              - arch: amd64
              - mnemonic: add
              - offset: 0xBC = PEB.NtGlobalFlag
      - number: 0x70 = (FLG_HEAP_ENABLE_TAIL_CHECK | FLG_HEAP_ENABLE_FREE_CHECK | FLG_HEAP_VALIDATE_PARAMETERS)

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-peb-ntglobalflag-flag.yml
----------------------------------------------
rule:
  meta:
    name: check for protected handle exception
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::SetHandleInformation [B0001.024]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/SetHandleInformation_API.cpp
    examples:
      - al-khaser_x86.exe_:0x430D20
    capa/nursery: false
  features:
    - and:
      - or:
        - description: SetHandleInformation(hMutex, HANDLE_FLAG_PROTECT_FROM_CLOSE, HANDLE_FLAG_PROTECT_FROM_CLOSE);
        - basic block:
          - and:
            - count(number(2)): 2 or more
            - api: SetHandleInformation
        - call:
          - and:
            - count(number(2)): 2 or more
            - api: SetHandleInformation
      - api: CloseHandle

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-protected-handle-exception.yml
----------------------------------------------
rule:
  meta:
    name: check for software breakpoints
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Software Breakpoints [B0001.025]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/SoftwareBreakpoints.cpp
      - https://anti-debug.checkpoint.com/techniques/assembly.html
    examples:
      - al-khaser_x86.exe_:0x431020
    capa/nursery: false
  features:
    - and:
      - or:
        - instruction:
          - mnemonic: cmp
          - number: 0xCC = INT3
        - and:
          - description: INT3 (long form)
          - instruction:
            - mnemonic: cmp
            - number: 0xCD = INT3 (long form byte 1)
          - instruction:
            - mnemonic: cmp
            - number: 0x03 = INT3 (long form byte 2)
      - match: contain loop

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-software-breakpoints.yml
----------------------------------------------
rule:
  meta:
    name: check for time delay via GetTickCount
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Timing/Delay Check GetTickCount [B0001.032]
    examples:
      - Practical Malware Analysis Lab 16-03.exe_:0x4013d0
    capa/nursery: false
  features:
    - and:
      - count(api(kernel32.GetTickCount)): 2 or more
      - basic block:
        - and:
          - mnemonic: sub
          - mnemonic: cmp

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-time-delay-via-gettickcount.yml
----------------------------------------------
rule:
  meta:
    name: check for time delay via QueryPerformanceCounter
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Timing/Delay Check QueryPerformanceCounter [B0001.033]
    examples:
      - Practical Malware Analysis Lab 16-03.exe_:0x4011e0
    capa/nursery: false
  features:
    - and:
      - count(api(kernel32.QueryPerformanceCounter)): 2 or more

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-time-delay-via-queryperformancecounter.yml
----------------------------------------------
rule:
  meta:
    name: check for trap flag exception
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection [B0001]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/TrapFlag.cpp
    examples:
      - al-khaser_x86.exe_:0x431680
      - al-khaser_x64.exe_:0x140030CB0
    capa/nursery: false
  features:
    - and:
      - or:
        - description: read/write EFLAGS register
        - and:
          - mnemonic: pushf
          - mnemonic: popf
        - and:
          - mnemonic: pushfd
          - mnemonic: popfd
        - and:
          - mnemonic: pushfq
          - mnemonic: popfq
      - or:
        - description: set trap flag
        - instruction:
          - mnemonic: or
          - number: 0x100
        - instruction:
          - mnemonic: bts
          - number: 0x8

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-trap-flag-exception.yml
----------------------------------------------
rule:
  meta:
    name: check for unexpected memory writes
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Memory Write Watching [B0001.010]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/WriteWatch.cpp
    examples:
      - al-khaser_x86.exe_:0x431EBC
    capa/nursery: false
  features:
    - and:
      - api: kernel32.GetWriteWatch
      - number: 0x0

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-for-unexpected-memory-writes.yml
----------------------------------------------
rule:
  meta:
    name: check process job object
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection [B0001]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/ProcessJob.cpp
    examples:
      - al-khaser_x86.exe_:0x426730
    capa/nursery: false
  features:
    - or:
      # static
      - and:
        - match: contain loop
        - basic block:
          - and:
            - api: kernel32.QueryInformationJobObject
            - number: 0x3 = JobObjectBasicProcessIdList
        - basic block:
          - and:
            - api: kernel32.OpenProcess
            - number: 0x400 = PROCESS_QUERY_INFORMATION
      # dynamic
      - and:
        - call:
          - and:
            - api: kernel32.QueryInformationJobObject
            - number: 0x3 = JobObjectBasicProcessIdList
        - call:
          - and:
            - api: kernel32.OpenProcess
            - number: 0x400 = PROCESS_QUERY_INFORMATION

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-process-job-object.yml
----------------------------------------------
rule:
  meta:
    name: check ProcessDebugPort
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::NtQueryInformationProcess [B0001.012]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtQueryInformationProcess_ProcessDebugPort.cpp
    examples:
      - kernel32.dll_:0x7DD97899
    capa/nursery: false
  features:
    - and:
      - api: NtQueryInformationProcess
      - number: 0x7 = ProcessDebugPort

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/check-processdebugport.yml
----------------------------------------------
rule:
  meta:
    name: execute anti-debugging instructions
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Anti-debugging Instructions [B0001.034]
    examples:
      - Practical Malware Analysis Lab 16-03.exe_:0x401300
    capa/nursery: false
  features:
    - or:
      - count(mnemonic(rdtsc)): 2 or more
      - mnemonic: icebp

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Range" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-detection/execute-anti-debugging-instructions.yml
----------------------------------------------
rule:
  meta:
    name: hide thread from debugger
    namespace: anti-analysis/anti-debugging/debugger-evasion
    authors:
      - michael.hunhoff@mandiant.com
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Defense Evasion::Debugger Evasion [T1622]
    mbc:
      - Anti-Behavioral Analysis::Debugger Evasion [B0002]
    references:
      - https://anti-debug.checkpoint.com/techniques/interactive.html#ntsetinformationthread
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtSetInformationThread_ThreadHideFromDebugger.cpp
      - https://github.com/jaeyung1001/Anti-Debugging/blob/master/Code/NtSetInformationThread.cpp
    examples:
      - 26beba7352a32b803aa19e0782011a383a1df19549910e7b2f2f244e49678524:0x10001670
    capa/nursery: false
  features:
    - and:
      - or:
        - api: NtSetInformationThread
        - api: ZwSetInformationThread
        - basic block:
          - and:
            - or:
              - string: "NtSetInformationThread"
              - string: "ZwSetInformationThread"
            - match: link function at runtime on Windows
      - number: 0x11 = ThreadHideFromDebugger

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-debugging/debugger-evasion/hide-thread-from-debugger.yml
----------------------------------------------
rule:
  meta:
    name: 64-bit execution via heavens gate
    namespace: anti-analysis/anti-disasm
    authors:
      - awillia2@cisco.com
    description: Looks for instructions related to executing 64-bit code from a 32-bit process (Heaven's Gate)
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Defense Evasion::Disable or Evade Security Tools::Heavens Gate [F0004.008]
    references:
      - https://download.bitdefender.com/resources/files/News/CaseStudies/study/318/Bitdefender-TRR-Whitepaper-Maze-creat4351-en-EN-GenericUse.pdf
      - https://www.malwaretech.com/2014/02/the-0x33-segment-selector-heavens-gate.html
    examples:
      - 79abd17391adc6251ecdc58d13d76baf:0x10002385
    capa/nursery: false
  features:
    - and:
      - or:
        - description: set up retf to push 0x33 to CS indicating 64-bit mode
        - instruction:
          - mnemonic: push
          - number: 0x33
        - instruction:
          - mnemonic: mov
          - number: 0x33
      - characteristic: call $+5
        description: call $+5 pushes the current EIP onto the stack, +5 to jump past call insn bytes
      - instruction:
        - mnemonic: add = 'add dword ptr[esp], 5' updates the return address to point after retf
        - number: 0x5 = length of add + retf insn bytes
      - mnemonic: retf = set EIP = [ESP] and CS = [ESP+4]

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-disasm/64-bit-execution-via-heavens-gate.yml
----------------------------------------------
rule:
  meta:
    name: contain anti-disasm techniques
    namespace: anti-analysis/anti-disasm
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: file
      dynamic: file
    mbc:
      - Anti-Static Analysis::Disassembler Evasion [B0012]
    examples:
      - a5c70086b3bc4fe64f4e7a0aa452e620
    capa/nursery: false
  features:
    - or:
      - count(match(contain pusha popa sequence)): 10 or more

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Range" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-disasm/contain-anti-disasm-techniques.yml
----------------------------------------------
rule:
  meta:
    name: crash the Windows event logging service
    namespace: anti-analysis/anti-forensic
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Impair Defenses::Disable Windows Event Logging [T1562.002]
    references:
      - https://github.com/limbenjamin/LogServiceCrash
    examples:
      - 82BF6347ACF15E5D883715DC289D8A2B:0x14005E0C0
    capa/nursery: false
  features:
    - and:
      - count(api(advapi32.ElfClearEventLogFileW)): 3 or more
      - count(api(advapi32.OpenEventLogA)): 1 or more

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-forensic/crash-the-windows-event-logging-service.yml
----------------------------------------------
rule:
  meta:
    name: patch process command line
    namespace: anti-analysis/anti-forensic
    authors:
      - william.ballenthin@mandiant.com
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Process Injection [T1055]
    mbc:
      - Defense Evasion::Process Injection::Patch Process Command Line [E1055.m04]
    references:
      - https://stackoverflow.com/q/24754844/87207
      - https://blog.xpnsec.com/how-to-argue-like-cobalt-strike/
    examples:
      - e353d3fbfb5c3738a77a622adff9a416:0x401626
    capa/nursery: false
  features:
    - or:
      - and:
        - basic block:
          # example:
          #   mov     rbx, gs:60h
          #   lea     r9, [rsp+4A0h+flOldProtect] ; lpflOldProtect
          #   mov     edx, 8          ; dwSize
          #   mov     rcx, [rbx+20h]
          #   add     rcx, 70h ; 'p'  ; lpAddress
          #   lea     r8d, [rdx-4]    ; flNewProtect
          #   call    cs:VirtualProtect
          #   test    eax, eax
          - and:
            - arch: amd64
            - characteristic: gs access
            - offset: 0x60 = PEB
            - offset: 0x20 = PEB->ProcessParameters
            - offset: 0x70 = PEB->ProcessParameters->CommandLine
            - api: VirtualProtect
        - count(api(VirtualProtect)): 2 or more
      - and:
        - characteristic: indirect call
        - api: GetProcAddress
        - string: "NtQueryInformationProcess"
        - api: ReadProcessMemory
        - or:
          - and:
            - arch: i386
            - offset: 0x10 = PEB->ProcessParameters
            - offset: 0x40 = PEB->ProcessParameters->CommandLine
          - and:
            - arch: amd64
            - offset: 0x20 = PEB->ProcessParameters
            - offset: 0x70 = PEB->ProcessParameters->CommandLine

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-forensic/patch-process-command-line.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: spoof parent PID
    namespace: anti-analysis/anti-forensic
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Access Token Manipulation::Parent PID Spoofing [T1134.004]
    references:
      - https://blog.f-secure.com/detecting-parent-pid-spoofing/
    examples:
      - 2ebadd04f0ada89c36c1409b6e96423a68dd77b513db8db3da203c36d3753e5f:0x140002291
    capa/nursery: false
  features:
    - and:
      - api: kernel32.UpdateProcThreadAttribute
      - number: 0x20000 = PROC_THREAD_ATTRIBUTE_PARENT_PROCESS

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-forensic/spoof-parent-pid.yml
----------------------------------------------
rule:
  meta:
    name: clear Windows event logs
    namespace: anti-analysis/anti-forensic/clear-logs
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Indicator Removal::Clear Windows Event Logs [T1070.001]
    examples:
      - 82BF6347ACF15E5D883715DC289D8A2B:0x14005E0C0
      - mimikatz.exe_:0x45228B
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - and:
          - or:
            - api: advapi32.ElfClearEventLogFile
            - api: advapi32.ClearEventLog
            - api: wevtapi.EvtClearLog
          - optional:
            - api: advapi32.OpenEventLog
            - api: advapi32.GetNumberOfEventLogRecords
            - api: wevtapi.EvtOpenLog
            - api: wevtapi.EvtOpenSession
        - basic block:
          - and:
            - string: /wevtutil(\.exe)?\s+(clear-log|cl)/i
        - call:
          - and:
            - string: /wevtutil(\.exe)?\s+(clear-log|cl)/i

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-forensic/clear-logs/clear-windows-event-logs.yml
----------------------------------------------
rule:
  meta:
    name: self delete using alternate data streams
    namespace: anti-analysis/anti-forensic/self-deletion
    authors:
      - daniel.stepanic@elastic.co
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Indicator Removal::File Deletion [T1070.004]
    mbc:
      - Defense Evasion::Self Deletion [F0007]
    references:
      - https://github.com/LloydLabs/delete-self-poc
    examples:
      # encountering sporadic test issues for this sample for unknown reasons
      # - c2d46d256b8f9490c9599eea11ecef19fde7d4fdd2dea93604cee3cea8e172ac:0x1400019C0
      - 388021747b85453adff2680c8a0e13e230f4eeada1a1055e3fb8e09800d4fb79:0x180003A24
    capa/nursery: false
  features:
    - and:
      - count(api(kernel32.SetFileInformationByHandle)): 2
      - or:
        - basic block:
          - and:
            - api: kernel32.SetFileInformationByHandle
            - optional:
              - number: 3 = FileRenameInfo
        - call:
          - and:
            - api: SetFileInformationByHandle
            - number: 3 = FileRenameInfo
      - or:
        - basic block:
          - and:
            - api: kernel32.SetFileInformationByHandle
            - number: 4 = FileDispositionInfo
            - number: 1 = TRUE // fDelete.DeleteFile = TRUE;
        - call:
          - and:
            - api: SetFileInformationByHandle
            - number: 4 = FileDispositionInfo
            - number: 1 = TRUE // fDelete.DeleteFile = TRUE;
      - and:
        - count(api(kernel32.CreateFile)): 2
        - number: 0x10000 = DELETE

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-forensic/self-deletion/self-delete-using-alternate-data-streams.yml
----------------------------------------------
rule:
  meta:
    name: self delete
    namespace: anti-analysis/anti-forensic/self-deletion
    authors:
      - michael.hunhoff@mandiant.com
      - '@mr-tz'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Indicator Removal::File Deletion [T1070.004]
    mbc:
      - Defense Evasion::Self Deletion::COMSPEC Environment Variable [F0007.001]
    examples:
      - Practical Malware Analysis Lab 14-02.exe_:0x401880
    capa/nursery: false
  features:
    - and:
      - or:
        - match: get COMSPEC environment variable
        - string: "cmd.exe"
        - match: host-interaction/process/create
      - or:
        - string: /\/c\s*del\s*/
          description: "/c del"
        - string: /(^|[\&;\|]\s*)del(\s.*)?/i
          description: "echo 1&&del /path/to/file"
      - optional:
        - string: /\s*>\s*nul\s*/i
          description: "> nul"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-forensic/self-deletion/self-delete.yml
----------------------------------------------
rule:
  meta:
    name: check for foreground window switch
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - ervin.ocampo@mandiant.com
    description: Detect usage of GetForegroundWindow and Sleep APIs to check if there is any foreground window switch. Typically, sandboxes do not switch the foreground window like a user would in a normal environment.
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::User Activity Based Checks [T1497.002]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection::Human User Check [B0009.012]
    references:
      - https://www.trendmicro.com/en_us/research/22/k/earth-preta-spear-phishing-governments-worldwide.html
      - https://unprotect.it/technique/getforegroundwindow/
    examples:
      - 2855ba06b90e7c64d9bce888e47baf6d:0x4112A3
    capa/nursery: false
  features:
    - and:
      - count(api(GetForegroundWindow)): 2 or more
      - api: Sleep
      - mnemonic: cmp
      - or:
        - characteristic: loop
        - characteristic: tight loop

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-vm/vm-detection/check-for-foreground-window-switch.yml
----------------------------------------------
rule:
  meta:
    name: check for microsoft office emulation
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Sandbox Detection::Product Key/ID Testing [B0007.005]
    references:
      - https://github.com/LloydLabs/wsb-detect
    examples:
      - 773290480d5445f11d3dc1b800728966:0x140001140
    capa/nursery: false
  features:
    - and:
      - substring: "OfficePackagesForWDAG"
      - api: GetWindowsDirectory
      - optional:
        - match: create or open file

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-vm/vm-detection/check-for-microsoft-office-emulation.yml
----------------------------------------------
rule:
  meta:
    name: check for unmoving mouse cursor
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - BitsOfBinary
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::User Activity Based Checks [T1497.002]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection::Human User Check [B0009.012]
    references:
      - https://www.joesecurity.org/blog/5852460122427342172
    examples:
      - d7ff81ff775d4ab50d31ac1e962c8c4dea7ff9f280aa2b42ddd06760a5665002:0x401118
    capa/nursery: false
  features:
    - and:
      - count(api(user32.GetCursorPos)): 2 or more

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-vm/vm-detection/check-for-unmoving-mouse-cursor.yml
----------------------------------------------
rule:
  meta:
    name: check for Windows sandbox via dns suffix
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]
    references:
      - https://github.com/LloydLabs/wsb-detect
    examples:
      - 773290480d5445f11d3dc1b800728966:0x140001140
    capa/nursery: false
  features:
    - and:
      - api: GetAdaptersAddresses
      - string: "mshome.net"
      - offset: 0x38 = DnsSuffix
      - match: contain loop

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-dns-suffix.yml
----------------------------------------------
rule:
  meta:
    name: check for Windows sandbox via genuine state
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]
    references:
      - https://github.com/LloydLabs/wsb-detect
    examples:
      - 773290480d5445f11d3dc1b800728966:0x140001140
    capa/nursery: false
  features:
    - or:
      - and:
        # static
        - basic block:
          - and:
            - api: SLIsGenuineLocal
        - basic block:
          - and:
            - api: UuidFromString
            - string: "55c92734-d682-4d71-983e-d6ec3f16059f"
      - and:
        # dynamic
        - call:
          - and:
            - api: SLIsGenuineLocal
        - call:
          - and:
            - api: UuidFromString
            - string: "55c92734-d682-4d71-983e-d6ec3f16059f"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-genuine-state.yml
----------------------------------------------
rule:
  meta:
    name: check for Windows sandbox via registry
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]
    references:
      - https://github.com/LloydLabs/wsb-detect
    examples:
      - 773290480d5445f11d3dc1b800728966:0x140001140
    capa/nursery: false
  features:
    - and:
      - api: RegOpenKeyEx
      - api: RegEnumValue
      - substring: "\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
      - string: /wmic useraccount where \"name='WDAGUtilityAccount'\"/i

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-registry.yml
----------------------------------------------
rule:
  meta:
    name: obfuscated with ADVobfuscator
    namespace: anti-analysis/obfuscation
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Anti-Static Analysis::Executable Code Obfuscation [B0032]
    references:
      - https://github.com/andrivet/ADVobfuscator
    examples:
      - c1969efd1e2be79909b880f4dbb8725e52efca82236f8a2165c5a8245393fcd6
    capa/nursery: false
  features:
    - substring: "@ADVobfuscator@andrivet@@"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/obfuscation/obfuscated-with-advobfuscator.yml
----------------------------------------------
rule:
  meta:
    name: contain obfuscated stackstrings
    namespace: anti-analysis/obfuscation/string/stackstring
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]
    mbc:
      - Anti-Static Analysis::Executable Code Obfuscation::Argument Obfuscation [B0032.020]
      - Anti-Static Analysis::Executable Code Obfuscation::Stack Strings [B0032.017]
    examples:
      - Practical Malware Analysis Lab 16-03.exe_:0x4013D0
    capa/nursery: false
  features:
    - characteristic: stack string

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/obfuscation/string/stackstring/contain-obfuscated-stackstrings.yml
----------------------------------------------
rule:
  meta:
    name: packed with Confuser
    namespace: anti-analysis/packer/confuser
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]
    mbc:
      - Anti-Static Analysis::Software Packing::Confuser [F0001.009]
    examples:
      - b9f5bd514485fb06da39beff051b9fdc
    capa/nursery: false
  features:
    - or:
      - class: "ConfusedByAttribute"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "class" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/packer/confuser/packed-with-confuser.yml
----------------------------------------------
rule:
  meta:
    name: packed with generic packer
    namespace: anti-analysis/packer/generic
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]
    mbc:
      - Anti-Static Analysis::Software Packing::Standard Compression [F0001.002]
    examples:
      - Practical Malware Analysis Lab 18-01.exe_:0x409dc0
    capa/nursery: false
  features:
    - and:
      - or:
        - mnemonic: pusha
        - mnemonic: pushad  # vivisect
      - or:
        - mnemonic: popa
        - mnemonic: popad  # vivisect
      - characteristic: cross section flow
      - not:
        - match: contain pusha popa sequence

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/packer/generic/packed-with-generic-packer.yml
----------------------------------------------
rule:
  meta:
    name: packed with nmm-protect
    namespace: anti-analysis/packer/nmm-protect
    authors:
      - william.ballenthin@mandiant.com
    description: nmm-protect is a virtualizing packer, like VMProtect, that protects Android applications
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]
    mbc:
      - Anti-Static Analysis::Software Packing::VMProtect [F0001.010]
    references:
      - https://github.com/maoabc/nmmp#nmm-protect
    examples:
      - e5e8c139772efe47f738f4788ae9b3dc97960b1c006bc6a406715cab69f27cfc
    capa/nursery: false
  features:
    - and:
      - os: android
      - string: "vmInterpret"
      - string: "cacheInitial"
      - string: "getCacheClass"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/packer/nmm-protect/packed-with-nmm-protect.yml
----------------------------------------------
rule:
  meta:
    name: packed with UPX
    namespace: anti-analysis/packer/upx
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]
    mbc:
      - Anti-Static Analysis::Software Packing::UPX [F0001.008]
    examples:
      - CD2CBA9E6313E8DF2C1273593E649682
      - Practical Malware Analysis Lab 01-02.exe_:0x0401000
    capa/nursery: false
  features:
    - or:
      - and:
        - format: pe
        - or:
          - section: UPX0
          - section: UPX1
      - and:
        - format: elf
        - or:
          - string: "UPX!"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/anti-analysis/packer/upx/packed-with-upx.yml
----------------------------------------------
rule:
  meta:
    name: get Steam token
    namespace: collection
    authors:
      - still@teamt5.org
    description: locates references to Steam authentication token via the beginning of a Steam bearer token
    scopes:
      static: function
      dynamic: unsupported
    examples:
      - 2c83f152e09d0abaa3a3784669e75276784e50e1e202d16ab27e5741eef9ab4f:0x0041718C
    capa/nursery: false
  features:
    - or:
      - substring: "65 79 41 69 64 48 6C 77 49 6A 6F 67 49 6B 70 58 56 43 49 73 49 43 4A"
      - substring: "eyAidHlwIjogIkpXVCIsICJ"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/get-steam-token.yml
----------------------------------------------
rule:
  meta:
    name: gather firefox profile information
    namespace: collection/browser
    authors:
      - '@_re_fox'
      - still@teamt5.org
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores::Credentials from Web Browsers [T1555.003]
    examples:
      - 7204e3efc2434012e13ca939db0d0b02:0x4073c0
      - 54390bda109aab7fc006b8b4ead5b6c2:0x1006e58b
    capa/nursery: false
  features:
    - and:
      - 2 or more:
        - string: /\\Mozilla\\Firefox\\profiles(\.ini)?/i
        - string: /\\(signons|cookies)\.sqlite/i
        - string: /SELECT\s+[a-z,\s]{5,}FROM moz_(logins|cookies)/i
        - string: /FROM moz_(logins|cookies)/i
        - substring: "WHERE moz_cookies.host LIKE"
      - optional:
        - or:
          - string: "encryptedUsername"
          - string: "encryptedPassword"
          - string: "usernameField"
          - string: "formSubmitURL"
          - string: "httpRealm"
          - string: "passwordField"
          - string: "timeCreated"
          - string: "timeLastUsed"
          - string: "timePasswordChanged"
          - string: "timesUsed"

Reason: Some aka x or more (TODO) (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/browser/gather-firefox-profile-information.yml
----------------------------------------------
rule:
  meta:
    name: get Chrome CookieMonster
    namespace: collection/browser
    authors:
      - still@teamt5.org
    description: finds sections related to Chrome's CookieMonster component, typically used in conjunction with code that dumps cookies from Chromium-based browsers
    scopes:
      static: file
      dynamic: process
    att&ck:
      - Credential Access::Credentials from Password Stores::Credentials from Web Browsers [T1555.003]
    references:
      - https://github.com/Meckazin/ChromeKatz/blob/main/CookieKatz-BOF/CookieKatzBOF.cpp
    examples:
      - 79f5cabff898d60cd614e7254d409d9c2e05184416e5c54201e2dc216998d28b:0x117D
    capa/nursery: false
  features:
    - and:
      - substring: "network.mojom.NetworkService" # process with CookieMonster
      - or:
        - substring: "chrome.dll"
        - substring: "chrome.exe"
        - substring: "msedge.exe"
        - substring: "msedgewebview2.exe"
        - substring: "msedge.dll"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/browser/get-chrome-cookiemonster.yml
----------------------------------------------
rule:
  meta:
    name: get elevation service for Chromium-based browsers
    namespace: collection/browser
    authors:
      - still@teamt5.org
    description: finds strings/identifiers related to Chrome Elevation Service, typically used in conjunction with retrieving App-bound Encryption related key
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Credential Access::Exploitation for Credential Access [T1212]
      - Credential Access::Credentials from Password Stores::Credentials from Web Browsers [T1555.003]
    references:
      - https://gist.github.com/snovvcrash/caded55a318bbefcb6cc9ee30e82f824
      - https://chromium.googlesource.com/chromium/src/+/HEAD/chrome/install_static/install_util_unittest.cc
    examples:
      - fb690a23b66d4f90dac83f1b4d6dec0074aff68d6ef62c2613120bd4d17cfbdd:0x14006E8C0
    capa/nursery: false
  features:
    - and:
      - optional:
        - string: "APPB"
          description: prefix for App-bound Encryption encrypted credentials
      - or:
        - 2 or more:
          - bytes: CF BE 3A 46 0D 41 7F 40 8A F5 0D F3 5A 00 5C C8 = IID for Google Chrome
          - bytes: E0 60 88 70 41 F6 11 46 88 95 7D 86 7D D3 67 5B = CLSID for Google Chrome
          - substring: "{708860E0-F641-4611-8895-7D867DD3675B}"
            description: CLSID for Google Chrome
        - 2 or more:
          - bytes: 66 1D 72 A2 6E 37 2F 4D 9F 0F 90 70 E9 A4 2B 5F = IID for Google Chrome Beta
          - bytes: BA 46 26 DD 07 37 F8 4B B9 A7 03 86 91 A6 8F C2 = CLSID for Google Chrome Beta
          - substring: "{DD2646BA-3707-4BF8-B9A7-038691A68FC2}"
            description: CLSID for Google Chrome Beta
        - 2 or more:
          - bytes: 6B A2 2A BB 3A 34 72 40 8B 6F 80 55 7B 8C E5 71 = IID for Google Chrome Dev
          - bytes: A5 DC 7F DA AA 2C 37 46 AA 17 07 40 58 4D E7 DA = CLSID for Google Chrome Dev
          - substring: "{DA7FDCA5-2CAA-4637-AA17-0740584DE7DA}"
            description: CLSID for Google Chrome Dev
        - 2 or more:
          - bytes: 41 E0 7C 4F E9 28 4F 48 9D D0 61 A8 CA CE FE E4 = IID for Google Chrome Canary
          - bytes: 72 28 4C 70 49 20 5E 43 A4 69 0A 53 43 13 C4 2B = CLSID for Google Chrome Canary
          - substring: "{704C2872-2049-435E-A469-0A534313C42B}"
            description: CLSID for Google Chrome Canary
        - 2 or more:
          # untested
          - bytes: 07 B8 C2 C9 31 77 34 4F 81 B7 44 FF 77 79 52 2B = IID for Microsoft Edge
          - bytes: 6C E9 CB 1F 97 16 AF 43 91 40 28 97 C7 C6 97 67 = CLSID for Microsoft Edge
          - substring: "{1FCBE96C-1697-43AF-9140-2897C7C69767}"
            description: CLSID for Microsoft Edge

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Some" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/browser/get-elevation-service-for-chromium-based-browsers.yml
----------------------------------------------
rule:
  meta:
    name: parse credit card information
    namespace: collection/credit-card
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Check String [C0019]
    examples:
      - 1d8fd13c890060464019c0f07b928b1a:0x402860
    capa/nursery: false
  features:
    - and:
      - 3 or more:
        - instruction:
          - mnemonic: cmp
          - number: 0x5E = '^' (Track 1 separator)
        - instruction:
          - mnemonic: cmp
          - number: 0x3D = '=' (Track 2 separator)
        - instruction:
          - mnemonic: cmp
          - number: 0x25 = '%' (Track 1 start sentinel)
        - instruction:
          - mnemonic: cmp
          - number: 0x42 = 'B' (Format code)
        - instruction:
          - mnemonic: cmp
          - number: 0x44 = 'D' (Format code)
        - instruction:
          - mnemonic: cmp
          - number: 0x3F = '?' (Track 1 & 2 end sentinel)
        - instruction:
          - mnemonic: cmp
          - number: 0x3B = ';' (Track 2 start sentinel)
      - not:
        - description: if a function also compares these non-hex characters it's most likely NOT parsing CC data
        - and:
          - instruction:
            - mnemonic: cmp
            - number: 0x6D = 'm'
          - instruction:
            - mnemonic: cmp
            - number: 0x6E = 'n'
          - instruction:
            - mnemonic: cmp
            - number: 0x6F = 'o'
          - instruction:
            - mnemonic: cmp
            - number: 0x70 = 'p'

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/credit-card/parse-credit-card-information.yml
----------------------------------------------
rule:
  meta:
    name: gather alftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://en.wikipedia.org/wiki/ALFTP
      - https://www.altools.co.kr/Main/Default.aspx
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40A257
    capa/nursery: false
  features:
    - and:
      - string: "ESTdb2.dat"
      - string: "QData.dat"
      - substring: "\\Estsoft\\ALFTP"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-alftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather bitkinex information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - http://www.bitkinex.com/ftp/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x406D14
    capa/nursery: false
  features:
    - and:
      - substring: "bitkinex.ds"
      - substring: "\\BitKinex"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-bitkinex-information.yml
----------------------------------------------
rule:
  meta:
    name: gather blazeftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.slimjet.com/blazeftp/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40C823
    capa/nursery: false
  features:
    - and:
      - string: "BlazeFtp"
      - string: "site.dat"
      - or:
        - string: "LastPassword"
        - string: "LastAddress"
        - string: "LastUser"
        - string: "LastPort"
        - substring: "Software\\FlashPeak\\BlazeFtp\\Settings"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-blazeftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather classicftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.nchsoftware.com/classic/index.html
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40735E
    capa/nursery: false
  features:
    - or:
      - substring: "Software\\NCH Software\\ClassicFTP\\FTPAccounts"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-classicftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather cuteftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://en.wikipedia.org/wiki/CuteFTP
      - https://www.globalscape.com/cuteftp
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40531A
    capa/nursery: false
  features:
    - and:
      - substring: "\\sm.dat"
      - or:
        - string: /\\GlobalSCAPE\\CuteFTP/i
        - string: /\\GlobalSCAPE\\CuteFTP Pro/i
        - substring: "\\CuteFTP"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-cuteftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather cyberduck information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://cyberduck.io/ftp/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40D965
    capa/nursery: false
  features:
    - and:
      - substring: "\\Cyberduck"
      - or:
        - string: "user.config"
        - string: ".duck"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-cyberduck-information.yml
----------------------------------------------
rule:
  meta:
    name: gather directory-opus information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.gpsoft.com.au/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x4076F3
    capa/nursery: false
  features:
    - and:
      - substring: "\\GPSoftware\\Directory Opus"
      - string: ".oxc"
      - string: ".oll"
      - string: "ftplast.osd"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-directory-opus-information.yml
----------------------------------------------
rule:
  meta:
    name: gather expandrive information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.expandrive.com/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x407086
    capa/nursery: false
  features:
    - and:
      - or:
        - substring: "Software\\ExpanDrive\\Sessions"
        - substring: "Software\\ExpanDrive"
      - or:
        - substring: "ExpanDrive_Home"
        - substring: "\\drives.js"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-expandrive-information.yml
----------------------------------------------
rule:
  meta:
    name: gather faststone-browser information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.faststone.org/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40E04F
    capa/nursery: false
  features:
    - and:
      - substring: "FastStone Browser"
      - string: "FTPList.db"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-faststone-browser-information.yml
----------------------------------------------
rule:
  meta:
    name: gather filezilla information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://filezilla-project.org/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x4057A7
    capa/nursery: false
  features:
    - or:
      - and:
        - substring: "\\sitemanager.xml"
        - substring: "\\recentservers.xml"
        - substring: "\\filezilla.xml"
      - and:
        - substring: "Software\\FileZilla"
        - string: "Install_Dir"
        - substring: "Software\\FileZilla Client"
      - 3 or more:
        - string: "Server Type"
        - string: "Remote Dir"
        - string: "Server.Port"
        - string: "Server.Host"
        - string: "Server.User"
        - string: "Last Server Type"
        - string: "Last Server Port"
        - string: "Last Server User"
        - string: "Last Server Host"
        - string: "Last Server Pass"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Some" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-filezilla-information.yml
----------------------------------------------
rule:
  meta:
    name: gather flashfxp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.flashfxp.com/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x4055ED
    capa/nursery: false
  features:
    - or:
      - and:
        - substring: "Software\\FlashFXP"
        - substring: "DataFolder"
        - substring: "Install Path"
      - and:
        - substring: "\\Sites.dat"
        - substring: "\\Quick.dat"
        - substring: "\\History.dat"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-flashfxp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather frigate3 information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - http://www.frigate3.com/index.php
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x4069A0
    capa/nursery: false
  features:
    - and:
      - substring: "FtpSite.xml"
      - substring: "\\Frigate3"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-frigate3-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ftp-commander information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.ftpcommander.com/free.htm
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x405BC0
    capa/nursery: false
  features:
    - and:
      - or:
        - substring: "FTP Navigator"
        - substring: "FTP Commander"
      - or:
        - string: "ftplist.txt"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ftp-commander-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ftp-voyager information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.serv-u.com/free-tools/ftp-voyager-ftp-client-for-windows
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x408FD3
    capa/nursery: false
  features:
    - and:
      - substring: "\\RhinoSoft.com"
      - string: "FTPVoyager.ftp"
      - string: "FTPVoyager.qc"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ftp-voyager-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ftpgetter information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.ftpgetter.com/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40A21C
    capa/nursery: false
  features:
    - and:
      - string: "servers.xml"
      - substring: "\\FTPGetter"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ftpgetter-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ftpinfo information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.ftpinfo.ru/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40DF62
    capa/nursery: false
  features:
    - and:
      - string: "ServerList.xml"
      - string: "DataDir"
      - or:
        - substring: "Software\\MAS-Soft\\FTPInfo\\Setup"
        - substring: "FTPInfo"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ftpinfo-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ftprush information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.wftpserver.com/ftprush.htm
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x406AE0
    capa/nursery: false
  features:
    - and:
      - substring: "\\FTPRush"
      - substring: "RushSite.xml"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ftprush-information.yml
----------------------------------------------
rule:
  meta:
    name: gather global-downloader information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - http://www.actysoft.com/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40C732
    capa/nursery: false
  features:
    - and:
      - substring: "\\Global Downloader"
      - string: "SM.arch"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-global-downloader-information.yml
----------------------------------------------
rule:
  meta:
    name: gather netdrive information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.netdrive.net/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x407ED1
    capa/nursery: false
  features:
    - and:
      - string: "NDSites.ini"
      - substring: "\\NetDrive"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-netdrive-information.yml
----------------------------------------------
rule:
  meta:
    name: gather nova-ftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40E5FF
    capa/nursery: false
  features:
    - or:
      - and:
        - string: "NovaFTP.db"
        - substring: "\\INSoftware\\NovaFTP"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-nova-ftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather securefx information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.vandyke.com/products/securefx/index.html
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x4069DB
    capa/nursery: false
  features:
    - and:
      - substring: "\\Sessions"
      - string: ".ini"
      - substring: "Config Path"
      - or:
        - substring: "_VanDyke\\Config\\Sessions"
        - substring: "Software\\VanDyke\\SecureFX"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-securefx-information.yml
----------------------------------------------
rule:
  meta:
    name: gather smart-ftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.smartftp.com/en-us/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x405DE8
    capa/nursery: false
  features:
    - or:
      - and:
        - substring: "\\SmartFTP"
        - string: ".xml"
        - string: /Favorites\.dat/i
        - string: /History\.dat/i

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-smart-ftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather softx-ftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - http://www.softx.org/ftp.html
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x407685
    capa/nursery: false
  features:
    - or:
      - substring: "Software\\FTPClient\\Sites"
      - substring: "Software\\SoftX.org\\FTPClient\\Sites"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-softx-ftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather total-commander information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.ghisler.com/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x404B1E
    capa/nursery: false
  features:
    - and:
      - or:
        - substring: "Software\\Ghisler\\Total Commander"
        - substring: "Software\\Ghisler\\Windows Commander"
      - or:
        - string: "FtpIniName"
        - string: "wcx_ftp.ini"
        - string: "InstallDir"
        - substring: "\\GHISLER"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-total-commander-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ultrafxp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x406A5C
    capa/nursery: false
  features:
    - and:
      - substring: "UltraFXP"
      - substring: "\\sites.xml"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ultrafxp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather ws-ftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.ipswitch.com/ftp-server
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40504B
    capa/nursery: false
  features:
    - and:
      - substring: "\\Ipswitch\\WS_FTP"
      - substring: "\\win.ini"
      - substring: "WS_FTP"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-ws-ftp-information.yml
----------------------------------------------
rule:
  meta:
    name: gather xftp information
    namespace: collection/file-managers
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Credentials from Password Stores [T1555]
    references:
      - https://www.netsarang.com/en/xftp-download/
    examples:
      - 5a2f620f29ca2f44fc22df67b674198f:0x40CBEE
    capa/nursery: false
  features:
    - and:
      - string: ".xfp"
      - substring: "\\NetSarang"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/file-managers/gather-xftp-information.yml
----------------------------------------------
rule:
  meta:
    name: discover Group Policy via gpresult
    namespace: collection/group-policy
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::Group Policy Discovery [T1615]
    examples:
      - 9e4d06759f278255073f9ac7b31a115a:0x100068B7
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - substring: "gpresult"
        - substring: "GPRESULT"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/group-policy/discover-group-policy-via-gpresult.yml
----------------------------------------------
rule:
  meta:
    name: log keystrokes via application hook
    namespace: collection/keylog
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Collection::Input Capture::Keylogging [T1056.001]
    mbc:
      - Collection::Keylogging::Application Hook [F0002.001]
    examples:
      - Practical Malware Analysis Lab 12-03.exe_:0x401000
    capa/nursery: false
  features:
    - and:
      - match: set application hook
      - or:
        - number: 13 = WH_KEYBOARD_LL
        - number: 2  = WH_KEYBOARD

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/keylog/log-keystrokes-via-application-hook.yml
----------------------------------------------
rule:
  meta:
    name: capture packets using SharpPcap
    namespace: collection/network
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::Network Sniffing [T1040]
    references:
      - https://github.com/dotpcap/sharppcap
    examples:
      - aefae71bca4bbaa2c013ddf040d797628c8d3da7346108c12735239a86fdfa71:0x6000038
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - api: SharpPcap.LibPcap.PcapDevice::add_OnPacketArrival

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/network/capture-packets-using-sharppcap.yml
----------------------------------------------
rule:
  meta:
    name: capture public ip
    namespace: collection/network
    authors:
      - '@_re_fox'
      - still@teamt5.org
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Network Configuration Discovery [T1016]
    examples:
      - 84f1b049fa8962b215a77f51af6714b3:0x100061e5
    capa/nursery: false
  features:
    - and:
      - api: InternetOpen
      - api: InternetOpenUrl
      - api: InternetReadFile
      - or:
        - substring: "bot.whatismyipaddress.com"
        - substring: "ipinfo.io/ip"
        - substring: "checkip.dyndns.org"
        - substring: "ifconfig.me"
        - substring: "ipecho.net/plain"
        - substring: "api.ipify.org"
        - substring: "checkip.amazonaws.com"
        - substring: "icanhazip.com"
        - substring: "wtfismyip.com/text"
        - substring: "api.myip.com"
        - substring: "ip-api.com/line"
        - substring: "ip.tool.chinaz.com"
        - substring: "1234i.com"
        - substring: "ip138.com"
        - substring: "myip.com.tw"
        - substring: "taobao.com/help/getip.php"
        - substring: "chaipip.com"
        - substring: "sojson.com/ip"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/network/capture-public-ip.yml
----------------------------------------------
rule:
  meta:
    name: get MAC address on Windows
    namespace: collection/network
    authors:
      - moritz.raabe@mandiant.com
      - michael.hunhoff@mandiant.com
      - echernofsky@google.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/Shared/Utils.cpp#L128
      - https://evasions.checkpoint.com/techniques/network.html#check-if-mac-address-is-specific
    examples:
      - al-khaser_x64.exe_:0x14001A1BC
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - and:
          - api: iphlpapi.GetAdaptersInfo
          - or:
            - offset: 0x194 = IP_ADAPTER_INFO.Address
            - offset: 0x195 = IP_ADAPTER_INFO.Address+1
            - offset: 0x196 = IP_ADAPTER_INFO.Address+2
            - offset: 0x197 = IP_ADAPTER_INFO.Address+3
            - offset: 0x198 = IP_ADAPTER_INFO.Address+4
            - offset: 0x199 = IP_ADAPTER_INFO.Address+5
          - optional:
            - string: "%02X-%02X-%02X-%02X-%02X-%02X"
        - and:
          - api: iphlpapi.GetAdaptersAddresses
          - offset: 0x2C = PhysicalAddress

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/network/get-mac-address-on-windows.yml
----------------------------------------------
rule:
  meta:
    name: steal KeePass passwords using KeeFarce
    namespace: collection/password-manager
    authors:
      - '@Ana06'
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Credential Access::Credentials from Password Stores::Password Managers [T1555.005]
    references:
      - https://github.com/denandz/KeeFarce
      - https://keepass.info/help/kb/sec_issues.html
    examples:
      - 1e609dffd12a59ea5d5c9b3055939b1f
    capa/nursery: false
  features:
    - and:
      - match: inject dll
      - string: /KeePass/i
      - optional:
        - substring: "Bootstrap"
        - substring: "KeeFarce"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/password-manager/steal-keepass-passwords-using-keefarce.yml
----------------------------------------------
rule:
  meta:
    name: capture screenshot via keybd event
    namespace: collection/screenshot
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Collection::Screen Capture [T1113]
    mbc:
      - Collection::Screen Capture [E1113]
    examples:
      - 3f3bbcf8fd90bdcdcdc5494314ed4225:0x402D10
    capa/nursery: false
  features:
    - and:
      - or:
        # static
        - basic block:
          - and:
            - number: 0x2C = VK_SNAPSHOT
            - count(api(user32.keybd_event)): 2
            - or:
              - number: 0x3 = KEYEVENTF_KEYUP|KEYEVENTF_EXTENDEDKEY
              - number: 0x2 = KEYEVENTF_KEYUP
        # dynamic
        - call:
          - and:
            - number: 0x2C = VK_SNAPSHOT
            - count(api(user32.keybd_event)): 2
            - or:
              - number: 0x3 = KEYEVENTF_KEYUP|KEYEVENTF_EXTENDEDKEY
              - number: 0x2 = KEYEVENTF_KEYUP
      - match: read clipboard data
      - match: open clipboard

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/screenshot/capture-screenshot-via-keybd-event.yml
----------------------------------------------
rule:
  meta:
    name: capture webcam image
    namespace: collection/webcam
    authors:
      - johnk3r
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Collection::Video Capture [T1125]
    examples:
      - a30101595f6f28ab2f4b0b2cd177c3c4d2ab34a355ab7761a3795d0887c24ada:0x4011C0
    capa/nursery: false
  features:
    - or:
      # static
      - and:
        - api: capCreateCaptureWindow
        - basic block:
          - and:
            - api: SendMessage
            - number: 0x40a = WM_CAP_DRIVER_CONNECT
        - optional:
          - basic block:
            - and:
              - api: SendMessage
              - number: 0x40B = WM_CAP_DRIVER_DISCONNECT
      - basic block:
        - and:
          - api: SendMessage
          - number: 0x419 = WM_CAP_FILE_SAVEDIB
      # dynamic
      - and:
        - api: capCreateCaptureWindow
        - call:
          - and:
            - api: SendMessage
            - number: 0x40a = WM_CAP_DRIVER_CONNECT
        - optional:
          - call:
            - and:
              - api: SendMessage
              - number: 0x40B = WM_CAP_DRIVER_DISCONNECT
      - call:
        - and:
          - api: SendMessage
          - number: 0x419 = WM_CAP_FILE_SAVEDIB

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/collection/webcam/capture-webcam-image.yml
----------------------------------------------
rule:
  meta:
    name: send data
    namespace: communication
    authors:
      - william.ballenthin@mandiant.com
      - joakim@intezer.com
    description: all known techniques for sending data to a potential C2 server
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Command and Control::C2 Communication::Send Data [B0030.001]
    examples:
      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60
    capa/nursery: false
  features:
    - or:
      - and:
        - os: windows
        - or:
          - match: send HTTP request
          - match: send data on socket
          - match: send file via HTTP
          - match: send data to Internet
      - and:
        - os: linux
        - or: # Require network bound socket.
          - match: create TCP socket
          - match: create UDP socket
        - or:
          - match: send HTTP request
          - match: send data on socket
          - match: send file via HTTP

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/send-data.yml
----------------------------------------------
rule:
  meta:
    name: download and write a file
    namespace: communication/c2/file-transfer
    maec/malware-category: downloader
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Command and Control::Ingress Tool Transfer [T1105]
    mbc:
      - Command and Control::C2 Communication::Server to Client File Transfer [B0030.003]
    examples:
      - 5D7C34B6854D48D3DA4F96B71550A221:0x401346
    capa/nursery: false
  features:
    - and:
      - match: receive data
      - match: host-interaction/file-system/write

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/c2/file-transfer/download-and-write-a-file.yml
----------------------------------------------
rule:
  meta:
    name: upload file to OneDrive
    namespace: communication/c2/file-transfer
    authors:
      - jaredswilson@google.com
      - ervinocampo@google.com
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Exfiltration::Exfiltration Over Web Service::Exfiltration to Cloud Storage [T1567.002]
    references:
      - https://cloud.google.com/blog/topics/threat-intelligence/apt41-arisen-from-dust
      - https://learn.microsoft.com/en-us/onedrive/developer/rest-api/concepts/upload?view=odsp-graph-online
    examples:
      - c40db0438a906eb0bec55093f1a0f2cc4cdc38104af0b4b4b3f18200a635c443
    capa/nursery: false
  features:
    - and:
      - substring: "graph.microsoft.com"
      - or:
        - substring: "/createUploadSession"
        - substring: "/content"
        - or:
          - substring: "/:children"
          - substring: "/children"
      - or:
        - substring: "/drive/items/"
        - substring: "/drive/root"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/c2/file-transfer/upload-file-to-onedrive.yml
----------------------------------------------
rule:
  meta:
    name: write and execute a file
    namespace: communication/c2/file-transfer
    maec/malware-category: launcher
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Execution::Install Additional Program [B0023]
    examples:
      - 9324D1A8AE37A36AE560C37448C9705A:0x403A40
      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC
    capa/nursery: false
  features:
    - and:
      - match: host-interaction/file-system/write
      - match: host-interaction/process/create

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/c2/file-transfer/write-and-execute-a-file.yml
----------------------------------------------
rule:
  meta:
    name: create reverse shell on Linux
    namespace: communication/c2/shell
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Execution::Command and Scripting Interpreter::Unix Shell [T1059.004]
    mbc:
      - Impact::Remote Access::Reverse Shell [B0022.001]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x40231E
    capa/nursery: false
  features:
    - and:
      - os: linux
      - match: duplicate stdin and stdout
      - match: host-interaction/process/create

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/c2/shell/create-reverse-shell-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: execute shell command and capture output
    namespace: communication/c2/shell
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Execution::Command and Scripting Interpreter::Windows Command Shell [T1059.003]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa
    examples:
      - Practical Malware Analysis Lab 14-02.exe_:0x4011C0
    capa/nursery: false
  features:
    - and:
      - match: create a process with modified I/O handles and window
      - match: create pipe
      - or:
        - match: get COMSPEC environment variable
        - string: "\\cmd.exe"
        - string: "cmd.exe"
        - string: "cmd.exe /c "
        - string: "C:\\Windows\\system32\\cmd.exe"
      - optional:
        - api: kernel32.GetSystemDirectory
        - api: kernel32.SetCurrentDirectory
        - match: create thread
        - match: read pipe

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/c2/shell/execute-shell-command-and-capture-output.yml
----------------------------------------------
rule:
  meta:
    name: execute shell command received from socket on Linux
    namespace: communication/c2/shell
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Execution::Command and Scripting Interpreter::Unix Shell [T1059.004]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x406549
    capa/nursery: false
  features:
    - and:
      - os: linux
      - match: receive data on socket
      - api: system

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/c2/shell/execute-shell-command-received-from-socket-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: check HTTP status code
    namespace: communication/http/client
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Communication::HTTP Communication::Read Header [C0002.014]
    examples:
      - 54ac78733552a62d1d05ea4ba3fc604bb49fe000d7fc948da45335b726e64d75:0x10001a20
      - Practical Malware Analysis Lab 03-02.dll_:0x10004452
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - number: 0x20000013 = HTTP_QUERY_FLAG_NUMBER | HTTP_QUERY_STATUS_CODE
        - number: 0x13 = HTTP_QUERY_STATUS_CODE
      - optional:
        - api: atoi
        - api: wininet.HttpQueryInfo
      - instruction:
        - and:
          - or:
            - mnemonic: cmp
            - mnemonic: test
          - or:
            - number: 200 = OK
            - number: 400 = Bad Request
            - number: 401 = Unauthorized
            - number: 403 = Forbidden
            - number: 404 = Not Found

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/client/check-http-status-code.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: create BITS job
    namespace: communication/http/client
    authors:
      - '@mr-tz'
    description: BITS jobs can be used to download data or achieve persistence (via SetNotifyCmdLine)
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::BITS Jobs [T1197]
      - Persistence::BITS Jobs [T1197]
    references:
      - https://www.mandiant.com/resources/attacker-use-of-windows-background-intelligent-transfer-service
    examples:
      - 08ac667c65d36d6542917655571e61c8.exe_:0x401E78
    capa/nursery: false
  features:
    - and:
      - and:
        - bytes: 0D 4C E3 5C C9 0D 1F 4C 89 7C DA A1 B7 8C EE 7C = IBackgroundCopyManager
        - bytes: 4B D3 91 49 A1 80 91 42 83 B6 33 28 36 6B 90 97 = BITS_ControlClass
        - offset: 0xC = IBackgroundCopyManagerVtbl.CreateJob
        - offset: 0x10 = IBackgroundCopyJobVtbl.AddFile
      - optional:
        - description: SetNotifyCmdLine may be use to persist
        - bytes: 39 07 B5 54 6F 68 EB 45 9D FF D6 A9 A0 FA A9 AF = IBackgroundCopyJob2
        - offset: 0x8C = IBackgroundCopyJob2Vtbl.SetNotifyCmdLine

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/client/create-bits-job.yml
----------------------------------------------
rule:
  meta:
    name: decompress HTTP response via IEncodingFilterFactory
    namespace: communication/http/client
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Communication::HTTP Communication::Get Response [C0002.017]
    examples:
      - FBBAAF569B63F6398503E4F1979CABEF:0x4067F0
    capa/nursery: false
  features:
    - and:
      - match: get HTTP response content encoding
      - match: decompress data via IEncodingFilterFactory

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/client/decompress-http-response-via-iencodingfilterfactory.yml
----------------------------------------------
rule:
  meta:
    name: extract HTTP body
    namespace: communication/http/client
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Communication::HTTP Communication::Extract Body [C0002.011]
    references:
      - https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa752574(v=vs.85)
    examples:
      - 395EB0DDD99D2C9E37B6D0B73485EE9C:0x4020A9
    capa/nursery: false
  features:
    - and:
      - bytes: 25 44 2C 33 CB 26 D0 11 B4 83 00 C0 4F D9 01 19 = CLSID_IHTMLDocument2
      - offset: 0x24 = IHTMLDocument2Vtbl.get_body
      - offset: 0xF0 = IHTMLElementVtbl.get_innerText

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/client/extract-http-body.yml
----------------------------------------------
rule:
  meta:
    name: get HTTP document via IWebBrowser2
    namespace: communication/http/client
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Communication::HTTP Communication::Get Response [C0002.017]
      - Communication::HTTP Communication::IWebBrowser [C0002.010]
    references:
      - https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa752127(v%3Dvs.85)
    examples:
      - 395EB0DDD99D2C9E37B6D0B73485EE9C:0x402000
    capa/nursery: false
  features:
    - and:
      - api: oleaut32.SysAllocString
      - api: oleaut32.VariantInit
      - offset: 0x2C = pBrowser2->Navigate
      - offset: 0x48 = pBrowser2->get_Document
      - offset: 0x80 = pBrowser2->Quit
      - count(characteristic(indirect call)): 3 or more

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/client/get-http-document-via-iwebbrowser2.yml
----------------------------------------------
rule:
  meta:
    name: get HTTP response content encoding
    namespace: communication/http/client
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Communication::HTTP Communication::Get Response [C0002.017]
    examples:
      - FBBAAF569B63F6398503E4F1979CABEF:0x4068D9
    capa/nursery: false
  features:
    - and:
      - api: wininet.HttpQueryInfo
      - number: 0x1D = HTTP_QUERY_CONTENT_ENCODING

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/client/get-http-response-content-encoding.yml
----------------------------------------------
rule:
  meta:
    name: receive HTTP request
    namespace: communication/http/server
    authors:
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Communication::HTTP Communication::Receive Request [C0002.015]
    examples:
      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10001D30
      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x100027D0
    capa/nursery: false
  features:
    - or:
      - and:
        - api: httpapi.HttpReceiveHttpRequest
        - or:
          - number: 0
          - number: 1 = HTTP_RECEIVE_REQUEST_FLAG_COPY_BODY
          - number: 2 = HTTP_RECEIVE_REQUEST_FLAG_FLUSH_BODY
      - and:
        - api: httpapi.HttpReceiveRequestEntityBody
        - or:
          - number: 0 = Must be zero on Windows Server 2003 with SP1 and Windows XP with SP2
          - number: 1 = HTTP_RECEIVE_REQUEST_ENTITY_BODY_FLAG_FILL_BUFFER

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/http/server/receive-http-request.yml
----------------------------------------------
rule:
  meta:
    name: create two anonymous pipes
    namespace: communication/named-pipe/create
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Communication::Interprocess Communication::Create Pipe [C0003.001]
    examples:
      - Practical Malware Analysis Lab 14-02.exe_:0x4011C0
    capa/nursery: false
  features:
    - and:
      - count(api(CreatePipe)): 2

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/named-pipe/create/create-two-anonymous-pipes.yml
----------------------------------------------
rule:
  meta:
    name: attach BPF to socket on Linux
    namespace: communication/socket
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Persistence::Traffic Signaling::Socket Filters [T1205.002]
    mbc:
      - Communication::Socket Communication::Set Socket Config [C0001.001]
    references:
      - https://www.kernel.org/doc/Documentation/networking/filter.txt
    examples:
      - 34dbc85ed0386e024c724c7969e8d0ff0ff0b1882508ea259c458d59657a1971
    capa/nursery: false
  features:
    - and:
      - os: linux
      - api: setsockopt
      - number: 1 = SOL_SOCKET
      - number: 26 = SO_ATTACH_FILTER

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/attach-bpf-to-socket-on-linux.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: create raw socket
    namespace: communication/socket
    authors:
      - blas.kojusner@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Communication::Socket Communication::Create Socket [C0001.003]
    references:
      - https://learn.microsoft.com/en-us/windows/win32/winsock/tcp-ip-raw-sockets-2
      - https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-socket
      - https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsasocketa
    examples:
      - 10EBCF8C20403457A08762200015B151:0x140001000
    capa/nursery: false
  features:
    - and:
      - or:
        - api: socket
        - api: ws2_32.#23 = socket
        - api: ws2_32.WSASocket
        - api: ws2_32.#82 = WSASocketA
        - api: ws2_32.#83 = WSASocketW
      - or:
        - number: 2 = AF_INET
        - number: 23 = AF_INET6
      - number: 3 = SOCK_RAW

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/create-raw-socket.yml
----------------------------------------------
rule:
  meta:
    name: create VMCI socket
    namespace: communication/socket
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: basic block
      dynamic: span of calls
    mbc:
      - Communication::Socket Communication::Create Socket [C0001.003]
    references:
      - https://www.vmware.com/products/beta/ws/VMCIsockets.pdf
    examples:
      - 9ed5660c6a442dbba9e2ba795ccc913c1f1517ce89854fe4287c1c8b36b21d52:0x1800011D0
    capa/nursery: false
  features:
    - or:
      - and:
        - os: windows
        - or:
          - api: socket
          - api: DeviceIoControl
        - number: 0x81032068 = VMCI_SOCKETS_GET_AF_VALUE
      - and:
        - os: linux
        - or:
          - api: ioctl
          - api: socket
        - number: 0x7B8 = VMCI_SOCKETS_GET_AF_VALUE

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/create-vmci-socket.yml
----------------------------------------------
rule:
  meta:
    name: connect TCP socket
    namespace: communication/socket/tcp
    authors:
      - moritz.raabe@mandiant.com
      - joakim@intezer.com
      - mrhafizfarhad@gmail.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Communication::Socket Communication::Connect Socket [C0001.004]
    examples:
      - Practical Malware Analysis Lab 01-01.dll_:0x10001010
    capa/nursery: false
  features:
    - and:
      - match: create TCP socket
      - match: connect socket

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/tcp/connect-tcp-socket.yml
----------------------------------------------
rule:
  meta:
    name: create TCP socket via raw AFD driver
    namespace: communication/socket/tcp
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Communication::Socket Communication::Create TCP Socket [C0001.011]
    references:
      - https://www.x86matthew.com/view_post?id=ntsockets
    examples:
      - 0fd8330e00aa48676d6d0c4f36e9a80b:0x1400132B0
    capa/nursery: false
  features:
    - and:
      # wanted, but the routine is resolved via GetProcAddress into a global
      # - api: ntdll.NtCreateFile

      - api: kernel32.CreateEvent
      - string: "\\Device\\Afd\\Endpoint"
      - or:
        - description: a hardcoded byte array that provides the socket details to the AFD driver via "extended attributes".

        # the raw byte sequence
        - bytes: 00 00 00 00 00 0F 1E 00 41 66 64 4F 70 65 6E 50 61 63 6B 65 74 58 58 00 00 00 00 00 00 00 00 00 02 00 00 00 01 00 00 00 06 00 00 00 00 00 00 00 00 00 00 00 60 EF 3D 47 FE = bExtendedAttributes for IPv4 TCP

        # in the example code, in debug mode, the array is constructed bytewise on the stack
        - basic block:
          - and:
            - description: bExtendedAttributes for IPv4 TCP on stack, bytewise
            # i've kept the values approximately in order while removing some duplicates for clarity
            - number: 0x00
            - number: 0x0F
            - number: 0x1E
            - number: 0x41 = A
            - number: 0x66 = f
            - number: 0x64 = d
            - number: 0x4F = O
            - number: 0x70 = p
            # - number: 0x65 = e
            - number: 0x6E = n
            - number: 0x50 = P
            - number: 0x61 = a
            - number: 0x63 = c
            - number: 0x6B = k
            - number: 0x65 = e
            - number: 0x74 = t
            - number: 0x58 = X
            - number: 0x02
            - number: 0x01
            - number: 0x06
            # - number: 0x00
            - number: 0x60
            - number: 0xEF
            - number: 0x3D
            - number: 0x47
            - number: 0xFE

        # in the example code, in release mode, the array is constructed word-wise on the stack
        - basic block:
          - and:
            - description: bExtendedAttributes for IPv4 TCP on stack, wordwise
            - number: 0x1E0F00 = bExtendedAttributes+0x4
            - number: 0x4F646641 = AfdO
            - number: 0x506E6570 = penP
            - number: 0x656B6361 = acke
            - number: 0x585874 = tXx
            - number: 6 = IPPROTO_TCP
            - number: 1 = SOCK_STREAM
            - number: 2 = AF_INET
            - number: 0x473DEF60 = bExtendedAttributes+0x34
            - number: 0x0FE = bExtendedAttributes+0x38
      - optional:
        - api: NtCreateFile
        - api: NtDeviceIoControlFile
        - api: kernel32.WaitForSingleObject
        - number: 0x12003 = IOCTL_AFD_BIND
        - number: 0x12007 = IOCTL_AFD_CONNECT
        - number: 0x12017 = IOCTL_AFD_RECV
        - number: 0x1201F = IOCTL_AFD_SEND

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/tcp/create-tcp-socket-via-raw-afd-driver.yml
----------------------------------------------
rule:
  meta:
    name: create TCP socket
    namespace: communication/socket/tcp
    authors:
      - william.ballenthin@mandiant.com
      - joakim@intezer.com
      - anushka.virgaonkar@mandiant.com
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Communication::Socket Communication::Create TCP Socket [C0001.011]
    references:
      - https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-socket
      - https://man7.org/linux/man-pages/man2/socket.2.html
    examples:
      - Practical Malware Analysis Lab 01-01.dll_:0x10001010
    capa/nursery: false
  features:
    - or:
      - and:
        - or:
          - number: 0 = protocol (default)
          - number: 6 = IPPROTO_TCP
        - number: 1 = SOCK_STREAM
        - number: 2 = AF_INET
        - or:
          - api: socket
          - api: ws2_32.socket
          - api: ws2_32.#23 = socket
          - api: ws2_32.WSASocket
          - api: ws2_32.#82 = WSASocketA
          - api: ws2_32.#83 = WSASocketW
          - api: System.Net.Sockets.Socket::ctor
      - property/read: System.Net.Sockets.TcpClient::Client

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/tcp/create-tcp-socket.yml
----------------------------------------------
rule:
  meta:
    name: obtain TransmitPackets callback function via WSAIoctl
    namespace: communication/socket/tcp/send
    authors:
      - jonathan.lepore@mandiant.com
    description: The TransmitPackets function transmits in-memory data or file data over a connected socket. The TransmitPackets function uses the operating system cache manager to retrieve file data, locking memory for the minimum time required to transmit and resulting in efficient, high-performance transmission.
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Communication::Socket Communication::Send TCP Data [C0001.014]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/mswsock/nc-mswsock-lpfn_transmitpackets
    examples:
      - 138C71E94961FE9E31CEC5DFBA62A639:0x100FF55
    capa/nursery: false
  features:
    - and:
      - mnemonic: call
      - number: 0x10 = inbuffer size (16 bytes to hold guid)
      - number: 0x0C8000006 = SIO_GET_EXTENSION_FUNCTION_POINTER
      - or:
        - bytes: A0 9D 68 D9 90 1F D3 11 99 71 00 C0 4F 68 C8 76 = WSAID_TRANSMITPACKETS guid
        - and:
          - number: 0x76C8684F = WSAID_TRANSMITPACKETS guid part
          - number: 0xC0007199 = WSAID_TRANSMITPACKETS guid part
          - number: 0x11D31F90 = WSAID_TRANSMITPACKETS guid part
          - number: 0xD9689DA0 = WSAID_TRANSMITPACKETS guid part
      - or:
        - and:
          - arch: i386
          - number: 0x4 = 32-bit function ptr
        - and:
          - arch: amd64
          - number: 0x8 = 64-bit function ptr
      - optional:
        - api: WSAIoctl
        - api: WSAGetLastError

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/tcp/send/obtain-transmitpackets-callback-function-via-wsaioctl.yml
----------------------------------------------
rule:
  meta:
    name: send TCP data via WFP API
    namespace: communication/socket/tcp/send
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Communication::Socket Communication::Send TCP Data [C0001.014]
    examples:
      - 493167E85E45363D09495D0841C30648:0x404560
    capa/nursery: false
  features:
    - and:
      - api: fwpkclnt.FwpsStreamInjectAsync0
      - number: 0x10000 = FWPS_STREAM_FLAG_SEND

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/communication/socket/tcp/send/send-tcp-data-via-wfp-api.yml
----------------------------------------------
rule:
  meta:
    name: compiled with cx_Freeze
    namespace: compiler/cx_freeze
    authors:
      - '@mr-tz'
      - jakub.jozwiak@mandiant.com
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Execution::Command and Scripting Interpreter::Python [T1059.006]
      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]
    references:
      - https://github.com/marcelotduarte/cx_Freeze
    examples:
      - 573174640974b288d9d161cf4d29387cd7dbf7d80a80f5547df887f9836df8fb
    capa/nursery: false
  features:
    - or:
      - and:
        - os: windows
        - 3 or more:
          - string: "cx_Freeze Fatal Error"
          - string: "cx_Freeze: Python error in main script"
          - string: "cx_Freeze: Application Terminated"
          - string: "%ls\\lib\\library.zip;%ls\\lib"
          - string: "Unable to calculate directory of executable!"
          - string: "Unable to load python3.dll!"
          - string: "Unable to change DLL search path!"
          - string: "initializing with config file %ls"
          - string: "%ls --install <NAME> [<CONFIGFILE>]"
          - string: "exception calling session_changed method"
      - and:
        - or:
          - os: linux
          - os: macos
        - 3 or more:
          - string: "PATH environment variable not defined!"
          - string: "Unable to determine absolute path for executable!"
          - string: "Unable to convert path to string!"
          - string: "Unable to calculate directory of executable!"
          - string: "Out of memory creating sys.path!"
          - string: "Out of memory converting arguments!"
          - string: "Unable to convert argument to string!"
          - string: "%ls/lib/library.zip:%ls/lib"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/compiler/cx_freeze/compiled-with-cx_freeze.yml
----------------------------------------------
rule:
  meta:
    name: compiled with Dart
    namespace: compiler/dart
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: file
      dynamic: file
    references:
      - https://dart.dev/
      - https://github.com/dart-lang/sdk
    examples:
      - 659a539cfff56e5450af76f8696b7122d6a22b1d7dbe5121c7b6308eb6ec1c3a
    capa/nursery: false
  features:
    - 2 or more:
      - string: "dart:typed_data"
      - string: "dart:_internal"
      - string: "_kDartVmSnapshotData"
      - string: "dart:core/bool.dart"
      - string: "dart:io/common.dart"
      - string: "dart:ffi-patch/ffi_patch.dart"
      - string: "Object_haveSameRuntimeType"

Reason: Some aka x or more (TODO) (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/compiler/dart/compiled-with-dart.yml
----------------------------------------------
rule:
  meta:
    name: compiled with Nim
    namespace: compiler/nim
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: file
      dynamic: file
    examples:
      - 580c37831fe98a254eb6c61c692c70d8.exe_
    capa/nursery: false
  features:
    - or:
      - substring: "NimMain"
      - substring: "NimMainModule"
      - substring: "NimMainInner"
      - substring: "io.nim"
      - substring: "fatal.nim"
      - substring: "system.nim"
      - substring: "alloc.nim"
      - substring: "osalloc.nim"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/compiler/nim/compiled-with-nim.yml
----------------------------------------------
rule:
  meta:
    name: compiled with perl2exe
    namespace: compiler/perl2exe
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - 873275ce8bf88ef66e9fa0c74b5c2a1e:0x4011C9
    capa/nursery: false
  features:
    - and:
      - api: LoadLibrary
      - api: FreeLibrary
      - string: /^p2x[a-z0-9]{1,10}\.dll/i
      - or:
        - basic block:
          - and:
            - api: GetProcAddress
            - string: "RunPerl"
        - call:
          - and:
            - api: GetProcAddress
            - string: "RunPerl"

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/compiler/perl2exe/compiled-with-perl2exe.yml
----------------------------------------------
rule:
  meta:
    name: compiled with rust
    namespace: compiler/rust
    authors:
      - '@_re_fox'
      - william.ballenthin@mandiant.com
    scopes:
      static: file
      dynamic: file
    examples:
      - c3341b7dfbb9d43bca8c812e07b4299f:0x45F490
    capa/nursery: false
  features:
    - or:
      - substring: "run with `RUST_BACKTRACE=1` environment variable"
      - substring: "called `Option::unwrap()` on a `None` value"
      - substring: "called `Result::unwrap()` on an `Err` value"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/compiler/rust/compiled-with-rust.yml
----------------------------------------------
rule:
  meta:
    name: compiled with Zig
    namespace: compiler/zig
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: file
      dynamic: file
    references:
      - https://ziglang.org
      - https://github.com/ziglang/zig
    examples:
      - 74e0758e469ab87f38cda7925d696ea41a122364891860e1ae30fc9ff2f68e7d
    capa/nursery: false
  features:
    - 2 or more:
      - string: "ZIG_DEBUG_COLOR"
      - string: "Panicked during a panic. Aborting."
      - string: "error.Unexpected NTSTATUS=0x{x}"
      - string: "Unable to dump stack trace: debug info stripped"
      - string: "Unable to dump stack trace: Unable to open debug info: {s}"
      - string: "Unable to dump stack trace: {s}"
      - string: "std.mem.Allocator.alloc"
      - string: "_std.os.getenv"
      - string: "\\\\.\\pipe\\zig-childprocess-{d}-{d}"

Reason: Some aka x or more (TODO) (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/compiler/zig/compiled-with-zig.yml
----------------------------------------------
rule:
  meta:
    name: compute adler32 checksum
    namespace: data-manipulation/checksum/adler32
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Checksum::Adler [C0032.005]
    references:
      - https://en.wikipedia.org/wiki/Adler-32
    examples:
      - 42E81CC1145BA3C1936A6CF9B8DA0CCD:0x10001000
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0xF

          - number: 0x80078071
          - mnemonic: mul

          - instruction:
            - mnemonic: imul
            - or:
              - number: 0xFFFF000F = -65521
              - number: 0xFFF1 = 65521
          - or:
            - mnemonic: add
            - mnemonic: sub
        # Examples:
        # The sequence below performs mod 65521 using the example 262089 % 65521 = 5:
        # mov     eax, 80078071h  ; ecx = 262089 (0x3FFC9)
        # mul     ecx             ; 0x3FFC9 * 0x80078071 = 0x20002802767B9
        #                         ; edx = 0x20002
        # shr     edx, 0Fh        ; edx = 0x2002 >> 0xF = 4
        # imul    edx, 0FFFF000Fh ; edx = 4 * -65521 (0xFFFF000F) = -262084 = 0xFFFC003C (-0x3FFC4)
        # add     ecx, edx        ; ecx = 0x3FFC9 + -0x3FFC4 = 5

        # A variation of the above was observed in a deobfuscated MAZE sample (hash not available):           
        # mov     eax, ebx          ; eax = ebx = 262089 (0x3FFC9)
        # mov     esi, 80078071h
        # mul     esi               ; 0x3FFC9 * 0x80078071 = 0x20002802767B9
        #                           ; edx = 0x20002
        # shr     edx, 0Fh          ; edx = 0x2002 >> 0xF = 4
        # imul    eax, edx, 0FFF1h  ; eax = 4 * 65521 (0xFFF1) = 262084 (3FFC4)
        # sub     ebx, eax          ; ebx = 0x3FFC9 - 0x3FFC4 = 5
      - instruction:
        - mnemonic: shl
        - number: 0x10
      - count(characteristic(tight loop)): 2 or more

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/checksum/adler32/compute-adler32-checksum.yml
----------------------------------------------
rule:
  meta:
    name: validate payment card number using luhn algorithm
    namespace: data-manipulation/checksum/luhn
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Checksum::Luhn [C0032.002]
    examples:
      - 1d8fd13c890060464019c0f07b928b1a:0x401920
      - 6fcc13563aad936c7d0f3165351cb453:0x4026C0
    capa/nursery: false
  features:
    - or:
      - match: validate payment card number using luhn algorithm with no lookup table
      - match: validate payment card number using luhn algorithm with lookup table

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/checksum/luhn/validate-payment-card-number-using-luhn-algorithm.yml
----------------------------------------------
rule:
  meta:
    name: compress data using LZO
    namespace: data-manipulation/compression
    authors:
      - david@edeca.net
      - david.cannings@pwc.com
    description: detects the compression routine from LZO
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Data::Compress Data [C0024]
    references:
      - https://github.com/zenzhang/msgclient/blob/f7c346287022dd41b21aedc8664a281b32e4a1f1/src/framework/string/Compress.cpp
    examples:
      - ee3b869b668abec332d07c66d1a39f6dbf3a598cc1325b57a0504f8d24ac2e28.dll_:0x10026370
    capa/nursery: false
  features:
    - and:
      - number: 0x4000
      - number: 0x3FFF
      - or:
        - number: 0xBFFE
        - number: 0xBFFF
      - number: 0x800
      - number: 0x7FF
      - number: 0x201F

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/compression/compress-data-using-lzo.yml
----------------------------------------------
rule:
  meta:
    name: decompress data using aPLib
    namespace: data-manipulation/compression
    authors:
      - '@r3c0nst (Frank Boldewin)'
      - moritz.raabe@mandiant.com
      - cdong49@gatech.edu
    description: detects decompression function of library aPLib
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Decompress Data::aPLib [C0025.003]
    references:
      - https://ibsensoftware.com/files/aPLib-1.1.1.zip
    examples:
      - DAA13AE302FE8B618DDBF590537443EF:0x419F50
      - B43FCA5283BFC7022553EFF663683834:0x424
      - 757139E76FAE876AE50DD2C3AC11D5D8:0x413074
    capa/nursery: false
  features:
    - and:
      - description: aP_depack
      - match: contain loop
      - instruction:
        - description: line 138, if (offs >= 32000)
        - mnemonic: cmp
        - number: 32000
      - instruction:
        - description: line 144, if (offs < 128)
        - mnemonic: cmp
        - or:
          - number: 127
          - number: 128
      - instruction:
        - description: line 133, offs <<= 8;
        - mnemonic: shl
        - number: 8
      - instruction:
        - description: line 96, offs >>= 1;
        - mnemonic: shr
        - number: 1
      - optional:
        - count(characteristic(calls from)): 2 or more
          description: calls aP_getbit and aP_getgamma

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/compression/decompress-data-using-aplib.yml
----------------------------------------------
rule:
  meta:
    name: decompress data using LZO
    namespace: data-manipulation/compression
    authors:
      - david@edeca.net
      - david.cannings@pwc.com
    description: detects the decompression routine from LZO
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Decompress Data [C0025]
    references:
      - https://github.com/zenzhang/msgclient/blob/f7c346287022dd41b21aedc8664a281b32e4a1f1/src/framework/string/Compress.cpp
    examples:
      - ee3b869b668abec332d07c66d1a39f6dbf3a598cc1325b57a0504f8d24ac2e28.dll_:0x1000BB90
    capa/nursery: false
  features:
    - and:
      - instruction:
        - description: t += 255;
        - mnemonic: add
        - number: 0xFF
      - or:
        - instruction:
          - or:
            - mnemonic: and
            - mnemonic: add
          - number: 0xFFFFFFFC
        - instruction:
          - mnemonic: sub
          - number: 4
      - instruction:
        - description: t &= 31;
        - mnemonic: and
        - number: 0x1F
      - instruction:
        - description: m_pos -= 0x4000;
        - mnemonic: sub
        - number: 0x4000
      - instruction:
        - description: m_pos -= t >> 2;
        - mnemonic: shr
        - number: 2
      - or:
        - characteristic: loop
        - characteristic: tight loop

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/compression/decompress-data-using-lzo.yml
----------------------------------------------
rule:
  meta:
    name: decompress data using QuickLZ
    namespace: data-manipulation/compression
    authors:
      - david@edeca.net
    description: detects the inner decompression loop from QuickLZ
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Decompress Data::QuickLZ [C0025.001]
    references:
      - http://www.quicklz.com/
    examples:
      - 64d9f7d96b99467f36e22fada623c3bb:0x10001510
      - 234c8034e88b2d097d2da51a85253825:0x100015B0
      - f54a09e966bb929e68f5c01fa3087a3a:0x10001590
      - d115f4b2ec8579be33fe883219c00ae2:0x1800015E0
      - 831083e1614090dbb5815dba36faa2f3:0x1800016E0
      - 7e0b974f004e4e0523fe4d9b9d89e5ad:0x1800016B0
      - 6a352c3e55e8ae5ed39dc1be7fb964b1:0x10010DE0
    capa/nursery: false
  features:
    - or:
      - basic block:
        - and:
          - description: Mode 1 decompression
          - mnemonic: xor
          - mnemonic: shr
          - mnemonic: and
          - number: 0xC
          - number: 0xFFF
          - or:
            - offset: 0x4000
            - offset: 0x8000
      - basic block:
        - and:
          - description: Mode 2 decompression
          - mnemonic: shr
          - mnemonic: and
          - mnemonic: mov
          - number: 0x5
          - number: 0x1
          - number: 0x7FF
      - and:
        - description: Mode 3 decompression
        - basic block:
          - and:
            - mnemonic: shr
            - mnemonic: and
            - mnemonic: mov
            - number: 0x2
            - number: 0x3
            - number: 0x3FFF
        - basic block:
          - and:
            - mnemonic: shr
            - mnemonic: and
            - number: 0x3FF

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/compression/decompress-data-using-quicklz.yml
----------------------------------------------
rule:
  meta:
    name: decompress data using UCL
    namespace: data-manipulation/compression
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Decompress Data [C0025]
    references:
      - http://www.oberhumer.com/opensource/ucl/
    examples:
      - 3d0d79c4715e5b6dd2f8704e4878d57646d5a92e1116aec2ef81a5679ba45cd8:0x14005BB40
    capa/nursery: false
  features:
    - and:
      - match: contain loop
      - or:
        - and:
          - count(mnemonic(shr)): 7 or more
          - or:
            - count(number(0x1f)): 7 or more
              description: ucl_nrv2b_decompress_safe_le32
            - count(number(0x10)): 7 or more
              description: ucl_nrv2b_decompress_safe_le16
        - and:
          - description: ucl_nrv2b_decompress_safe_8
          - count(mnemonic(test)): 7 or more
          - count(number(0x7f)): 7 or more
      - 2 or more:
        - number: 0x500 = M2_MAX_OFFSET
        - number: 0xFFFFFF37 = UCL_E_INPUT_OVERRUN
        - number: 0xFFFFFF36 = UCL_E_OUTPUT_OVERRUN
        - number: 0xFFFFFF35 = UCL_E_LOOKBEHIND_OVERRUN
        - number: 0xFFFFFF34 = UCL_E_EOF_NOT_FOUND
        - number: 0xFFFFFF33 = UCL_E_INPUT_NOT_CONSUMED
        - number: 0xFFFFFF32 = UCL_E_OVERLAP_OVERRUN

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/compression/decompress-data-using-ucl.yml
----------------------------------------------
rule:
  meta:
    name: decompress data via IEncodingFilterFactory
    namespace: data-manipulation/compression
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Decompress Data::IEncodingFilterFactory [C0025.002]
    references:
      - https://www.virusbulletin.com/virusbulletin/2012/09/urlzone-reloaded-new-evolution/
    examples:
      - FBBAAF569B63F6398503E4F1979CABEF:0x40691F
    capa/nursery: false
  features:
    - and:
      - api: ole32.CoCreateInstance
      - bytes: D0 7C C3 54 44 D9 D0 11 A9 F4 00 60 97 94 23 11 = StdEncodingFilterFac
      - bytes: 00 DE BD 70 8E C1 D0 11 A9 CE 00 60 97 94 23 11 = IEncodingFilterFactory
      - count(offset(0x10 = IEncodingFilterFactory.GetDefaultFilter and <filter>.DoDecode)): 2 or more

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/compression/decompress-data-via-iencodingfilterfactory.yml
----------------------------------------------
rule:
  meta:
    name: encode data using ADD XOR SUB operations
    namespace: data-manipulation/encoding
    authors:
      - jakub.jozwiak@mandiant.com
    description: Data encoding using a sequence of ADD/XOR/SUB (or SUB/XOR/ADD) operations common for PlugX but also used by other malware families.
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encoding-Custom Algorithm [E1027.m03]
    examples:
      - df814d4b55912e4ba404c62080b3a7eda70a3c6283ea740f8a14a9116d803259:0x1000100F
    capa/nursery: false
  features:
    - and:
      - count(basic blocks): 6 or fewer
      - basic block:
        - and:
          - characteristic: tight loop
          - characteristic: nzxor
          - count(mnemonic(add)): 1
          - count(mnemonic(sub)): 1

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encoding/encode-data-using-add-xor-sub-operations.yml
----------------------------------------------
rule:
  meta:
    name: decode data using Base64 via dword translation table
    namespace: data-manipulation/encoding/base64
    authors:
      - gilbert.elliot@mandiant.com
      - sara.rincon@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]
      - Data::Encode Data::Base64 [C0026.001]
    examples:
      - 9efa86b43b4367bcdc1591aee59bda25:0x10001000
      - 09bf850be5da44a1c3629a1f62813a83:0x10001100
    capa/nursery: false
  features:
    - and:
      - mnemonic: shl
      - or:
        - mnemonic: sar
        - mnemonic: shr
      - match: contain loop
      - number: 2
      - number: 3
      - number: 4
      - number: 6
      - or:
        - number: 0xF
        - number: 0x3D
        - number: 0x40
      - or:
        - bytes: FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 3E 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FF 3F 00 00 00 34 00 00 00 35 00 00 00 36 00 00 00 37 00 00 00 38 00 00 00 39 00 00 00 3A 00 00 00 3B 00 00 00 3C 00 00 00 3D 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF = hardcoded base64 translation table (first 64 of 256 dwords)
        - bytes: FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 3E FF FF FF 3F 34 35 36 37 38 39 3A 3B 3C 3D FF FF FF FF FF FF FF 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16 17 18 19 FF FF FF FF FF FF 1A 1B 1C 1D 1E 1F 20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 33 FF FF FF FF FF = hardcoded base64 translation table
        - bytes: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 3E 00 00 00 3F 00 00 00 3E 00 00 00 3E 00 00 00 3F 00 00 00 34 00 00 00 35 00 00 00 36 00 00 00 37 00 00 00 38 00 00 00 39 00 00 00 3A 00 00 00 3B 00 00 00 3C 00 00 00 3D 00 00 00
        - string: "BBBBBBBBBB@BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB>BBB?456789:;<=BBBABBB"

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encoding/base64/decode-data-using-base64-via-dword-translation-table.yml
----------------------------------------------
rule:
  meta:
    name: decode data using Base64 via WinAPI
    namespace: data-manipulation/encoding/base64
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Deobfuscate/Decode Files or Information [T1140]
    examples:
      - mimikatz.exe_:0x40D742
    capa/nursery: false
  features:
    - and:
      - or:
        # number: 0x0 = CRYPT_STRING_BASE64HEADER (with certificate beginning and ending headers), FPs too likely for 0
        - number: 0x1 = dwFlags=CRYPT_STRING_BASE64  # without headers
        - number: 0x6 = dwFlags=CRYPT_STRING_BASE64_ANY  # tries: CRYPT_STRING_BASE64HEADER, CRYPT_STRING_BASE64
        - number: 0x7 = dwFlags=CRYPT_STRING_ANY  # tries: CRYPT_STRING_BASE64HEADER, CRYPT_STRING_BASE64, CRYPT_STRING_BINARY
      - api: CryptStringToBinary

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encoding/base64/decode-data-using-base64-via-winapi.yml
----------------------------------------------
rule:
  meta:
    name: encode data using Base64 via WinAPI
    namespace: data-manipulation/encoding/base64
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    examples:
      - mimikatz.exe_:0x40622D
    capa/nursery: false
  features:
    - and:
      - or:
        # number: 0x0 = CRYPT_STRING_BASE64HEADER (with certificate beginning and ending headers), FPs too likely for 0
        - number: 0x1 = dwFlags=CRYPT_STRING_BASE64  # without headers
        - number: 0x3 = dwFlags=CRYPT_STRING_BASE64REQUESTHEADER  # with request beginning and ending headers
        - number: 0x9 = dwFlags=CRYPT_STRING_BASE64X509CRLHEADER  # with X.509 CRL beginning and ending headers
        # CRYPT_STRING_NOCRLF = 0x40000000, do not append any new line characters to the encoded string
        - number: 0x40000001 = dwFlags=CRYPT_STRING_BASE64 | CRYPT_STRING_NOCRLF
        - number: 0x40000003 = dwFlags=CRYPT_STRING_BASE64REQUESTHEADER | CRYPT_STRING_NOCRLF
        - number: 0x40000009 = dwFlags=CRYPT_STRING_BASE64X509CRLHEADER | CRYPT_STRING_NOCRLF
        # CRYPT_STRING_NOCR = 0x80000000, only use the line feed (LF) character
        - number: 0x80000001 = dwFlags=CRYPT_STRING_BASE64 | CRYPT_STRING_NOCR
        - number: 0x80000003 = dwFlags=CRYPT_STRING_BASE64REQUESTHEADER | CRYPT_STRING_NOCR
        - number: 0x80000009 = dwFlags=CRYPT_STRING_BASE64X509CRLHEADER | CRYPT_STRING_NOCR
      - api: CryptBinaryToString

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encoding/base64/encode-data-using-base64-via-winapi.yml
----------------------------------------------
rule:
  meta:
    name: encode data using XOR
    namespace: data-manipulation/encoding/xor
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]
      - Data::Encode Data::XOR [C0026.002]
    examples:
      - 2D3EDC218A90F03089CC01715A9F047F:0x403D7E
    capa/nursery: false
  features:
    - and:
      - characteristic: tight loop
      - characteristic: nzxor
      - not:
        - description: filter for potential false positives
        - or:
          - or:
            - description: unsigned bitwise negation operation (~i)
            - number: 0xFFFFFFFF = bitwise negation for unsigned 32 bits
            - number: 0xFFFFFFFFFFFFFFFF = bitwise negation for unsigned 64 bits
          - or:
            - description: signed bitwise negation operation (~i)
            - number: 0x0FFFFFFF = bitwise negation for signed 32 bits
            - number: 0x0FFFFFFFFFFFFFFF = bitwise negation for signed 64 bits
          - or:
            - description: Magic constants used in the implementation of strings functions.
            # such as `strlen` and `strcat` in the Windows standard library:
            # (((i - 0x81010101) ^ ~i) & 0x81010100)
            ## 32 bits
            - number: 0x7EFEFEFF = optimized string constant for 32 bits
            - number: 0x81010101 = -0x81010101 = 0x7EFEFEFF
            - number: 0x81010100 = 0x81010100 = ~0x7EFEFEFF
            ## 64 bits
            - number: 0x7EFEFEFEFEFEFEFF = optimized string constant for 64 bits
            - number: 0x8101010101010101 = -0x8101010101010101 = 0x7EFEFEFEFEFEFEFF
            - number: 0x8101010101010100 = 0x8101010101010100 = ~0x7EFEFEFEFEFEFEFF

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encoding/xor/encode-data-using-xor.yml
----------------------------------------------
rule:
  meta:
    name: create new key via CryptAcquireContext
    namespace: data-manipulation/encryption
    authors:
      - chuong.dong@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Cryptography::Encryption Key [C0028]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptacquirecontexta
    examples:
      - E5369AC309F1BE6D77AFEEB3EDAB0ED8:0x401350
    capa/nursery: false
  features:
    - and:
      - api: advapi32.CryptAcquireContext
      - or:
        - number: 0x8 = CRYPT_NEWKEYSET
        - number: 0x18 = CRYPT_NEWKEYSET | CRYPT_DELETEKEYSET
        - number: 0x28 = CRYPT_NEWKEYSET | CRYPT_MACHINE_KEYSET
        - number: 0x48 = CRYPT_NEWKEYSET | CRYPT_SILENT
        - number: 0x88 = CRYPT_NEWKEYSET | CRYPT_DEFAULT_CONTAINER_OPTIONAL

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/create-new-key-via-cryptacquirecontext.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using memfrob from glibc
    namespace: data-manipulation/encryption
    authors:
      - zander.work@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption [E1027.m04]
      - Cryptography::Encrypt Data [C0027]
    examples:
      - 055da8e6ccfe5a9380231ea04b850e18:0x1189
    capa/nursery: false
  features:
    - and:
      - os: linux
      - api: memfrob

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/encrypt-data-using-memfrob-from-glibc.yml
----------------------------------------------
rule:
  meta:
    name: get outbound credentials handle via CredSSP
    namespace: data-manipulation/encryption
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea
      - https://docs.microsoft.com/en-us/windows/win32/secauthn/getting-schannel-credentials
    examples:
      - mimikatz.exe_:0x457AAB
    capa/nursery: false
  features:
    - and:
      - api: secur32.AcquireCredentialsHandle
      - number: 2 = fCredentialUse=SECPKG_CRED_OUTBOUND

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/get-outbound-credentials-handle-via-credssp.yml
----------------------------------------------
rule:
  meta:
    name: use bigint function
    namespace: data-manipulation/encryption
    authors:
      - Ana06
    description: use bigint function such as bi_copy and bi_permanent. Useful to identify crypto.
    scopes:
      static: instruction
      dynamic: unsupported
    references:
      # bi_copy
      - https://github.com/ezhangle/krypton/blob/147d69429bfb03cce7113dca6dba36e77f8a9325/src/bigint.c#L149
      - https://github.com/bnoordhuis/mongrel2/blob/3e9b57d82aeb627be0aebfb346199bfdfd67e530/src/crypto/bigint.c#L162
      - https://github.com/ezhangle/krypton/blob/147d69429bfb03cce7113dca6dba36e77f8a9325/src/bigint.c#L161
      - https://github.com/bnoordhuis/mongrel2/blob/3e9b57d82aeb627be0aebfb346199bfdfd67e530/src/crypto/bigint.c#L176
    examples:
      - 009c2377b67997b0da1579f4bbc822c1:0x404096
      - 009c2377b67997b0da1579f4bbc822c1:0x4040D4
      - 009c2377b67997b0da1579f4bbc822c1:0x4040E6
      - 009c2377b67997b0da1579f4bbc822c1:0x404109
      - 8333822ed41d9f2b302cf8e21b126efc:0x407933
      - 8333822ed41d9f2b302cf8e21b126efc:0x407933
    capa/nursery: false
  features:
    - and:
      - or:
        - mnemonic: mov
        - mnemonic: cmp
      - number: 0x7FFF55AA = PERMANENT
      - offset: 8 = bi->refs

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/use-bigint-function.yml
----------------------------------------------
rule:
  meta:
    name: decrypt data using AES via x86 extensions
    namespace: data-manipulation/encryption/aes
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Deobfuscate/Decode Files or Information [T1140]
    mbc:
      - Cryptography::Decrypt Data::AES [C0031.001]
    examples:
      - 66602B5FAB602CB4E6F754748D249542:0x4097D0
    capa/nursery: false
  features:
    - or:
      - mnemonic: aesdec = Perform One Round of an AES Decryption Flow
      - mnemonic: vaesdec
      - mnemonic: aesdeclast = Perform Last Round of an AES Decryption Flow
      - mnemonic: vaesdeclast

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "mnemonic" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/aes/decrypt-data-using-aes-via-x86-extensions.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: encrypt data using AES MixColumns step
    namespace: data-manipulation/encryption/aes
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::AES [C0027.001]
    references:
      - https://en.wikipedia.org/wiki/Rijndael_MixColumns
    examples:
      - 1e9fc7f32bd5522dd0222932eb9f1d8bd0a2e132c7b46cfcc622ad97831e6128:0x40e3de
    capa/nursery: false
  features:
    - and:
      # for (c = 0; c < 4; c++)
      - characteristic: loop
      - instruction:
        - and:
          - mnemonic: cmp
          - operand[1].number: 0x4
      # b[c] = r[c] << 1;
      - instruction:
        - and:
          - description: implicitly removes high bit
          - mnemonic: shl
          - operand[1].number: 0x1
      # b[c] ^= h * 0x1B;
      - instruction:
        - and:
          - description: Rijndael's Galois field
          - mnemonic: xor
          - operand[1].number: 0x1B
      - optional:
        - instruction:
          - and:
            - description: "byte assignment, e.g., in: b[c] = r[c] << 1; b[c] ^= h * 0x1B;"
            - mnemonic: mov
            - operand[0].offset: 0x0

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/aes/encrypt-data-using-aes-mixcolumns-step.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using AES via .NET
    namespace: data-manipulation/encryption/aes
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::AES [C0027.001]
    examples:
      - b9f5bd514485fb06da39beff051b9fdc
    capa/nursery: false
  features:
    - and:
      - class: System.Security.Cryptography.RijndaelManaged
      - class: System.Security.Cryptography.CryptoStream

Reason: class (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/aes/encrypt-data-using-aes-via-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using AES via WinAPI
    namespace: data-manipulation/encryption/aes
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::AES [C0027.001]
    examples:
      - BC577119D1A5B7DA489E7B5817D3CC38:0x10002FAC
    capa/nursery: false
  features:
    - and:
      - or:
        - number: 0x6611 = CALG_AES
        - number: 0x660E = CALG_AES_128
        - number: 0x660F = CALG_AES_192
        - number: 0x6610 = CALG_AES_256
      - or:
        - api: CryptGenKey
        - api: CryptDeriveKey
        - api: CryptImportKey
      - optional:
        - or:
          - number: 1 = PROV_RSA_FULL
          - api: CryptAcquireContext
          - api: CryptEncrypt
          - api: CryptDecrypt

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/aes/encrypt-data-using-aes-via-winapi.yml
----------------------------------------------
rule:
  meta:
    name: manually build AES constants
    namespace: data-manipulation/encryption/aes
    authors:
      - huynh.t.nhan@gmail.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::AES [C0027.001]
    examples:
      - 8333822ed41d9f2b302cf8e21b126efc:0x40646a
      - 5553bbc23dea546192d07f268c4764a9:0x1149
      - 316aad44bb75e0c7676e173bcb56413e:0x11CD
      - 142300d78d9fb083122332235d93d3ae:0x1210
      - e735a3df2b9ac89ca35ae643d3e73cf9:0x1240
      - fbddca0225a3b806d4b4c933c1c4a636:0x140001000
      - 84b777dc2d7083fd983d946f9fe2bf00:0x401000
    capa/nursery: false
  features:
    - and:
      - or:
        - count(mnemonic(rol)): 4 or more
        - count(mnemonic(shl)): 4 or more
      - count(number(0x63)): 2
      - number: 0x1B
      - basic block:
        - and:
          - number: 0x63
          - count(characteristic(nzxor)): 5 or more

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/aes/manually-build-aes-constants.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using DES via WinAPI
    namespace: data-manipulation/encryption/des
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::3DES [C0027.004]
    examples:
      - 5f66b82558ca92e54e77f216ef4c066c:0x403377
    capa/nursery: false
  features:
    - and:
      - or:
        - number: 0x6601 = CALG_DES
        - number: 0x6603 = CALG_3DES
        - number: 0x6609 = CALG_3DES_112
      - or:
        - api: CryptGenKey
        - api: CryptDeriveKey
        - api: CryptImportKey
      - optional:
        - or:
          - api: CryptAcquireContext
          - api: CryptEncrypt
          - api: CryptDecrypt

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/des/encrypt-data-using-des-via-winapi.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using Curve25519
    namespace: data-manipulation/encryption/elliptic-curve
    authors:
      - dimiter.andonov@mandiant.com
    description: Targets code that enforces Curve25519's secret key restrictions. The specification states "The legitimate users are assumed to generate independent uniform random secret keys. A user can, for example, generate 32 uniform random bytes, clear bits 0, 1, 2 of the first byte, clear bit 7 of the last byte, and set bit 6 of the last byte."
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    examples:
      - 0a0882b8da225406cc838991b5f67d11:0x4135f6
      - 0a0882b8da225406cc838991b5f67d11:0x416f51
      - 80372de850597bd9e7e021a94f13f0a1:0x406480
      - 80372de850597bd9e7e021a94f13f0a1:0x4086f4
      - b4a07cdd640bbaef21cd0493b4d62675:0x4098af
    capa/nursery: false
  features:
    # Common corresponding C source code:
    #    e[0] &= 0xf8;
    #   e[31] &= 0x7f;
    #   e[31] |= 0x40;
    - and:
      - instruction:
        - description: clear bits 0, 1, and 2 of the first byte
        - mnemonic: and
        - number: 0xf8
      - or:
        - instruction:
          - description: clear bit 7 of the last byte
          - mnemonic: and
          - number: 0x7f
        - instruction:
          - description: clear bits 6 and 7 of the last byte; clearing bit 6 in addition to bit 7 is fine because bit 6 is ultimately set
          - mnemonic: and
          - number: 0x3f
      - instruction:
        - description: set bit 6 of the last byte
        - mnemonic: or
        - number: 0x40

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/elliptic-curve/encrypt-data-using-curve25519.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: encrypt data using HC-128 via WolfSSL
    namespace: data-manipulation/encryption/hc-128
    authors:
      - blaine.stancill@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::HC-128 [C0027.006]
    references:
      - https://github.com/wolfSSL/wolfssl/blob/6694775d4b8c22e7411ec69e8a2b516f107b97ef/wolfcrypt/src/hc128.c
    examples:
      - 91B08896FBDA9EDB8B6F93A6BC811EC6:0x180003562
    capa/nursery: false
  features:
    - and:
      - characteristic: nzxor
      - number: 0x17 = 23 from line 153, tem0 = rotrFixed((ctx->T[(v)]),23);
      - number: 0xA = 10 from line 154, tem1 = rotrFixed((ctx->X[(c)]),10);
      - number: 0x8 = 8 from line 155, tem2 = rotrFixed((ctx->X[(b)]),8);
      - or:
        - number: 0x3FC = Compiler optimized size used in ANDs for the 1024 sized buffer
        - number: 0x3FF = 0x3FF from line 105, ctx->counter1024 = (ctx->counter1024 + 16) & 0x3ff;
      - or:
        - count(mnemonic(rol)): 48
        - count(mnemonic(ror)): 48

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/hc-128/encrypt-data-using-hc-128-via-wolfssl.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using HC-128
    namespace: data-manipulation/encryption/hc-128
    authors:
      - awillia2@cisco.com
    description: Looks for instruction mnemonics associated with initialization of the HC-128 stream cipher
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::HC-128 [C0027.006]
    references:
      - https://download.bitdefender.com/resources/files/News/CaseStudies/study/318/Bitdefender-TRR-Whitepaper-Maze-creat4351-en-EN-GenericUse.pdf
      - https://github.com/rost1993/hc128/blob/master/hc128.c
    examples:
      - e69a8eb94f65480980deaf1ff5a431a6:0x405D0D
    capa/nursery: false
  features:
    - and:
      - instruction:
        - mnemonic: shl
        - number: 0x0F = (v << (32 - 17)) from ROTR32(x, 17) in F2(x)
      - instruction:
        - mnemonic: shr
        - number: 0x11 = (v >> 17) from ROTR32(x, 17) in F2(x)
      - instruction:
        - mnemonic: shl
        - number: 0xD = (v << (32 - 19)) from ROTR32(x, 19) in F2(x)
      - instruction:
        - mnemonic: shr
        - number: 0x13 = (v >> 19) from ROTR32(x, 19) in F2(x)
      - instruction:
        - mnemonic: shr
        - number: 0xA = (v >> 10) in F2(x)
      - instruction:
        - mnemonic: shl
        - number: 0x19 = (v << (32 - 7)) from ROTR32(x, 7) in F1(x)
      - instruction:
        - mnemonic: shr
        - number: 0x7 = (v >> 7) from ROTR32(x, 7) in F1(x)
      - instruction:
        - mnemonic: shl
        - number: 0xE = (v << (32 - 18)) from ROTR32(x, 18) in F1(x)
      - instruction:
        - mnemonic: shr
        - number: 0x12 = (v >> 18) from ROTR32(x, 18) in F1(X)
      - instruction:
        - mnemonic: shr
        - number: 0x3 = (x >> 3) in F1(x)
      - count(mnemonic(shl)): 4
      - count(mnemonic(shr)): 6
      - count(mnemonic(or)): 4
      - count(characteristic(nzxor)): 4

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/hc-128/encrypt-data-using-hc-128.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using RC4 KSA
    namespace: data-manipulation/encryption/rc4
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Cryptography::Encrypt Data::RC4 [C0027.009]
      - Cryptography::Encryption Key::RC4 KSA [C0028.002]
    examples:
      - 34404A3FB9804977C6AB86CB991FB130:0x403D40
      - 9324D1A8AE37A36AE560C37448C9705A:0x404950
      - 2B8BEC5BCB1777EAA155D832F7AFC797:0x405C42
      - 73CE04892E5F39EC82B00C02FC04C70F:0x40646E
    capa/nursery: false
  features:
    - or:
      - and:
        - basic block:
          - and:
            - description: initialize S
            # misses if regular loop is used,
            # however we cannot model that a loop contains a certain number
            - characteristic: tight loop
            - or:
              - number: 0xFF
              - number: 0x100
        - or:
          - description: modulo 256
          - match: calculate modulo 256 via x86 assembly
          - basic block:
            - and:
              - description: modulo via zero-extended mov from 8-bit register
              - count(mnemonic(movzx)): 2 or more
              # avoid false positives; filter out unexpected instructions
              - not:
                - or:
                  - mnemonic: shl
                  - mnemonic: rol
                  - characteristic: nzxor
        - or:
          - description: modulo key length
          - mnemonic: div
          - mnemonic: idiv
      - and:
        - description: write DWORDs instead of bytes
        - or:
          - number: 0x03020100
          - number: 0xFFFEFDFC
        - instruction:
          - or:
            - mnemonic: add
            - mnemonic: sub
          - number: 0x04040404

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/rc4/encrypt-data-using-rc4-ksa.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using RC4 PRGA
    namespace: data-manipulation/encryption/rc4
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Cryptography::Encrypt Data::RC4 [C0027.009]
      - Cryptography::Generate Pseudo-random Sequence::RC4 PRGA [C0021.004]
    examples:
      - 34404A3FB9804977C6AB86CB991FB130:0x403DB0
      - 34404A3FB9804977C6AB86CB991FB130:0x403E50
      - 9324D1A8AE37A36AE560C37448C9705A:0x4049F0
      - 73CE04892E5F39EC82B00C02FC04C70F:0x4064C6
    capa/nursery: false
  features:
    - and:
      # TODO: maybe add characteristic for nzxor reg size
      - count(characteristic(nzxor)): 1
      - or:
        - match: calculate modulo 256 via x86 assembly
        # compiler may do this via zero-extended mov from 8-bit register
        - count(mnemonic(movzx)): 4 or more
      # should not call (many) functions
      - count(characteristic(calls from)): (0, 4)
      # should not be too simple or too complex (50 is picked by intuition)
      - count(basic blocks): (4, 50)
      - match: contain loop
      - optional:
        - or:
          - number: 0xFF
          - number: 0x100

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/rc4/encrypt-data-using-rc4-prga.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using RC4 via WinAPI
    namespace: data-manipulation/encryption/rc4
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::RC4 [C0027.009]
    examples:
      - 2A584DFC657348D164274A12BFF9BBD8:0x404D42
      - 32BB43F8847ECF158C1E96891ED9A28C:0x10003A88
    capa/nursery: false
  features:
    - and:
      - or:
        - number: 0x6801 = CALG_RC4
      - or:
        - api: CryptGenKey
        - api: CryptDeriveKey
        - api: CryptImportKey
      - optional:
        - or:
          - number: 1 = PROV_RSA_FULL
          - api: CryptAcquireContext
          - api: CryptEncrypt
          - api: CryptDecrypt

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/rc4/encrypt-data-using-rc4-via-winapi.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using RC4 with custom key via WinAPI
    namespace: data-manipulation/encryption/rc4
    authors:
      - blaine.stancill@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::RC4 [C0027.009]
    references:
      - https://www.phdcc.com/cryptorc4.htm
    examples:
      - 4E9C546A54E40D0DA89BB4616DD7F8C4:0x140007B70
      - A563C50C5FA0FD541248ACAF72CC4E7D:0x401AF0
    capa/nursery: false
  features:
    - and:
      - api: CryptImportKey
      - number: 0x4C = SimpleBlobRC4KeyTemplate size
      - bytes: 01 02 00 00 01 68 00 00 00 A4 00 00 = SimpleBlobRC4KeyTemplate header
      - number: 0x134 = PrivateKeyWithExponentOfOne size
      - bytes: 07 02 00 00 00 A4 00 00 52 53 41 32 00 02 00 00 01 00 00 00 AB EF FA C6 7D E8 DE FB 68 38 09 92 D9 42 7E 6B 89 9E 21 D7 52 1C 99 3C 17 48 4E 3A 44 02 F2 FA 74 57 DA E4 D3 C0 35 67 FA 6E DF 78 4C 75 35 1C A0 74 49 E3 20 13 71 35 65 DF 12 20 F5 F5 F5 C1 ED 5C 91 36 75 B0 A9 9C 04 DB 0C 8C BF 99 75 13 7E 87 80 4B 71 94 B8 00 A0 7D B7 53 DD 20 63 EE F7 83 41 FE 16 A7 6E DF 21 7D 76 C0 85 D5 65 7F 00 23 57 45 52 02 9D EA 69 AC 1F FD 3F 8C 4A D0 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 64 D5 AA B1 A6 03 18 92 03 AA 31 2E 48 4B 65 20 99 CD C6 0C 15 0C BF 3E FF 78 95 67 B1 74 5B 60 01 00 00 00 00 00 00 00 00 00 00 00 = PrivateKeyWithExponentOfOne
      - match: contain loop # Copies RC4 key in reverse order
      - optional:
        - or:
          - number: 1 = PROV_RSA_FULL
          - api: CryptAcquireContext
          - api: CryptEncrypt

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/rc4/encrypt-data-using-rc4-with-custom-key-via-winapi.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using RSA via embedded library
    namespace: data-manipulation/encryption/rsa
    authors:
      - Ana06
    description: encrypt data using krypton RSA implementation or similar
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::RSA [C0027.011]
    references:
      - https://github.com/ezhangle/krypton/blob/147d69429bfb03cce7113dca6dba36e77f8a9325/src/rsa.c#L232
      - https://github.com/bnoordhuis/mongrel2/blob/3e9b57d82aeb627be0aebfb346199bfdfd67e530/src/crypto/rsa.c#L233
    examples:
      - 009c2377b67997b0da1579f4bbc822c1:0x405CF0
    capa/nursery: false
  features:
    - and:
      # `sub  eax, 3`  Subtract 3 to calculate pads needed
      - instruction:
        - mnemonic: sub
        - number: 3
      # `mov  byte ptr [ecx], 0`  Ensure encryption block is < modulus
      - instruction:
        - mnemonic: mov
        - offset: 0
        - number: 0
      # `mov  byte ptr [edx+1], 2` Set encryption flag
      - instruction:
        - mnemonic: mov
        - offset: 1
        - number: 2
      # `mov  byte ptr [edx+2], 0` Terminate with zero
      - instruction:
        - mnemonic: mov
        - offset: 2
        - number: 0
      # call `get_random_nonzero`, `memcpy`, `bi_import`, `RSA_public`, `bi_export`, and `bi_clear_cache`
      # if the signing code is included, also call `memcpy` and `RSA_private`
      - count(mnemonic(call)): (6,8)
      - optional: # likely in a subfunction
        - match: use bigint function

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/rsa/encrypt-data-using-rsa-via-embedded-library.yml
----------------------------------------------
rule:
  meta:
    name: decrypt data using TEA
    namespace: data-manipulation/encryption/tea
    authors:
      - william.ballenthin@mandiant.com
      - raymond.leong@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
    references:
      - https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm
    examples:
      - 5B99FA01C72CEBC53A76CC72E9581189:0x180001027
      - 7FD2E2E3C88675D877190ABAA3002B55:0x010004EC0
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0x5
          - instruction:
            - mnemonic: shl
            - operand[1].number: 0x4
          - count(mnemonic(shr)): 0x2
          - characteristic: nzxor
      - or:
        - operand[1].number: 0x9E3779B9 = key schedule constant
        - operand[1].number: 0x61C88647 = key schedule constant two's complement
      - operand[1].number: 0xC6EF3720 = sum
      - not:
        - basic block:
          - and:
            - description: q setup only in XXTEA
            - instruction:
              - mnemonic: mov
              - operand[1].number: 0x34
            - instruction:
              - mnemonic: add
              - operand[1].number: 0x6
            - instruction:
              - mnemonic: idiv

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/tea/decrypt-data-using-tea.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using TEA
    namespace: data-manipulation/encryption/tea
    authors:
      - william.ballenthin@mandiant.com
      - raymond.leong@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
    references:
      - https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm
    examples:
      - 44461306A604D2CD9883C2BB623AF276:0x10004810
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0x5
          - instruction:
            - mnemonic: shl
            - operand[1].number: 0x4
          - count(mnemonic(shr)): 0x2
          - characteristic: nzxor
      - or:
        - operand[1].number: 0x9E3779B9 = key schedule constant
        - operand[1].number: 0x61C88647 = key schedule constant two's complement
      - not:
        - or:
          - number: 0xC6EF3720 = sum, only used in decryption
          - basic block:
            - and:
              - description: q setup only in XXTEA
              - instruction:
                - mnemonic: mov
                - operand[1].number: 0x34
              - instruction:
                - mnemonic: add
                - operand[1].number: 0x6
              - instruction:
                - mnemonic: idiv

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/tea/encrypt-data-using-tea.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using XTEA
    namespace: data-manipulation/encryption/xtea
    authors:
      - raymond.leong@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
    references:
      - https://en.wikipedia.org/wiki/XTEA
    examples:
      - 4B9EFD882C49EF7525370FFB5197AD86:0x00001E54
      - A1451E3108E85769302AD25C74757180:0x00408EE0
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - instruction:
            - mnemonic: shl
            - operand[1].number: 0x4
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0x5
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0xB
          - instruction:
            - mnemonic: and
            - operand[1].number: 0x3
          - characteristic: nzxor
      - or:
        - operand[1].number: 0x9E3779B9 = key schedule constant
        - operand[1].number: 0x61C88647 = key schedule constant two's complement

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/xtea/encrypt-data-using-xtea.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using XXTEA
    namespace: data-manipulation/encryption/xxtea
    authors:
      - raymond.leong@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
    references:
      - https://en.wikipedia.org/wiki/XXTEA
    examples:
      - C3699D0C7BD1276184249A487C1F0D7F:0x0040D370
      - 2F9FF544D5CC945B453356F9B20C07D8:0x0040AA10
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - instruction:
            - mnemonic: mov
            - operand[1].number: 0x34
          - instruction:
            - mnemonic: add
            - operand[1].number: 0x6
          - instruction:
            - mnemonic: idiv
      - basic block:
        - and:
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0x3
          - instruction:
            - mnemonic: shr
            - operand[1].number: 0x5
          - instruction:
            - mnemonic: shl
            - operand[1].number: 0x4
          - characteristic: tight loop
          - characteristic: nzxor
      - or:
        - operand[1].number: 0x9E3779B9 = key schedule constant
        - operand[1].number: 0x61C88647 = key schedule constant two's complement
      - not:
        - number: 0xC6EF3720 = tea sum, not used in xxtea

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/encryption/xxtea/encrypt-data-using-xxtea.yml
----------------------------------------------
rule:
  meta:
    name: hash data using djb2
    namespace: data-manipulation/hashing/djb2
    authors:
      - awillia2@cisco.com
      - still@teamt5.org
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Non-Cryptographic Hash::djb2 [C0030.006]
    references:
      - https://twitter.com/r3c0nst/status/1392405576131436546
      - http://www.cse.yorku.ca/~oz/hash.html
    examples:
      - 6be0ae5cb7c3155f70d608fc7670d2d9:0x41DD19
    capa/nursery: false
  features:
    - and:
      - instruction:
        - description: hash = 5381
        - mnemonic: mov
        - number: 5381
      - or:
        - instruction:
          - description: hash << 5
          - mnemonic: shl
          - number: 5
        - instruction:
          - description: hash * 33
          - or:
            - mnemonic: mul
            - mnemonic: imul
          - number: 33

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/hashing/djb2/hash-data-using-djb2.yml
----------------------------------------------
rule:
  meta:
    name: hash data using fnv
    namespace: data-manipulation/hashing/fnv
    authors:
      - moritz.raabe@mandiant.com
      - '@_re_fox'
      - michael.hunhoff@mandiant.com
    description: can be any Fowler-Noll-Vo (FNV) hash variant, including FNV-1, FNV-1a, FNV-0
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Non-Cryptographic Hash::FNV [C0030.005]
    references:
      - https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function
      - http://isthe.com/chongo/tech/comp/fnv/
      - https://create.stephan-brumme.com/fnv-hash/
    examples:
      - ad4229879180e267f431ac6666b6a0a2:0x14007B4D4
      - 09BF850BE5DA44A1C3629A1F62813A83:0x10006010
    capa/nursery: false
  features:
    - and:
      - optional:
        - characteristic: loop
        - number: 0xcbf29ce484222325 = FNV_offset_basis, unused by FNV-0
        - number: 0x811c9dc5 = FNV_offset_basis, unused by FNV-0
        - and:
          - number: 0xcbf29ce4 = FNV_offset_basis 64 bits, 32-bit value
          - number: 0x84222325 = FNV_offset_basis 64 bits, 32-bit value
      - or:
        - number: 0x100000001b3 = FNV prime
        - number: 0x01000193 = FNV prime
        - and:
          - number: 0x100 = FNV prime 64 bits, split in DWORD
          - number: 0x1b3 = FNV prime 64 bits, split in DWORD
      - basic block:
        # FNV-1 hash does multiply then XOR
        # FNV-1a hash does XOR then multiply
        - and:
          - characteristic: nzxor
          - or:
            - mnemonic: imul
            - mnemonic: mul
            - api: _allmul

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/hashing/fnv/hash-data-using-fnv.yml
----------------------------------------------
rule:
  meta:
    name: authenticate HMAC
    namespace: data-manipulation/hmac
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Cryptography::Hashed Message Authentication Code [C0061]
    references:
      - https://tools.ietf.org/html/rfc2104
      - https://tools.ietf.org/html/rfc4634
      - https://github.com/ogay/hmac
    examples:
      - mimikatz.exe_:0x403408
    capa/nursery: false
  features:
    - and:
      # block-sized inner padding, consisting of repeated bytes valued 0x36
      - number: 0x36 = inner padding byte value
      # block-sized outer padding, consisting of repeated bytes valued 0x5c
      - number: 0x5C = outer padding byte value
      - match: contain loop
      - count(characteristic(nzxor)): 2 or more
      - optional:
        - description: block size
        - number: 64 = MD5, SHA-1, SHA-224, or SHA-256
        - number: 128 = SHA-384 or SHA-512

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/data-manipulation/hmac/authenticate-hmac.yml
----------------------------------------------
rule:
  meta:
    name: forwarded export
    namespace: executable/pe/export
    authors:
      - ronnie.salomonsen@mandiant.com
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Execution::Shared Modules [T1129]
    examples:
      - 76FA734236DAA023444DEC26863401DC
    capa/nursery: false
  features:
    - characteristic: forwarded export

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/executable/pe/export/forwarded-export.yml
----------------------------------------------
rule:
  meta:
    name: access .NET resource
    namespace: executable/resource
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - 387f15043f0198fd3a637b0758c2b6dde9ead795c3ed70803426fc355731b173:0x06000084
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - or:
        - api: System.Resources.ResourceManager::ctor
        - api: System.Reflection.Assembly::GetManifestResourceStream

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/executable/resource/access-dotnet-resource.yml
----------------------------------------------
rule:
  meta:
    name: embed dependencies as resources using Fody/Costura
    namespace: executable/resource
    authors:
      - '@johnk3r'
      - '@mr-tz'
    scopes:
      static: file
      dynamic: file
    references:
      - https://www.welivesecurity.com/2021/04/06/janeleiro-time-traveler-new-old-banking-trojan-brazil/
    examples:
      - 387f15043f0198fd3a637b0758c2b6dde9ead795c3ed70803426fc355731b173
    capa/nursery: false
  features:
    - and:
      - match: compiled to the .NET platform
      - or:
        - class: ProcessedByFody
        - namespace: Costura
        - class: Costura.AssemblyLoader
        - string: "ProcessedByFody"

Reason: class (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/executable/resource/embed-dependencies-as-resources-using-fodycostura.yml
----------------------------------------------
rule:
  meta:
    name: contain an embedded PE file
    namespace: executable/subfile/pe
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: file
      dynamic: file
    mbc:
      - Execution::Install Additional Program [B0023]
    examples:
      - Practical Malware Analysis Lab 01-04.exe_:0x4060
    capa/nursery: false
  features:
    - or:
      - count(characteristic(embedded pe)): 1 or more
      - count(string(This program cannot be run in DOS mode.)): 2 or more

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Range" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/executable/subfile/pe/contain-an-embedded-pe-file.yml
----------------------------------------------
rule:
  meta:
    name: disable code signing
    namespace: host-interaction/bootloader
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Subvert Trust Controls::Code Signing Policy Modification [T1553.006]
    examples:
      - 0596C4EA5AA8DEF47F22C85D75AACA95:0x10710B3
    capa/nursery: false
  features:
    - and:
      - match: host-interaction/process/create
      - string: /^bcdedit(\.exe)? -set TESTSIGNING ON/i

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/bootloader/disable-code-signing.yml
----------------------------------------------
rule:
  meta:
    name: manipulate safe mode programs
    namespace: host-interaction/bootloader
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Impair Defenses::Safe Mode Boot [T1562.009]
    examples:
      - 3446b3889a52d81119d8c482a2a282b9:0x409AA8
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - substring: "Control\\SafeBoot\\Minimal\\"
          description: registry key for safe mode, no networking
        - substring: "Control\\SafeBoot\\Network\\"
          description: registry key for safe mode, with networking

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/bootloader/manipulate-safe-mode-programs.yml
----------------------------------------------
rule:
  meta:
    name: read clipboard data
    namespace: host-interaction/clipboard
    authors:
      - michael.hunhoff@mandiant.com
      - anushka.virgaonkar@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Collection::Clipboard Data [T1115]
    references:
      - https://learn.microsoft.com/en-us/windows/win32/dataxchg/using-the-clipboard
    examples:
      - C91887D861D9BD4A5872249B641BC9F9:0x40156F
      - 93dfc146f60bd796eb28d4e4f348f2e4:0x401050
    capa/nursery: false
  features:
    - and:
      - optional:
        - match: open clipboard
        - match: contain loop
        - api: kernel32.GlobalAlloc
        - api: kernel32.GlobalLock
        - api: kernel32.GlobalUnlock
      - or:
        - basic block:
          - and:
            - api: user32.GetClipboardData
            - optional:
              - number: 0x1 = CF_TEXT
              - number: 0x7 = CF_OEMTEXT
              - number: 0xD = CF_UNICODETEXT
        - call:
          - and:
            - api: user32.GetClipboardData
            - optional:
              - number: 0x1 = CF_TEXT
              - number: 0x7 = CF_OEMTEXT
              - number: 0xD = CF_UNICODETEXT
        - api: System.Windows.Forms.Clipboard::GetAudioStream
        - api: System.Windows.Forms.Clipboard::GetData
        - api: System.Windows.Forms.Clipboard::GetDataObject
        - api: System.Windows.Forms.Clipboard::GetFileDropList
        - api: System.Windows.Forms.Clipboard::GetImage
        - api: System.Windows.Forms.Clipboard::GetText

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/clipboard/read-clipboard-data.yml
----------------------------------------------
rule:
  meta:
    name: disable driver code integrity
    namespace: host-interaction/driver
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Impair Defenses::Disable or Modify Tools [T1562.001]
    mbc:
      - Defense Evasion::Disable or Evade Security Tools::Disable Code Integrity [F0004.009]
    references:
      - https://www.fuzzysecurity.com/tutorials/28.html
      - https://j00ru.vexillium.org/2010/06/insight-into-the-driver-signature-enforcement/
    examples:
      - 31CEE4F66CF3B537E3D2D37A71F339F4:0x140004070
    capa/nursery: false
  features:
    - and:
      - or:
        - string: "CiInitialize"
          description: exported symbol name used to resolve code integrity configuration
        - substring: "g_CiEnabled"
          description: non-exported name for code integrity flag
        - substring: "g_CiOptions"
          description: non-exported name for code integrity settings
      - optional:
        - string: /CI.dll/i
          description: code integrity implementation DLL

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/driver/disable-driver-code-integrity.yml
----------------------------------------------
rule:
  meta:
    name: change file permission on Linux
    namespace: host-interaction/file-system
    authors:
      - joakim@intezer.com
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - File System::Set File Attributes [C0050]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x407C68
    capa/nursery: false
  features:
    - and:
      - or:
        - os: android
        - os: linux
      - or:
        - api: chown
        - api: fchown
        - api: lchown
        - api: fchownat
        - api: chmod
        - api: fchmod
        - api: fchmodat

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/change-file-permission-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: create virtual file system in .NET
    namespace: host-interaction/file-system
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Hide Artifacts::Hidden File System [T1564.005]
    mbc:
      - Defense Evasion::Hidden Files and Directories [F0005]
    references:
      - https://learn.microsoft.com/en-us/dotnet/api/system.web.hosting.virtualpathprovider?view=netframework-4.8.1
    examples:
      - be619015f1d5fb13d3bcd48d1b0843759a5e040d8af3da50f2d8f55b5a680e02:0x600000F
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - api: System.Web.Hosting.VirtualPathProvider::ctor

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/create-virtual-file-system-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: get Program Files directory
    namespace: host-interaction/file-system
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Discovery::File and Directory Discovery [T1083]
    examples:
      - BC452CC1128CCF7FA9F76D83CDA79132740414973600FED14509749FE946816E:0x407880
    capa/nursery: false
  features:
    - and:
      - or:
        - number: 0x26 = CSIDL_PROGRAM_FILES
        - number: 0x2A = CSIDL_PROGRAM_FILESX86
      - or:
        - api: shell32.SHGetFolderPath
        - api: shell32.SHGetFolderLocation
        - api: shell32.SHGetSpecialFolderPath
        - api: shell32.SHGetSpecialFolderLocation

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/get-program-files-directory.yml
----------------------------------------------
rule:
  meta:
    name: enumerate files on Linux
    namespace: host-interaction/file-system/files/list
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::File and Directory Discovery [T1083]
    mbc:
      - Discovery::File and Directory Discovery [E1083]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x405438
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - and:
          - match: create or open file
          - or:
            - api: getdents
            - api: getdents64
        - and:
          - api: opendir
          - api: readdir

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/files/list/enumerate-files-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: enumerate files recursively
    namespace: host-interaction/file-system/files/list
    authors:
      - '@_re_fox'
      - anushka.virgaonkar@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Discovery::File and Directory Discovery [T1083]
    mbc:
      - Discovery::File and Directory Discovery [E1083]
    examples:
      - 5f66b82558ca92e54e77f216ef4c066c:0x40640E
    capa/nursery: false
  features:
    - and:
      - or:
        - match: enumerate files on Windows
        - match: enumerate files on Linux
      - characteristic: recursive call

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/files/list/enumerate-files-recursively.yml
----------------------------------------------
rule:
  meta:
    name: read file on Linux
    namespace: host-interaction/file-system/read
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - File System::Read File [C0051]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x4059AD
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - optional:
        - match: create or open file
      - or:
        - api: fgetc
        - api: fgets
        - api: getc
        - api: getchar
        - api: read
        - api: getline
        - api: getdelim
        - api: fgetwc
        - api: getwc
        - api: fscanf
        - api: vfscanf
        - api: fread

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/read/read-file-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: read file via mapping
    namespace: host-interaction/file-system/read
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - File System::Read File [C0051]
    examples:
      - Practical Malware Analysis Lab 01-01.exe_:0x401440
    capa/nursery: false
  features:
    - or:
      - and:
        # static
        - basic block:
          - and:
            - api: kernel32.MapViewOfFile
            - or:
              - number: 4 = FILE_MAP_READ
              - number: 6 = FILE_MAP_WRITE | FILE_MAP_READ
        - optional:
          - api: kernel32.UnmapViewOfFile
          - and:
            - match: get file size
          - basic block:
            - and:
              - api: kernel32.CreateFileMapping
              - or:
                - number: 2 = PAGE_READONLY
                - number: 4 = PAGE_READWRITE
      - and:
        # dynamic
        - call:
          - and:
            - api: kernel32.MapViewOfFile
            - or:
              - number: 4 = FILE_MAP_READ
              - number: 6 = FILE_MAP_WRITE | FILE_MAP_READ
        - optional:
          - api: kernel32.UnmapViewOfFile
          - and:
            - match: get file size
          - call:
            - and:
              - api: kernel32.CreateFileMapping
              - or:
                - number: 2 = PAGE_READONLY
                - number: 4 = PAGE_READWRITE

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/read/read-file-via-mapping.yml
----------------------------------------------
rule:
  meta:
    name: bypass Windows File Protection
    namespace: host-interaction/file-system/windows-file-protection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Defense Evasion::Disable or Evade Security Tools::Bypass Windows File Protection [F0004.007]
    examples:
      - Practical Malware Analysis Lab 01-04.exe_:0x401174
    capa/nursery: false
  features:
    - and:
      - string: "sfc_os.dll"
        description: System File Checker
      - number: 0x2 = SfcTerminateWatcherThread
      - match: link function at runtime on Windows

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/windows-file-protection/bypass-windows-file-protection.yml
----------------------------------------------
rule:
  meta:
    name: write file on Linux
    namespace: host-interaction/file-system/write
    authors:
      - joakim@intezer.com
      - mehunhoff@google.com
    scopes:
      static: instruction
      dynamic: call
    mbc:
      - File System::Writes File [C0052]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x401E14
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: fputc
        - api: fputs
        - api: putc
        - api: write
        - api: fputwc
        - api: putwc
        - api: fputws
        - api: fwrite
        - api: putwchar
        - api: dprintf
        - api: vdprintf
        - api: fprintf
        - api: vfprintf

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/file-system/write/write-file-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: references logon banner
    namespace: host-interaction/gui/logon
    authors:
      - '@_re_fox'
    scopes:
      static: basic block
      dynamic: span of calls
    examples:
      - c3341b7dfbb9d43bca8c812e07b4299f:0x4066FC
    capa/nursery: false
  features:
    - and:
      - substring: "\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
      - or:
        - substring: "LegalNoticeCaption"
        - substring: "LegalNoticeText"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/gui/logon/references-logon-banner.yml
----------------------------------------------
rule:
  meta:
    name: change the wallpaper
    namespace: host-interaction/gui/session
    authors:
      - '@_re_fox'
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Operating System::Wallpaper [C0035]
    examples:
      - 5dd0b130d5c3d40c69e3972f39fd7d62:0x45AC6F
    capa/nursery: false
  features:
    - and:
      - api: SystemParametersInfo
      - number: 0x14 = SPI_SETDESKWALLPAPER
      - number: 0x3 = SPIF_SENDWININICHANGE | SPIF_UPDATEINIFILE

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/gui/session/wallpaper/change-the-wallpaper.yml
----------------------------------------------
rule:
  meta:
    name: hide the Windows taskbar
    namespace: host-interaction/gui/taskbar/hide
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Hide Artifacts [T1564]
    examples:
      - 39C05B15E9834AC93F206BC114D0A00C357C888DB567BA8F5345DA0529CBED41:0x10007250
    capa/nursery: false
  features:
    - and:
      - match: find taskbar
      - match: hide graphical window

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/gui/taskbar/hide/hide-the-windows-taskbar.yml
----------------------------------------------
rule:
  meta:
    name: hide graphical window from taskbar
    namespace: host-interaction/gui/window/hide
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Hide Artifacts::Hidden Window [T1564.003]
    references:
      - https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getwindowlongptrw
      - https://learn.microsoft.com/en-us/windows/win32/winmsg/extended-window-styles
      - https://dreamlayers.blogspot.com/2010/12/hiding-window-from-taskbar-using.html
    examples:
      - 79252f58d486aee8c08a8a7ebd36ae11ab5798b289e7f88e71eacf8637c340cc:0x180004B22
    capa/nursery: false
  features:
    - and:
      - api: GetWindowLongPtr
      - api: SetWindowLongPtr
      - number: 0x0FFFFFFEC = GWL_EXSTYLE (-20)
      - or:
        - instruction:
          - mnemonic: or
          - operand[1].number: 0x80 = WS_EX_TOOLWINDOW
        - instruction:
          - mnemonic: bts
          - operand[1].number: 0x7

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/gui/window/hide/hide-graphical-window-from-taskbar.yml
----------------------------------------------
rule:
  meta:
    name: hide graphical window
    namespace: host-interaction/gui/window/hide
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Hide Artifacts::Hidden Window [T1564.003]
    examples:
      - 39C05B15E9834AC93F206BC114D0A00C357C888DB567BA8F5345DA0529CBED41:0x10007250
    capa/nursery: false
  features:
    - and:
      - number: 0x0 = SW_HIDE
      - api: user32.ShowWindow

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/gui/window/hide/hide-graphical-window.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: enumerate devices by category
    namespace: host-interaction/hardware
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
    references:
      - https://learn.microsoft.com/en-us/windows/win32/api/strmif/nf-strmif-icreatedevenum-createclassenumerator
    examples:
      - Practical Malware Analysis Lab 17-02.dll_:0x10003cc0
    capa/nursery: false
  features:
    - and:
      - and:
        - com/class: SystemDeviceEnum  # 10 5D BE 62 EB 60 D0 11 BD 3B 00 A0 C9 11 CE 86 = SystemDeviceEnum
        - com/interface: ICreateDevEnum  # 22 08 84 29 84 5B D0 11 BD 3B 00 A0 C9 11 CE 86 = ICreateDevEnum
        - offset: 0xC = ICreateDevEnumVtbl.CreateClassEnumerator
      - optional:
        - description: class identifier (CLSID) of the device category
        - com/class: CVidCapClassManager  # 10 B3 0B 86 01 5D D0 11 BD 3B 00 A0 C9 11 CE 86 = CVidCapClassManager
        - com/class: CWaveinClassManager  # 62 A7 D9 33 C8 90 D0 11 BD 43 00 A0 C9 11 CE 86 = CWaveinClassManager

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/hardware/enumerate-devices-by-category.yml
----------------------------------------------
rule:
  meta:
    name: get CPU information
    namespace: host-interaction/hardware/cpu
    authors:
      - moritz.raabe@mandiant.com
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
    examples:
      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A
    capa/nursery: false
  features:
    - or:
      - and:
        - os: windows
        - match: query or enumerate registry value
        - string: /Hardware\\Description\\System\\CentralProcessor/i
      - and:
        - os: linux
        - match: host-interaction/file-system/read
        - string: "/proc/cpuinfo"
      - and:
        - os: linux
        - api: system
        - substring: "/proc/cpuinfo"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/hardware/cpu/get-cpu-information.yml
----------------------------------------------
rule:
  meta:
    name: get number of processors
    namespace: host-interaction/hardware/cpu
    authors:
      - michael.hunhoff@mandiant.com
      - anushka.virgaonkar@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Discovery::System Information Discovery [T1082]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/bed03d2f849d9060c68f8d5905bd204d0cb3f593/al-khaser/AntiVM/Generic.cpp#L361
    examples:
      - al-khaser_x86.exe_:0x432CB0
    capa/nursery: false
  features:
    - or:
      - and:
        - match: PEB access
        - or:
          - and:
            - arch: i386
            - number: 0x64 = PEB->NumberOfProcessors
          - and:
            - arch: amd64
            - number: 0xB8 = PEB->NumberOfProcessors
      - property/read: System.Environment::ProcessorCount

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/hardware/cpu/get-number-of-processors.yml
----------------------------------------------
rule:
  meta:
    name: simulate CTRL ALT DEL
    namespace: host-interaction/hardware/keyboard
    authors:
      - michael.hunhoff@mandiant.com
      - johnk3r
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Hardware::Simulate Hardware::Ctrl-Alt-Del [C0057.001]
    examples:
      - b766cc43d649d30e9f27aff8f7ee7de0:0x406153
    capa/nursery: false
  features:
    - and:
      - optional:
        - basic block:
          - and:
            - or:
              - api: OpenDesktop
              - api: OpenInputDesktop
            - string: "Winlogon"
        - call:
          - and:
            - or:
              - api: OpenDesktop
              - api: OpenInputDesktop
            - string: "Winlogon"
      - or:
        - basic block:
          - and:
            - api: PostMessage
            - number: 0x2E0003 = (MOD_ALT | MOD_CONTROL | VK_DELETE)
            - number: 0x312 = WM_HOTKEY
            - number: 0xFFFF = HWND_BROADCAST
        - call:
          - and:
            - api: PostMessage
            - number: 0x2E0003 = (MOD_ALT | MOD_CONTROL | VK_DELETE)
            - number: 0x312 = WM_HOTKEY
            - number: 0xFFFF = HWND_BROADCAST

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/hardware/keyboard/simulate-ctrl-alt-del.yml
----------------------------------------------
rule:
  meta:
    name: get memory information
    namespace: host-interaction/hardware/memory
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x405438
    capa/nursery: false
  features:
    - or:
      - and:
        - or:
          - os: linux
          - os: android
        - match: host-interaction/file-system/read
        - string: "/proc/meminfo"
      - and:
        - or:
          - os: linux
          - os: android
        - api: system
        - or:
          - substring: "/proc/meminfo"
          - string: /^free/

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/hardware/memory/get-memory-information.yml
----------------------------------------------
rule:
  meta:
    name: enumerate disk properties
    namespace: host-interaction/hardware/storage
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Discovery::System Information Discovery [T1082]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L518
    examples:
      - al-khaser_x86.exe_:0x4369B0
    capa/nursery: false
  features:
    - and:
      - basic block:
        - and:
          - api: setupapi.SetupDiGetClassDevs
          - bytes: 67 E9 36 4D 25 E3 CE 11 BF C1 08 00 2B E1 03 18 = GUID_DEVCLASS_DISKDRIVE
      - api: setupapi.SetupDiEnumDeviceInfo
      - api: setupapi.SetupDiGetDeviceRegistryProperty
      - optional:
        - api: setupapi.SetupDiDestroyDeviceInfoList

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/hardware/storage/enumerate-disk-properties.yml
----------------------------------------------
rule:
  meta:
    name: create new application domain in .NET
    namespace: host-interaction/memory
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    att&ck:
      - Persistence::Hijack Execution Flow [T1574]
    mbc:
      - Persistence::Hijack Execution Flow [F0015]
    references:
      - https://learn.microsoft.com/en-us/dotnet/framework/app-domains/application-domains
      - https://www.rapid7.com/blog/post/2023/05/05/appdomain-manager-injection-new-techniques-for-red-teams/
    examples:
      - 6f6acca4d3696e08af9ed80f237f3542c362ebc2bcc9759bb64aa3f5c007320e
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - class: System.AppDomainManager
      - class: System.AppDomainSetup
      - or:
        - string: "InitializeNewDomain"
        - string: "CreateDomain"

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/memory/create-new-application-domain-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: check mutex and terminate process on Windows
    namespace: host-interaction/mutex
    authors:
      - '@_re_fox'
      - moritz.raabe@mandiant.com
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Process::Check Mutex [C0043]
      - Process::Terminate Process [C0018]
    examples:
      - 1d8fd13c890060464019c0f07b928b1a:0x402eb0
    capa/nursery: false
  features:
    - and:
      - match: check mutex on Windows
      - match: terminate process

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/mutex/check-mutex-and-terminate-process-on-windows.yml
----------------------------------------------
rule:
  meta:
    name: check mutex on Windows
    namespace: host-interaction/mutex
    authors:
      - moritz.raabe@mandiant.com
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Process::Check Mutex [C0043]
    examples:
      - 1d8fd13c890060464019c0f07b928b1a:0x402eb0
    capa/nursery: false
  features:
    - and:
      - match: create or open mutex on Windows
      - or:
        - api: WaitForSingleObject
        - basic block:
          - and:
            - api: GetLastError
            - or:
              - number: 2 = ERROR_FILE_NOT_FOUND
              - number: 0xB7 = ERROR_ALREADY_EXISTS
              - number: 5 = ERROR_ACCESS_DENIED

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/mutex/check-mutex-on-windows.yml
----------------------------------------------
rule:
  meta:
    name: create semaphore on Linux
    namespace: host-interaction/mutex
    authors:
      - '@ramen0x3f'
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - 294b8db1f2702b60fb2e42fdc50c2cee6a5046112da9a5703a548a4fa50477bc:0x408de0
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - api: sem_init

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/mutex/create-semaphore-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: lock file
    namespace: host-interaction/mutex
    authors:
      - joakim@intezer.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Process::Create Mutex [C0042]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x40858F
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - api: fcntl
      - number: 1 = F_WRLCK
      - number: 6 = F_SETLK

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/mutex/lock-file.yml
----------------------------------------------
rule:
  meta:
    name: lock semaphore on Linux
    namespace: host-interaction/mutex
    authors:
      - '@ramen0x3f'
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - 294b8db1f2702b60fb2e42fdc50c2cee6a5046112da9a5703a548a4fa50477bc:0x408e40
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: sem_wait
        - api: sem_timedwait

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/mutex/lock-semaphore-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: unlock semaphore on Linux
    namespace: host-interaction/mutex
    authors:
      - '@ramen0x3f'
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - 294b8db1f2702b60fb2e42fdc50c2cee6a5046112da9a5703a548a4fa50477bc:0x408e40
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - api: sem_post

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/mutex/unlock-semaphore-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: set TCP connection state
    namespace: host-interaction/network/connectivity
    authors:
      - '@johnk3r'
    description: The SetTcpEntry function sets the state of a TCP connection.
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Impair Defenses [T1562]
    references:
      - https://unit42.paloaltonetworks.com/evilgrab-delivered-by-watering-hole-attack-on-president-of-myanmars-website
      - https://github.com/magisterquis/EDRSniper/blob/master/edrsniper.c
    examples:
      - 883bf161937f8dc6e766b07000110254:0x403150
    capa/nursery: false
  features:
    - and:
      - api: iphlpapi.SetTcpEntry
      - number: 12 = MIB_TCP_STATE_DELETE_TCB

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/network/connectivity/set-tcp-connection-state.yml
----------------------------------------------
rule:
  meta:
    name: enumerate domain computers via LDAP
    namespace: host-interaction/network/domain
    authors:
      - awillia2@cisco.com
    description: Looks for an LDAP query and related Windows API calls used to enumerate other computers on the Windows domain that a computer is connected to.
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Network Configuration Discovery [T1016]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/adshlp/nf-adshlp-adsopenobject
      - https://www.vkremez.com/2017/12/lets-learn-introducing-new-trickbot.html
      - https://chuongdong.com/reverse%20engineering/2021/05/23/MountLockerRansomware/
    examples:
      - 1e2791877da02d49998dea79515a89ca:0x6CD41FF8
      - 3808f21e56dede99bc914d90aeabe47a:0x140007144
    capa/nursery: false
  features:
    - and:
      - or:
        - api: activeds.ADsOpenObject
        - api: activeds.#9
      - optional:
        - string: "{001677D0-FD16-11CE-ABC4-02608C9E7553}"
          description: IID_IADsContainer
        - string: "{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}"
          description: IID_IDirectorySearch
        - substring: "LDAP://"
      - or:
        - substring: "(objectClass=computer)"
        - substring: "(objectCategory=computer)"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/network/domain/enumerate-domain-computers-via-ldap.yml
----------------------------------------------
rule:
  meta:
    name: get system information on Windows
    namespace: host-interaction/os/info
    authors:
      - moritz.raabe@mandiant.com
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
    examples:
      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140002280
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - api: kernel32.GetSystemInfo
        - api: kernel32.GetNativeSystemInfo
        - api: NtQuerySystemInformation
        - api: NtQuerySystemInformationEx
        - api: ntdll.RtlGetNativeSystemInformation
        - api: ZwQuerySystemInformation
        - api: ZwQuerySystemInformationEx

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/os/info/get-system-information-on-windows.yml
----------------------------------------------
rule:
  meta:
    name: check OS version
    namespace: host-interaction/os/version
    authors:
      - michael.hunhoff@mandiant.com
      - johnk3r
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Discovery::System Information Discovery [T1082]
    mbc:
      - Discovery::System Information Discovery [E1082]
    examples:
      - 493167E85E45363D09495D0841C30648:0x401000
    capa/nursery: false
  features:
    - and:
      - match: get OS version
      - or:
        - and:
          - instruction:
            - mnemonic: cmp
            - number: 5 = Windows 2000
          - optional:
            - instruction:
              - mnemonic: cmp
              - or:
                - number: 0
                - number: 1 = Windows XP
                - number: 2 = Windows XP 64-bit / Windows Server 2003 / Windows Server 2003 R2
        - and:
          - instruction:
            - mnemonic: cmp
            - number: 6 = Windows Vista / Windows Server 2008
          - optional:
            - instruction:
              - mnemonic: cmp
              - or:
                - number: 0
                - number: 1 = Windows Server 2008 R2 / Windows 7
                - number: 2 = Windows Server 2012 / Windows 8
                - number: 3 = Windows Server 2012 R2 / Windows 8.1
        - and:
          - instruction:
            - mnemonic: cmp
            - number: 10 = Windows Server 2016 / Windows Server 2019 / Windows 10
          - optional:
            - instruction:
              - mnemonic: cmp
              - number: 0

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/os/version/check-os-version.yml
----------------------------------------------
rule:
  meta:
    name: get kernel version
    namespace: host-interaction/os/version
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x405438
    capa/nursery: false
  features:
    - and:
      - os: linux
      - or:
        - api: uname
        - and:
          - api: system
          - string: "uname"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/os/version/get-kernel-version.yml
----------------------------------------------
rule:
  meta:
    name: get Linux distribution
    namespace: host-interaction/os/version
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x405438
    capa/nursery: false
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/read
      - or:
        - string: "/etc/os-release"
        - string: "/etc/lsb-release"
        - string: "/etc/issue"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/os/version/get-linux-distribution.yml
----------------------------------------------
rule:
  meta:
    name: get process filename
    namespace: host-interaction/process
    authors:
      - matthew.williams@mandiant.com
    description: Retrieves the current process' filename. In the example sample, this was part of a sandbox evasion technique that computed and verified the checksum of the sample's filename.
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Discovery::Process Discovery [T1057]
    references:
      - https://learn.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb_ldr_data
      - https://research.openanalysis.net/rhadamanthys/config/ida/shifted%20pointers/peb/_list_entry/_ldr_data_table_entry/2023/01/19/rhadamanthys.html#PEB-Walk-_LDR_DATA_TABLE_ENTRY-and-Shifted-Pointers-in-IDA
    examples:
      - cb948b13a5046a692ec3ed8cc16a9566:0x140013ee2
    capa/nursery: false
  features:
    - or:
      - and:
        - arch: i386
        - characteristic: peb access
        - offset: 0x0C = PEB->Ldr
        - offset: 0x14 = PEB->Ldr->InMemoryOrderModuleList->Flink
        - offset: 0x28 = PEB->Ldr->InMemoryOrderModuleList->Flink->BaseDllName.Buffer

      - and:
        # example:
        # mov     rax, gs:60h     ; TEB.ProcessEnvironmentBlock
        # mov     rcx, [rax+18h]  ; PEB64.Ldr
        # mov     rax, [rcx+20h]  ; PEB_LDR_DATA.InMemoryOrderModuleList.Flink
        # mov     rcx, [rax+50h]  ; LDR_DATA_TABLE_ENTRY.BaseDllName.Buffer
        - arch: amd64
        - characteristic: peb access
        - offset: 0x18 = PEB->Ldr
        - offset: 0x20 = PEB->Ldr->InMemoryOrderModuleList->Flink
        - offset: 0x50 = PEB->Ldr->InMemoryOrderModuleList->Flink->BaseDllName.Buffer

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/get-process-filename.yml
----------------------------------------------
rule:
  meta:
    name: get process heap flags
    namespace: host-interaction/process
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Discovery::Process Discovery [T1057]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/bed03d2f849d9060c68f8d5905bd204d0cb3f593/al-khaser/AntiDebug/ProcessHeap_Flags.cpp#L13
    examples:
      - al-khaser_x86.exe_:0x425470
    capa/nursery: false
  features:
    - and:
      - match: PEB access
      - or:
        - and:
          - arch: i386
          - number: 0x18 = PEB->ProcessHeap
          - or:
            - number: 0x40 = ProcessHeap->HeapFlags >= Vista
            - number: 0xC = ProcessHeap->HeapFlags < Vista
        - and:
          - arch: amd64
          - number: 0x30 = PEB->ProcessHeap
          - or:
            - number: 0x70 = ProcessHeap->HeapFlags >= Vista
            - number: 0x14 = ProcessHeap->HeapFlags < Vista

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/get-process-heap-flags.yml
----------------------------------------------
rule:
  meta:
    name: get process heap force flags
    namespace: host-interaction/process
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Discovery::Process Discovery [T1057]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/bed03d2f849d9060c68f8d5905bd204d0cb3f593/al-khaser/AntiDebug/ProcessHeap_ForceFlags.cpp#L14
    examples:
      - al-khaser_x86.exe_:0x425470
    capa/nursery: false
  features:
    - and:
      - match: PEB access
      - or:
        - and:
          - arch: i386
          - number: 0x18 = PEB->ProcessHeap
          - or:
            - number: 0x44 = ProcessHeap->ForceFlags >= Vista
            - number: 0x10 = ProcessHeap->ForceFlags < Vista
        - and:
          - arch: amd64
          - number: 0x30 = PEB->ProcessHeap
          - or:
            - number: 0x74 = ProcessHeap->ForceFlags >= Vista
            - number: 0x18 = ProcessHeap->ForceFlags < Vista

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/get-process-heap-force-flags.yml
----------------------------------------------
rule:
  meta:
    name: map section object
    namespace: host-interaction/process
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - 61908f4d70ce6f16173e76aa42a8c25a:0x4018F0
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - api: NtMapViewOfSection
        - api: ZwMapViewOfSection
      - optional:
        - api: NtUnmapViewOfSection
        - api: ZwUnmapViewOfSection
        - match: create or open section object

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/map-section-object.yml
----------------------------------------------
rule:
  meta:
    name: create a process with modified I/O handles and window
    namespace: host-interaction/process/create
    authors:
      - matthew.williams@mandiant.com
      - anushka.virgaonkar@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Process::Create Process [C0017]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa
    examples:
      - Practical Malware Analysis Lab 14-02.exe_:0x4011C0
    capa/nursery: false
  features:
    - or:
      - and:
        - or:
          - description: API functions that accept a pointer to a STARTUPINFO structure
          - api: kernel32.CreateProcess
          - api: kernel32.CreateProcessInternal
          - api: advapi32.CreateProcessAsUser
          - api: advapi32.CreateProcessWithLogon
          - api: advapi32.CreateProcessWithToken
        - number: 0x101 = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW
          # STARTF_USESTDHANDLES indicates the hStdInput, hStdOutput, and hStdError members contain additional information
          # STARTF_USESHOWWINDOW indicates the wShowWindow member contains additional information
        - or:
          - and:
            - arch: i386
            - number: 0x44 = StartupInfo.cb (size)
          - and:
            - arch: amd64
            - number: 0x68 = StartupInfo.cb (size)
          # STARTUPINFOEX size values not currently supported by this rule.
        - optional:
          - api: kernel32.GetStartupInfo
      - and:
        - api: System.Diagnostics.Process::Start
        - or:
          - property/write: System.Diagnostics.ProcessStartInfo::UseShellExecute
          - property/write: System.Diagnostics.ProcessStartInfo::Verb
          - property/write: System.Diagnostics.ProcessStartInfo::WindowStyle
          - property/write: System.Diagnostics.ProcessStartInfo::WorkingDirectory
          - property/write: System.Diagnostics.ProcessStartInfo::FileName
          - property/write: System.Diagnostics.ProcessStartInfo::Arguments
          - property/write: System.Diagnostics.ProcessStartInfo::CreateNoWindow
          - property/write: System.Diagnostics.ProcessStartInfo::RedirectStandardOutput
          - property/write: System.Diagnostics.ProcessStartInfo::RedirectStandardInput
          - property/read: System.Diagnostics.Process::StandardOutput
          - property/read: System.Diagnostics.Process::StandardInput

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/create/create-a-process-with-modified-io-handles-and-window.yml
----------------------------------------------
rule:
  meta:
    name: create process on Linux
    namespace: host-interaction/process/create
    authors:
      - joakim@intezer.com
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Process::Create Process [C0017]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x40236D
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: execve
        - and:
          - match: execute syscall
          - arch: aarch64
          - number: 0xdd = execve
        - api: execl
        - api: execlp
        - api: execle
        - api: execv
        - api: execvp
        - api: execvpe
        - api: posix_spawn
        - api: posix_spawnp
        - api: popen
        - api: fork

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/create/create-process-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: create process suspended
    namespace: host-interaction/process/create
    authors:
      - william.ballenthin@mandiant.com
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Process::Create Process::Create Suspended Process [C0017.003]
    references:
      - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/an-in-depth-look-at-mailto-ransomware-part-two-of-three/
      - https://learn.microsoft.com/en-us/windows/win32/procthread/process-creation-flags#flags
    examples:
      - Practical Malware Analysis Lab 03-03.exe_:0x4010EA
    capa/nursery: false
  features:
    - or:
      - and:
        - or:
          - number: 0x08000004 = CREATE_NO_WINDOW | CREATE_SUSPENDED
          - number: 0x800000C = CREATE_SUSPENDED | DETACHED_PROCESS | CREATE_NO_WINDOW
          - number: 4 = CREATE_SUSPENDED
          - number: 2 = DEBUG_ONLY_THIS_PROCESS
        - or:
          - api: kernel32.CreateProcess
          - api: kernel32.CreateProcessInternal
          - api: advapi32.CreateProcessAsUser
          - api: advapi32.CreateProcessWithLogon
          - api: advapi32.CreateProcessWithToken
      - and:
        - or:
          - number: 0x10 = PROCESS_CREATE_FLAGS_CREATE_SUSPENDED
          - number: 0x2000010 = PROCESS_CREATE_FLAGS_CREATE_SUSPENDED | PROCESS_CREATE_FLAGS_NO_WINDOW
          - number: 0x11 = PROCESS_CREATE_FLAGS_CREATE_SUSPENDED | PROCESS_CREATE_FLAGS_BREAKAWAY
        - or:
          - api: ntdll.NtCreateProcessEx
          - api: ZwCreateProcessEx
          - api: ntdll.NtCreateUserProcess
          - api: ntdll.ZwCreateUserProcess
          - api: ntdll.RtlCreateUserProcess

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/create/create-process-suspended.yml
----------------------------------------------
rule:
  meta:
    name: allocate or change RWX memory
    namespace: host-interaction/process/inject
    authors:
      - '@mr-tz'
    scopes:
      static: basic block
      dynamic: span of calls
    mbc:
      - Memory::Allocate Memory [C0007]
    examples:
      - Practical Malware Analysis Lab 03-03.exe_:0x4010EA
      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140001ABA
    capa/nursery: false
  features:
    - and:
      - or:
        - match: allocate memory
        - match: change memory protection
      - or:
        - number: 0x40 = PAGE_EXECUTE_READWRITE
        # lea     r9d, [rcx+40h]  ; flProtect
        # call    cs:VirtualAlloc
        - instruction:
          - mnemonic: lea
          - offset: 0x40 = PAGE_EXECUTE_READWRITE

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/allocate-or-change-rwx-memory.yml
----------------------------------------------
rule:
  meta:
    name: allocate user process RWX memory
    namespace: host-interaction/process/inject
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Process Injection [T1055]
    examples:
      - 493167E85E45363D09495D0841C30648:0x404B00
    capa/nursery: false
  features:
    - and:
      - match: attach user process memory
      - match: allocate or change RWX memory
      - number: 0xFFFFFFFF = NtCurrentProcess()
      - optional:
        - match: find process by PID

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/allocate-user-process-rwx-memory.yml
----------------------------------------------
rule:
  meta:
    name: free user process memory
    namespace: host-interaction/process/inject
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Process Injection [T1055]
    mbc:
      - Memory::Free Memory [C0044]
    examples:
      - 493167E85E45363D09495D0841C30648:0x404CA0
    capa/nursery: false
  features:
    - and:
      - match: attach user process memory
      - number: 0xFFFFFFFF = NtCurrentProcess()
      - api: ZwFreeVirtualMemory
      - optional:
        - match: find process by PID

Reason: slow byte pattern for YARA search (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/free-user-process-memory.yml
----------------------------------------------
rule:
  meta:
    name: inject APC
    namespace: host-interaction/process/inject
    authors:
      - william.ballenthin@mandiant.com
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Process Injection::Asynchronous Procedure Call [T1055.004]
    examples:
      - al-khaser_x64.exe_:0x140019348
    capa/nursery: false
  features:
    - and:
      - or:
        - match: write process memory
        - match: create or open section object
        - api: kernel32.MapViewOfFile
      - or:
        - api: kernel32.QueueUserAPC
        - api: kernel32.KeInsertQueueApc
        - api: ntdll.NtQueueApcThread
        - api: ntdll.NtQueueApcThreadEx
        - api: ntdll.NtQueueApcThreadEx2
      - optional:
        - or:
          - number: 0x1fffff = THREAD_ALL_ACCESS
          - api: kernel32.CreateProcess
          - api: kernel32.OpenProcess

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/inject-apc.yml
----------------------------------------------
rule:
  meta:
    name: inject dll
    namespace: host-interaction/process/inject
    authors:
      - 0x534a@mailbox.org
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Process Injection::Dynamic-link Library Injection [T1055.001]
    references:
      - Practical Malware Analysis, p. 676
      - https://www.researchgate.net/publication/279155742_A_Novel_Approach_to_Detect_Malware_Based_on_API_Call_Sequence_Analysis
      - https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-part3.pdf
      - https://www.accenture.com/t20180127T003755Z_w_/us-en/_acnmedia/PDF-46/Accenture-Security-Dragonfish-Threat-Analysis.pdf
      - https://unit42.paloaltonetworks.com/unit42-kazuar-multiplatform-espionage-backdoor-api-access/
      - https://www.welivesecurity.com/wp-content/uploads/2018/10/ESET_GreyEnergy.pdf
      - https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/
    examples:
      - Practical Malware Analysis Lab 17-02.dll_:0x1000D10D
    capa/nursery: false
  features:
    - and:
      - optional:
        - or:
          - match: open process
          - match: host-interaction/process/create
      - match: allocate or change RW memory
      - match: write process memory
      - and:
        - or:
          - api: kernel32.GetModuleHandle
          - api: kernel32.GetModuleHandleEx
        - string: "/LoadLibrary[AW]/"
      - match: create thread

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/inject-dll.yml
----------------------------------------------
rule:
  meta:
    name: inject pe
    namespace: host-interaction/process/inject
    authors:
      - 0x534a@mailbox.org
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Process Injection::Portable Executable Injection [T1055.002]
      - Defense Evasion::Reflective Code Loading [T1620]
    references:
      - https://www.elastic.co/de/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process
    examples:
      - ce8d7590182db2e51372a4a04d6a0927a65b2640739f9ec01cfd6c143b1110da:0x4014E0
    capa/nursery: false
  features:
    - and:
      - characteristic: loop
      - optional:
        - or:
          - match: open process
          - match: host-interaction/process/create
      - match: allocate or change RWX memory
      - basic block:
        - description: virtual address offset calculation
        - and:
          - mnemonic: and
          - number: 0x0FFF
      - match: write process memory
      - match: create thread

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/inject-pe.yml
----------------------------------------------
rule:
  meta:
    name: inject thread
    namespace: host-interaction/process/inject
    authors:
      - anamaria.martinezgom@mandiant.com
      - 0x534a@mailbox.org
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Process Injection::Thread Execution Hijacking [T1055.003]
      - Defense Evasion::Reflective Code Loading [T1620]
    examples:
      - Practical Malware Analysis Lab 12-01.exe_:0x4010D0
      - 2D3EDC218A90F03089CC01715A9F047F:0x4027CF
    capa/nursery: false
  features:
    - and:
      - or:
        - match: allocate or change RWX memory
        - match: allocate or change RW memory
      - match: write process memory
      - match: create thread
      - optional:
        - or:
          - match: host-interaction/process/create
          - match: open process
          - number: 0x3000 = MEM_COMMIT or MEM_RESERVE

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/inject-thread.yml
----------------------------------------------
rule:
  meta:
    name: use process Doppelgänging
    namespace: host-interaction/process/inject
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Defense Evasion::Process Injection::Process Doppelgänging [T1055.013]
    examples:
      # proc_doppel64.exe from https://github.com/hasherezade/process_doppelganging/releases/tag/0.2
      - A5D66324DAAEE5672B913AA461D4BD3A
    capa/nursery: false
  features:
    - and:
      - substring: "CreateFileTransacted"
      - or:
        - string: "ZwCreateSection"
        - string: "NtCreateSection"
      - string: "RollbackTransaction"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/use-process-doppelgänging.yml
----------------------------------------------
rule:
  meta:
    name: use process replacement
    namespace: host-interaction/process/inject
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Process Injection::Process Hollowing [T1055.012]
      - Defense Evasion::Reflective Code Loading [T1620]
    references:
      - http://www.autosectools.com/process-hollowing.pdf
      - https://www.andreafortuna.org/2017/10/09/understanding-process-hollowing/
    examples:
      - Practical Malware Analysis Lab 12-02.exe_:0x4010EA
    capa/nursery: false
  features:
    - and:
      - match: create process suspended
      - match: write process memory
      - match: resume thread

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/inject/use-process-replacement.yml
----------------------------------------------
rule:
  meta:
    name: enumerate processes via NtQuerySystemInformation
    namespace: host-interaction/process/list
    authors:
      - '@_re_fox'
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Discovery::Process Discovery [T1057]
      - Discovery::Software Discovery [T1518]
    examples:
      - 31bd8dd48ac0de3d4da340bf29f4d280:0x00401be3
    capa/nursery: false
  features:
    - and:
      - number: 0x5 = SYSTEM_PROCESS_INFORMATION
      - or:
        - api: NtQuerySystemInformation
        - api: NtQuerySystemInformationEx
        - api: ZwQuerySystemInformation
        - api: ZwQuerySystemInformationEx

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/list/enumerate-processes-via-ntquerysysteminformation.yml
----------------------------------------------
rule:
  meta:
    name: terminate process via kill
    namespace: host-interaction/process/terminate
    authors:
      - joakim@intezer.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Process::Terminate Process [C0018]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x402424
    capa/nursery: false
  features:
    - and:
      - os: linux
      - api: kill
      - or:
        - number: 1 = SIGHUP - controlling terminal closed
        - number: 2 = SIGINT - interupt process stream, ctrl-C
        - number: 3 = SIGQUIT - like ctrl-C but with a core dump
        - number: 6 = SIGABRT
        - number: 9 = SIGKILL - terminate immediately/hard kill
        - number: 15 = SIGTERM - terminate whenever/soft kill
        - number: 19 = SIGSTOP - Pause the process / free command line, ctrl-Z

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/process/terminate/terminate-process-via-kill.yml
----------------------------------------------
rule:
  meta:
    name: empty recycle bin quietly
    namespace: host-interaction/recycle-bin
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Indicator Removal [T1070]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shemptyrecyclebina
    examples:
      - 276F691A3DF25481F59D79781799E35F:0x1400254E0
    capa/nursery: false
  features:
    - and:
      - api: SHEmptyRecycleBin
      - instruction:
        - or:
          - and:
            - mnemonic: cmp
            - number: 7 = SHERB_NOSOUND|SHERB_NOPROGRESSUI|SHERB_NOCONFIRMATION
          - and:
            - mnemonic: lea
            - offset: 7 = SHERB_NOSOUND|SHERB_NOPROGRESSUI|SHERB_NOCONFIRMATION

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/recycle-bin/empty-recycle-bin-quietly.yml
----------------------------------------------
rule:
  meta:
    name: change registry key timestamp
    namespace: host-interaction/registry
    authors:
      - wballenthin@google.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Modify Registry [T1112]
    references:
      - https://www.inversecos.com/2022/04/malicious-registry-timestamp.html
      - https://chentiangemalc.wordpress.com/2020/03/14/get-set-registry-key-timestamp-with-c-powershell/
      - https://github.com/jschicht/SetRegTime
    examples:
      - e365e3e3febb8a71267b5cd64457744a00e2d61edafb7c98b205b729315e97de:0x70578508
    capa/nursery: false
  features:
    - and:
      - api: NtSetInformationKey
      - number: 8 = sizeof(KEY_WRITE_TIME_INFORMATION)
      - optional:
        - number: 0 = KEY_SET_INFORMATION_CLASS::KeyWriteTimeInformation

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/registry/change-registry-key-timestamp.yml
----------------------------------------------
rule:
  meta:
    name: continue service
    namespace: host-interaction/service
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Create or Modify System Process::Windows Service [T1543.003]
    examples:
      - Practical Malware Analysis Lab 17-02.dll_:0x1000bd79
    capa/nursery: false
  features:
    - and:
      - optional:
        - match: get service handle
      - or:
        - basic block:
          - and:
            - number: 0x3 = SERVICE_CONTROL_CONTINUE
            - or:
              - api: advapi32.ControlService
              - api: advapi32.ControlServiceEx
        - call:
          - and:
            - number: 0x3 = SERVICE_CONTROL_CONTINUE
            - or:
              - api: advapi32.ControlService
              - api: advapi32.ControlServiceEx

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/service/continue-service.yml
----------------------------------------------
rule:
  meta:
    name: pause service
    namespace: host-interaction/service
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Create or Modify System Process::Windows Service [T1543.003]
    examples:
      - Practical Malware Analysis Lab 17-02.dll_:0x1000bccd
    capa/nursery: false
  features:
    - and:
      - optional:
        - match: get service handle
      - or:
        - basic block:
          - and:
            - number: 0x2 = SERVICE_CONTROL_PAUSE
            - or:
              - api: advapi32.ControlService
              - api: advapi32.ControlServiceEx
        - call:
          - and:
            - number: 0x2 = SERVICE_CONTROL_PAUSE
            - or:
              - api: advapi32.ControlService
              - api: advapi32.ControlServiceEx

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/service/pause-service.yml
----------------------------------------------
rule:
  meta:
    name: stop service
    namespace: host-interaction/service/stop
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Create or Modify System Process::Windows Service [T1543.003]
      - Impact::Service Stop [T1489]
    examples:
      - E544A4D616B60147D9774B48C2B65EF2:0x402140
    capa/nursery: false
  features:
    - and:
      - optional:
        - match: get service handle
      - or:
        - basic block:
          - and:
            - number: 0x1 = SERVICE_CONTROL_STOP
            - or:
              - api: advapi32.ControlService
              - api: advapi32.ControlServiceEx
        - call:
          - and:
            - number: 0x1 = SERVICE_CONTROL_STOP
            - or:
              - api: advapi32.ControlService
              - api: advapi32.ControlServiceEx

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/service/stop/stop-service.yml
----------------------------------------------
rule:
  meta:
    name: get current user on Linux
    namespace: host-interaction/session
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Owner/User Discovery [T1033]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x405438
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: geteuid
        - api: getpwuid
        - api: getlogin
        - api: getlogin_r
        - api: cuserid

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/session/get-current-user-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get installed programs
    namespace: host-interaction/software
    authors:
      - moritz.raabe@mandiant.com
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Discovery::Software Discovery [T1518]
    examples:
      - 7204e3efc2434012e13ca939db0d0b02:0x00412760
    capa/nursery: false
  features:
    - and:
      - match: create or open registry key
      - string: /SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall/i
      - characteristic: loop
      - optional:
        - string: "DisplayName"

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/software/get-installed-programs.yml
----------------------------------------------
rule:
  meta:
    name: bypass UAC via token manipulation
    namespace: host-interaction/uac/bypass
    authors:
      - richard.cole@mandiant.com
      - david.cannings@pwc.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Abuse Elevation Control Mechanism::Bypass User Account Control [T1548.002]
    references:
      - https://github.com/hfiref0x/UACME/blob/0a4d2bd67f4872c595f0217ef6ebdcf135186945/Source/Akagi/methods/tyranid.c#L83
      - https://gist.github.com/dezhub/c0fee68d1e06657a45ec39365362fca7
    examples:
      - 2f43138aa75fb12ac482b486cbc98569:0x180001B48
    capa/nursery: false
  features:
    - and:
      # Could expand this to include other processes that run elevated by default.
      - string: "wusa.exe"

      # APIs to run an elevated program. Could expand this to process enumeration.
      - or:
        - api: ShellExecuteEx
        - api: ShellExecuteExW

      # Functions designed to obtain the token
      - or:
        - api: NtOpenProcessToken
        - api: NtFilterToken
        - api: NtDuplicateToken
        # Some samples import the Nt* APIs dynamically, this constant is relatively
        # unique.
        - number: 0xF01FF = TOKEN_ALL_ACCESS

      # Functions designed to (ab)use the token
      - or:
        - api: NtSetInformationToken
        - api: ImpersonateLoggedOnUser
        - api: CreateProcessWithLogon
        - api: CreateProcessWithLogonW

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/uac/bypass/bypass-uac-via-token-manipulation.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: connect to WMI namespace via WbemLocator
    namespace: host-interaction/wmi
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Execution::Windows Management Instrumentation [T1047]
    examples:
      - al-khaser_x64.exe_:0x14001956e
      - al-khaser_x86.exe_:0x00445270
    capa/nursery: false
  features:
    - or:
      - call:
        - description: dynamic detection rule
        - or:
          - and:
            - api: ole32.CoCreateInstance
            - com/class: WbemLocator  # 11 F8 90 45 3A 1D D0 11 89 1F 00 AA 00 4B 2E 24 = CLSID_WbemLocator
          - and:
            - match: host-interaction/process/create
            - or:
              - string: /wmic(|\.exe) /i
              - string: /Register-WMIEvent /i
      - and:
        - description: static detection rule
        - basic block:
          - and:
            - api: ole32.CoCreateInstance
            - com/class: WbemLocator  # 11 F8 90 45 3A 1D D0 11 89 1F 00 AA 00 4B 2E 24 = CLSID_WbemLocator
            - com/interface: IWbemLocator  # 87 A6 12 DC 7F 73 CF 11 88 4D 00 AA 00 4B 2E 24 = IID_IWbemLocator
        - basic block:
          - or:
            - and:
              - arch: i386
              - offset: 0xC = ppv->ConnectServer
            - and:
              - arch: amd64
              - offset: 0x18 = ppv->ConnectServer
        - optional:
          - string: /ROOT\\CIMV2/i
          - string: /ROOT\\DEFAULT/i

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/host-interaction/wmi/connect-to-wmi-namespace-via-wbemlocator.yml
----------------------------------------------
rule:
  meta:
    name: delete drive layout via IOCTL
    namespace: impact/wipe-disk
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Impact::Disk Wipe::Disk Structure Wipe [T1561.002]
    mbc:
      - Impact::Disk Wipe [F0014]
    references:
      - https://www.crowdstrike.com/blog/the-anatomy-of-wiper-malware-part-3/
      - http://www.ioctls.net/
      - https://tyleo.github.io/sharedlib/doc/winapi/winioctl/constant.IOCTL_DISK_DELETE_DRIVE_LAYOUT.html
    examples:
      - 36cc72c55f572fe02836f25516d18fed1de768e7f29af7bdf469b52a3fe2531f:0x401090
    capa/nursery: false
  features:
    - and:
      - or:
        - match: interact with driver via IOCTL
        - characteristic: indirect call
      - number: 0x7c100 = IOCTL_DISK_DELETE_DRIVE_LAYOUT

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/impact/wipe-disk/delete-drive-layout-via-ioctl.yml
----------------------------------------------
rule:
  meta:
    name: overwrite Master Boot Record (MBR)
    namespace: impact/wipe-disk/wipe-mbr
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Impact::Disk Wipe::Disk Structure Wipe [T1561.002]
    mbc:
      - Impact::Disk Wipe [F0014]
    examples:
      - 39C05B15E9834AC93F206BC114D0A00C357C888DB567BA8F5345DA0529CBED41:0x100070A0
    capa/nursery: false
  features:
    - and:
      - string: "\\\\.\\PHYSICALDRIVE0"
      - api: kernel32.WriteFile
      - number: 0x200 = MBR/sector size in bytes
      - or:
        - number: 0x55 = MBR signature constant
        - number: 0xAA = MBR signature constant
      - optional:
        - match: create or open file

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/impact/wipe-disk/wipe-mbr/overwrite-master-boot-record-mbr.yml
----------------------------------------------
rule:
  meta:
    name: (internal) autohotkey file limitation
    namespace: internal/limitation/static
    authors:
      - '@mr-tz'
    description: |
      This sample appears to be compiled with AutoHotkey.

      AutoHotkey is a free, open-source scripting language for Windows that allows users to easily create scripts.
      AutoHotkey was developed from AutoIT and the scripts may be similar.
      capa cannot handle AutoHotkey scripts. This means that the results will be misleading or incomplete.
      You may have to analyze the file manually, using a tool like the AutoIt decompiler MyAut2Exe.
    scopes:
      static: file
      dynamic: file
    examples:
      - 92D8EA10EA30E8B534334A1C9857A455
    capa/nursery: false
  features:
    - or:
      - match: compiler/autohotkey

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/internal/limitation/static/internal-autohotkey-file-limitation.yml
----------------------------------------------
rule:
  meta:
    name: (internal) autoit file limitation
    # capa will detect dozens of capabilities for AutoIt samples,
    # but these are due to the AutoIt runtime, not the payload script.
    # so, don't confuse the user with FP matches - bail instead
    namespace: internal/limitation/static
    authors:
      - william.ballenthin@mandiant.com
    description: |
      This sample appears to be compiled with AutoIt.

      AutoIt is a freeware BASIC-like scripting language designed for automating the Windows GUI.
      capa cannot handle AutoIt scripts. This means that the results will be misleading or incomplete.
      You may have to analyze the file manually, using a tool like the AutoIt decompiler MyAut2Exe.
    scopes:
      static: file
      dynamic: file
    examples:
      - 55D77AB16377A8A314982F723FCC6FAE
    capa/nursery: false
  features:
    - or:
      - match: compiler/autoit

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/internal/limitation/static/internal-autoit-file-limitation.yml
----------------------------------------------
rule:
  meta:
    name: (internal) .NET single file deployment limitation
    namespace: internal/limitation/static
    authors:
      - sara.rincon@mandiant.com
    description: |
      This sample appears to be built with the single-file deployment in .NET.

      Single-file deployment allows all the application-dependent files to be bundled into a single binary.
      The size of the single file in a self-contained application is large since it includes the runtime and the framework libraries.
      The main application and the libraries are contained in the overlay section.
      You may need to extract the runtime configuration files such as *.deps.json and *.runtimeconfig.json files to determine the main .NET library and extract it with the tool SingleFileExtractor.
    scopes:
      static: file
      dynamic: file
    examples:
      - 0da87fccbf7687a6c7ab38087dea8b8f32c2b1fb6546101485b7167d18d9c406
    capa/nursery: false
  features:
    - or:
      - match: executable/dotnet-singlefile

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/internal/limitation/static/internal-dotnet-single-file-deployment-limitation.yml
----------------------------------------------
rule:
  meta:
    name: (internal) installer file limitation
    # capa will likely detect installer specific functionality.
    # this is probably not what the user wants.
    namespace: internal/limitation/static
    authors:
      - william.ballenthin@mandiant.com
    description: |
      This sample appears to be an installer.

      capa cannot handle installers well. This means the results may be misleading or incomplete.
      You should try to understand the install mechanism and analyze created files with capa.
    scopes:
      static: file
      dynamic: file
    examples:
      - 70FD3347786ED7A4A43910E6778EF296
    capa/nursery: false
  features:
    - or:
      - match: executable/installer

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/internal/limitation/static/internal-installer-file-limitation.yml
----------------------------------------------
rule:
  meta:
    name: (internal) packer file limitation
    namespace: internal/limitation/static
    authors:
      - william.ballenthin@mandiant.com
    description: |
      This sample appears to be packed.

      Packed samples have often been obfuscated to hide their logic.
      capa cannot handle obfuscation well using static analysis. This means the results may be misleading or incomplete.
      If possible, you should try to unpack this input file before analyzing it with capa.
      Alternatively, run the sample in a supported sandbox and invoke capa against the report to obtain dynamic analysis results.
    scopes:
      static: file
      dynamic: file
    examples:
      - CD2CBA9E6313E8DF2C1273593E649682
    capa/nursery: false
  features:
    - or:
      - match: anti-analysis/packer

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/internal/limitation/static/internal-packer-file-limitation.yml
----------------------------------------------
rule:
  meta:
    name: (internal) Visual Basic file limitation
    namespace: internal/limitation/static
    authors:
      - '@mr-tz'
    description: |
      This sample appears to be compiled from Visual Basic.

      Visual Basic is a Microsoft programming language that can be compiled to native code or an intermediate
      representation called P-Code.
      capa cannot handle Visual Basic executables well. This means that the results will be misleading or incomplete.
      You may have to analyze the file manually, for example using a tool like VB Decompiler.
    scopes:
      static: file
      dynamic: file
    examples:
      - 9bca6b99e7981208af4c7925b96fb9cf
    capa/nursery: false
  features:
    - or:
      - match: compiler/vb

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/internal/limitation/static/internal-visual-basic-file-limitation.yml
----------------------------------------------
rule:
  meta:
    name: allocate or change RW memory
    authors:
      - 0x534a@mailbox.org
      - '@mr-tz'
    lib: true
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Memory::Allocate Memory [C0007]
    examples:
      - Practical Malware Analysis Lab 17-02.dll_:0x1000D10D
    capa/nursery: false
  features:
    - and:
      - or:
        - match: allocate memory
        - match: change memory protection
      - or:
        - number: 0x4 = PAGE_READWRITE
        # lea     r9d, [rcx+4]  ; flProtect
        # call    cs:VirtualAlloc
        - instruction:
          - mnemonic: lea
          - offset: 0x4 = PAGE_READWRITE

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/allocate-or-change-rw-memory.yml
----------------------------------------------
rule:
  meta:
    name: calculate modulo 256 via x86 assembly
    authors:
      - moritz.raabe@mandiant.com
    lib: true
    scopes:
      static: instruction
      dynamic: unsupported
    mbc:
      - Data::Modulo [C0058]
    examples:
      - 9324D1A8AE37A36AE560C37448C9705A:0x4049A9
    capa/nursery: false
  features:
    #  and ecx, 800000FFh
    #  and ecx, 0FFh
    - and:
      - or:
        - arch: i386
        - arch: amd64
      - mnemonic: and
      - or:
        - number: 0x800000FF
        - number: 0xFF

Reason: arch (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/calculate-modulo-256-via-x86-assembly.yml
----------------------------------------------
rule:
  meta:
    name: contain loop
    authors:
      - moritz.raabe@mandiant.com
    lib: true
    scopes:
      static: function
      dynamic: unsupported
    examples:
      - 08AC667C65D36D6542917655571E61C8:0x406EAA
    capa/nursery: false
  features:
    - or:
      - characteristic: loop
      - characteristic: tight loop
      - characteristic: recursive call

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "characteristic" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/contain-loop.yml
----------------------------------------------
rule:
  meta:
    name: contain pusha popa sequence
    authors:
      - moritz.raabe@mandiant.com
    lib: true
    scopes:
      static: function
      dynamic: unsupported
    examples:
      - a5c70086b3bc4fe64f4e7a0aa452e620:0x35007200
    capa/nursery: false
  features:
    - and:
      - or:
        - count(mnemonic(pusha)): 2 or more
        # vivisect
        - count(mnemonic(pushad)): 2 or more
      - or:
        - count(mnemonic(popa)): 2 or more
        # vivisect
        - count(mnemonic(popad)): 2 or more

Reason: Range (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/contain-pusha-popa-sequence.yml
----------------------------------------------
rule:
  meta:
    name: create or open section object
    authors:
      - william.ballenthin@mandiant.com
    lib: true
    scopes:
      static: function
      dynamic: span of calls
    examples:
      - daa13ae302fe8b618ddbf590537443ef:0x401116
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - api: NtCreateSection
        - api: ZwCreateSection
        - api: NtOpenSection
        - api: ZwOpenSection

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/create-or-open-section-object.yml
----------------------------------------------
rule:
  meta:
    name: delay execution
    authors:
      - michael.hunhoff@mandiant.com
      - '@ramen0x3f'
    lib: true
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp
    examples:
      - al-khaser_x86.exe_:0x449770
      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6
    capa/nursery: false
  features:
    - or:
      - and:
        - os: windows
        - or:
          - api: kernel32.Sleep
          - api: kernel32.SleepEx
          - api: kernel32.WaitForSingleObject
          - api: kernel32.SignalObjectAndWait
          - api: kernel32.WaitForSingleObjectEx
          - api: kernel32.WaitForMultipleObjects
          - api: kernel32.WaitForMultipleObjectsEx
          - api: kernel32.RegisterWaitForSingleObject
          - api: WaitOnAddress
          - api: user32.MsgWaitForMultipleObjects
          - api: user32.MsgWaitForMultipleObjectsEx
          - api: NtDelayExecution
          - api: KeWaitForSingleObject
          - api: KeDelayExecutionThread
      - and:
        - or:
          - os: linux
          - os: android
        - or:
          - api: sleep
          - api: usleep

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/delay-execution.yml
----------------------------------------------
rule:
  meta:
    name: duplicate stdin and stdout
    authors:
      - joakim@intezer.com
    lib: true
    scopes:
      static: basic block
      dynamic: call
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x40236D
    capa/nursery: false
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - api: dup2
      - number: 0 = STDIN
      - number: 1 = STDOUT

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/duplicate-stdin-and-stdout.yml
----------------------------------------------
rule:
  meta:
    name: PEB access
    authors:
      - michael.hunhoff@mandiant.com
    lib: true
    scopes:
      static: basic block
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::Process Environment Block [B0001.019]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp
    examples:
      - al-khaser_x86.exe_:0x420D20
    capa/nursery: false
  features:
    - or:
      - characteristic: peb access
      - and:
        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L41
        - arch: i386
        - characteristic: fs access
        - or:
          # in 0f5d5d07c6533bc6d991836ce79daaa1
          # then we have:
          #
          #     xor edx, edx
          #     mov edx, fs:[edx+30h]
          - offset: 0x30
          - instruction:
            # in the case of CallObfuscator, gs:[rax]
            - mnemonic: add
            - number: 0x30
      - and:
        - arch: amd64
        - characteristic: gs access
        - or:
          - offset: 0x60
          - instruction:
            - mnemonic: add
            - number: 0x60
      - and:
        # WoW64 PEB address is fetched via the WoW64 Thread Environment Block (TEB) at FS:[0x18]-0x2000
        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L45
        - characteristic: fs access
        - instruction:
          - mnemonic: sub
          - number: 0x2000

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/peb-access.yml
----------------------------------------------
rule:
  meta:
    name: validate payment card number using luhn algorithm with lookup table
    authors:
      - '@_re_fox'
    lib: true
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Checksum::Luhn [C0032.002]
    examples:
      - 1d8fd13c890060464019c0f07b928b1a:0x401920
      - 60abaef3fda131ffa20df480cb3f8029:0x4048e0
    capa/nursery: false
  features:
    - and:
      - not:
        - characteristic: nzxor
      - characteristic: loop
        description: Iterate over CC digits
      - basic block:
        - or:
          - 8 or more:
            - description: Digital root lookup table
            - number: 0x0
            - number: 0x2
            - number: 0x4
            - number: 0x6
            - number: 0x8
            - number: 0x1
            - number: 0x3
            - number: 0x5
            - number: 0x7
            - number: 0x9
          - 8 or more:
            - description: Digital root lookup table via neg numbers
            - number: 0x0
            - number: 0x1
            - number: 0x2
            - number: 0x3
            - number: 0x4
            - number: 0xfffffffc
            - number: 0xfffffffd
            - number: 0xfffffffe
            - number: 0xffffffff
      - or:
        - instruction:
          - description: Conversion of chr to int (SUB 0x30)
          - number: 0x30
          - mnemonic: sub
        - instruction:
          - description: Conversion of chr to int (LEA REG,[REG+ -0x30])
          - mnemonic: lea
          - offset: -0x30
      - basic block:
        - or:
          - and:
            - description: Final section returning checkum % 10
            - mnemonic: idiv
            - mnemonic: cdq
            - number: 0xa
            - optional:
              - mnemonic: neg
          - and:
            - description: Compiler optimized returning checkum % 10
            - mnemonic: shr
            - mnemonic: imul
            - number: 0x66666667
            - number: 0x1f
            - number: 0x2
            - optional:
              - mnemonic: neg

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/validate-payment-card-number-using-luhn-algorithm-with-lookup-table.yml
----------------------------------------------
rule:
  meta:
    name: validate payment card number using luhn algorithm with no lookup table
    authors:
      - '@_re_fox'
    lib: true
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Checksum::Luhn [C0032.002]
    examples:
      - 6fcc13563aad936c7d0f3165351cb453:0x4026C0
    capa/nursery: false
  features:
    - and:
      - characteristic: loop
        description: Iterate over CC digits
      - or:
        - basic block:
          - and:
            # 6fcc13563aad936c7d0f3165351cb453:402842
            - or:
              - instruction:
                - mnemonic: shl
                - number: 0x1
              - instruction:
                - mnemonic: imul
                - number: 0x2
              - mnemonic: add = add al, al
            - instruction:
              - mnemonic: cmp
              - number: 0x9
            - description: Digital Root check number*2 < 0x9
        - and:
          - instruction:
            - mnemonic: cmp
            - number: 0x9
            - description: Compare number to 0x9 for Digital Root
          - basic block:
            - or:
              - instruction:
                - mnemonic: imul
                - number: 0x2
              - instruction:
                - mnemonic: shl
                - number: 0x1
              - mnemonic: add = add al, al
              - description: 2*Number for Digital Root
      - or:
        - instruction:
          # 6fcc13563aad936c7d0f3165351cb453:0x402820
          - mnemonic: sub
          - number: 0x30
          - description: Conversion of chr to int (SUB 0x30)
        - instruction:
          - offset: -0x30
          - mnemonic: lea
          - description: Conversion of chr to int (LEA REG,[REG+ -0x30])
      - basic block:
        - or:
          - and:
            # 6fcc13563aad936c7d0f3165351cb453:0x402857
            - or:
              - mnemonic: div
              - and:
                - mnemonic: idiv
                - mnemonic: cdq
            - number: 0xa
            - optional:
              - mnemonic: neg
            - description: Final section returning checkum % 10
          - and:
            - mnemonic: shr
            - mnemonic: imul
            - number: 0x66666667
            - number: 0x1f
            - number: 0x2
            - optional:
              - mnemonic: neg
            - description: Compiler optimized returning checkum % 10

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/lib/validate-payment-card-number-using-luhn-algorithm-with-no-lookup-table.yml
----------------------------------------------
rule:
  meta:
    name: access PEB ldr_data
    namespace: linking/runtime-linking
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Execution::Shared Modules [T1129]
    references:
      - https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/api/ntpsapi_x/peb_ldr_data.htm
      - https://github.com/d35ha/CallObfuscator/blob/5834aff9ff4511f1408ae4ce80b79737af4ae77b/ShellCode/shell_x64.asm#L8
    examples:
      - 3FDFB2D522E7DEECAAAF2F87420F7E75:0x4117B7
    capa/nursery: false
  features:
    - or:
      - and:
        - arch: i386
        - description: x32

        - match: PEB access

        # x86 Windows uses fs:0 to access the TIB which contains SEH information at offset 0
        # checking for fs:0 and a (possibly unrelated) number or offset often results in false positives

        - offset: 0x0C = PEB.LDR_DATA

        - or:
          - description: resolve a module list
          - offset: 0x0C = PEB.LDR_DATA.InLoadOrderModuleList
          - offset: 0x14 = PEB.LDR_DATA.InMemoryOrderModuleList
          - offset: 0x1C = PEB.LDR_DATA.InInitializationOrderModuleList

      - and:
        - arch: amd64
        - description: x64

        - match: PEB access

        - offset: 0x18 = PEB.LDR_DATA

        - or:
          - description: resolve a module list
          - offset: 0x10 = PEB.LDR_DATA.InLoadOrderModuleList
          - offset: 0x20 = PEB.LDR_DATA.InMemoryOrderModuleList
          - offset: 0x30 = PEB.LDR_DATA.InInitializationOrderModuleList

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/access-peb-ldr_data.yml
----------------------------------------------
rule:
  meta:
    name: get kernel32 base address
    namespace: linking/runtime-linking
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Execution::Shared Modules [T1129]
    references:
      - https://idafchev.github.io/exploit/2017/09/26/writing_windows_shellcode.html
      - https://www.geoffchappell.com/studies/windows/win32/ntdll/structs/ldr_data_table_entry.htm
    examples:
      - 67f8302a2fd28d15f62d6d20d748bfe350334e5353cbdef112bd1f8231b5599d:0x406936
    capa/nursery: false
  features:
    - and:
      # PEB -> PEB.Ldr -> PEB_LDR_DATA.InLoadOrderModuleList.Flink
      - match: access PEB ldr_data
      # -> current module -> ntdll
      - count(offset(0)): 2
      # -> kernel32 -> LDR_DATA_TABLE_ENTRY.DllBase
      - or:
        - and:
          - arch: i386
          - offset: 0x18 = LDR_DATA_TABLE_ENTRY.DllBase
        - and:
          - arch: amd64
          - offset: 0x30 = LDR_DATA_TABLE_ENTRY.DllBase

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/get-kernel32-base-address.yml
----------------------------------------------
rule:
  meta:
    name: get ntdll base address
    namespace: linking/runtime-linking
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Execution::Shared Modules [T1129]
    references:
      - https://idafchev.github.io/exploit/2017/09/26/writing_windows_shellcode.html
      - https://www.geoffchappell.com/studies/windows/win32/ntdll/structs/ldr_data_table_entry.htm
    examples:
      - 67f8302a2fd28d15f62d6d20d748bfe350334e5353cbdef112bd1f8231b5599d:0x40694A
    capa/nursery: false
  features:
    - and:
      # PEB -> PEB.Ldr -> PEB_LDR_DATA.InLoadOrderModuleList.Flink
      - match: access PEB ldr_data
      # -> current module
      - count(offset(0)): 1
      # -> ntdll -> LDR_DATA_TABLE_ENTRY.DllBase
      - or:
        - and:
          - arch: i386
          - offset: 0x18 = LDR_DATA_TABLE_ENTRY.DllBase
        - and:
          - arch: amd64
          - offset: 0x30 = LDR_DATA_TABLE_ENTRY.DllBase

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/get-ntdll-base-address.yml
----------------------------------------------
rule:
  meta:
    name: link function at runtime on Windows
    namespace: linking/runtime-linking
    authors:
      - moritz.raabe@mandiant.com
      - michael.hunhoff@mandiant.com
    scopes:
      static: instruction
      dynamic: call
    att&ck:
      - Execution::Shared Modules [T1129]
    examples:
      - 9324D1A8AE37A36AE560C37448C9705A:0x404130
      - Practical Malware Analysis Lab 01-04.exe_:0x401350
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - api: kernel32.GetProcAddress
        - api: ntdll.LdrGetProcedureAddress

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/link-function-at-runtime-on-windows.yml
----------------------------------------------
rule:
  meta:
    name: link many functions at runtime
    namespace: linking/runtime-linking
    authors:
      - moritz.raabe@mandiant.com
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Execution::Shared Modules [T1129]
    examples:
      - b7b5e1253710d8927cbe07d52d2d2e10:0x401000
    capa/nursery: false
  features:
    - or:
      - count(match(link function at runtime on Windows)): 5 or more
      - count(match(link function at runtime on Linux)): 5 or more

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Range" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/link-many-functions-at-runtime.yml
----------------------------------------------
rule:
  meta:
    name: populate SysWhispers2 syscall list
    namespace: linking/runtime-linking
    authors:
      - still@teamt5.org
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Execution::Shared Modules [T1129]
      - Execution::Native API [T1106]
      - Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]
    references:
      - https://github.com/jthuraisamy/SysWhispers2/blob/main/data/base.c#L32
    examples:
      - 932dab8756ad4ae9a62bde0772d952e4:0x14001BD1E
    capa/nursery: false
  features:
    - and:
      - and:
        - description: check ntdll.dll
        - instruction:
          - description: "to lower case"
          - mnemonic: or
          - operand[1].number: 0x20202020
        - or:
          - instruction:
            - mnemonic: cmp
            - operand[1].number: 0x6C64746E = "ldtn"
          - instruction:
            - mnemonic: cmp
            - operand[1].number: 0x6C642E6C = "ld.l"
      - and:
        - description: check system call starting with 'Zw'
        - instruction:
          - description: check 'Zw'
          - mnemonic: cmp
          - operand[1].number: 0x775a = "wZ"
      - and: # this is optional but this should reduce false positives if any at all
        - description: syscall list sorting
        - instruction:
          - mnemonic: add
          - operand[1].number: 1
        - mnemonic: lea
        - mnemonic: mov

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/populate-syswhispers2-syscall-list.yml
----------------------------------------------
rule:
  meta:
    name: resolve function by Brute Ratel Badger hash
    namespace: linking/runtime-linking
    authors:
      - jakub.jozwiak@mandiant.com
    description: Custom API hashing algorithm used in Brute Ratel Badger (version 1.3 or higher)
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information::Dynamic API Resolution [T1027.007]
    mbc:
      - Defense Evasion::Obfuscated Files or Information [E1027]
    references:
      - https://bruteratel.com/release_notes/releases.txt
    examples:
      - 64ce9ab801d9bef5284b408c3373dd30ba2dc6952c0950c8049be067b5f24530:0x6DB42430
    capa/nursery: false
  features:
    - or:
      - basic block:
        - and:
          - mnemonic: add
          - or:
            - instruction:
              - mnemonic: imul
              - operand[2].number: 0x801
            - and:
              - mnemonic: mul
              - number: 0x801
          - instruction:
            - mnemonic: or
            - operand[1].number: 0x2800000
      - basic block:
        - and:
          - mnemonic: add
          - instruction:
            - mnemonic: shl
            - operand[1].number: 0xB
          - instruction:
            - mnemonic: or
            - operand[1].number: 0x2800000

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/resolve-function-by-brute-ratel-badger-hash.yml
----------------------------------------------
rule:
  meta:
    name: resolve function by FIN8 fasthash
    namespace: linking/runtime-linking
    authors:
      - '@r3c0nst (Frank Boldewin)'
    description: APIHashing algorithm derived from a fasthash implementation in OpenCPN using seeds
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Cryptography::Cryptographic Hash [C0029]
    references:
      - https://www.bitdefender.com/files/News/CaseStudies/study/394/Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en-EN.pdf
      - https://raw.githubusercontent.com/fboldewin/YARA-rules/master/Shellcode.APIHashing.FIN8.yar
    examples:
      - B43FCA5283BFC7022553EFF663683834:0x12F
      - 4BF70EA92979DD88C9761EE848370050:0x28b
    capa/nursery: false
  features:
    - or:
      - basic block:
        - and:
          - description: 64-bit constants
          - mnemonic: mov
          - number: 0x880355F21E6D1965
          - number: 0x2127599BF4325C37
          - mnemonic: add
      - basic block:
        - and:
          - description: 32-bit constants
          - mnemonic: push
          - number: 0x880355F2
          - number: 0x1E6D1965
          - mnemonic: shr
          - mnemonic: xor
      - basic block:
        - and:
          - mnemonic: push
          - number: 0x2127599B
          - mnemonic: shr
          - mnemonic: xor
          - number: 0xF4325C37

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "match" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/runtime-linking/resolve-function-by-fin8-fasthash.yml
----------------------------------------------
rule:
  meta:
    name: linked against libcurl
    namespace: linking/static/libcurl
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: file
      dynamic: file
    examples:
      - A90E5B3454AA71D9700B2EA54615F44B
    capa/nursery: false
  features:
    - or:
      - substring: "CLIENT libcurl"
      - substring: "curl.haxx.se"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/static/libcurl/linked-against-libcurl.yml
----------------------------------------------
rule:
  meta:
    name: linked against CppSQLite3
    namespace: linking/static/sqlite3
    authors:
      - still@teamt5.org
    scopes:
      static: file
      dynamic: file
    examples:
      - 253309d8b3675d3cc61d4bf23aa15d4b
    capa/nursery: false
  features:
    - and:
      - substring: "CppSQLite3DB"
      - substring: "CppSQLite3Query"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/static/sqlite3/linked-against-cppsqlite3.yml
----------------------------------------------
rule:
  meta:
    name: linked against SQLCipher
    namespace: linking/static/sqlite3
    authors:
      - wballenthin@google.com
    description: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.
    scopes:
      static: file
      dynamic: file
    references:
      - https://www.zetetic.net/sqlcipher/
      - https://github.com/sqlcipher/sqlcipher
    examples:
      - 559efe9f3d4864910d5c5edbaadd3972c6dfc3ba887c48aa6728b0093898563f
    capa/nursery: false
  features:
    - or:
      - 3 or more:
        - string: "hexkey"
        - string: "hexrekey"
        - string: "cipher"
        - string: "rekey_cipher"
        - string: "kdf_iter"
        - string: "rekey_kdf_iter"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Some" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/static/sqlite3/linked-against-sqlcipher.yml
----------------------------------------------
rule:
  meta:
    name: linked against sqlite3
    namespace: linking/static/sqlite3
    authors:
      - still@teamt5.org
    scopes:
      static: file
      dynamic: file
    examples:
      - 253309d8b3675d3cc61d4bf23aa15d4b
    capa/nursery: false
  features:
    - or:
      - 3 or more:
        - string: "database corruption"
        - string: "SQLITE_OK"
        - string: "SQLite format 3"
        - string: "sqlite3_extension_init"
        - substring: "cannot INSERT into generated column"
        - substring: "UPSERT not implemented for virtual table"
        - substring: "sqlite3_get_table()"
        - substring: "qualified table names are not allowed on"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Some" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/static/sqlite3/linked-against-sqlite3.yml
----------------------------------------------
rule:
  meta:
    name: linked against TouchSocket
    namespace: linking/static/touchsocket
    authors:
      - still@teamt5.org
    description: TouchSocket is a .NET networking library, supporting a wide variety of protocol types such as WebSocket, RPC, DMTP, Modbus, and more.
    scopes:
      static: file
      dynamic: file
    references:
      - https://github.com/RRQM/TouchSocket/
      - https://www.trendmicro.com/en_us/research/24/i/earth-preta-new-malware-and-strategies.html
    examples:
      - 684cc28e6a7fbd12f23dbc563f06306555ebb870bd727ad60839d4ff26e7f3b2
    capa/nursery: false
  features:
    - and:
      - or:
        - match: compiled to the .NET platform
        - match: compiled with .NET AoT
      - 3 or more:
        - substring: "TouchSocket"
        - substring: "TouchSocket.Core"
        - substring: "TouchSocket.Dmtp"
        - substring: "TouchSocket.Modbus"
        - substring: "BinarySerialize"
        - substring: "BinaryDeserialize"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/linking/static/touchsocket/linked-against-touchsocket.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: execute VBScript Javascript or JScript in memory
    namespace: load-code
    authors:
      - blas.kojusner@mandiant.com
    description: the sample may execute 32-bit VBScript, JavaScript, or JScript (32-bit)
    scopes:
      static: function
      dynamic: unsupported
    references:
      - https://gist.github.com/odzhan/d18145b9538a3653be2f9a580b53b063
    examples:
      - 65B1EA6E5254D458C602504CEEDA5E05:0x401160
    capa/nursery: false
  features:
    - and:
      - api: CoCreateInstance
      - bytes: E1 2A 1A BB F9 A4 CF 11 8F 20 00 80 5F 2C D0 64 = IID_IActiveScript
      - bytes: E2 2A 1A BB F9 A4 CF 11 8F 20 00 80 5F 2C D0 64 = IID_IActiveScriptParse32
      - operand[0].number: 0x2 = SCRIPTSTATE_CONNECTED
      - operand[1].offset: 0x14 = ParseScriptText

Reason: operand[0].number (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/execute-vbscript-javascript-or-jscript-in-memory.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: load Windows Common Language Runtime
    namespace: load-code/dotnet
    authors:
      - michael.hunhoff@mandiant.com
      - blas.kojusner@mandiant.com
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    references:
      - https://modexp.wordpress.com/2019/05/10/dotnet-loader-shellcode/
      - https://github.com/TheWover/donut/blob/master/loader/inmem_dotnet.c
    examples:
      - 6CD1315F6F2FA4F8EE2B98BB3CA0A994:0x140001030
    capa/nursery: false
  features:
    - or:
      - and:
        - description: .NET Framework versions 2.0, 3.0, 3.5
        - or:
          - api: mscoree.CorBindToRuntime
          - api: mscoree.CorBindToRuntimeEx
          - api: mscoree.CorBindToRuntimeHost
          - api: mscoree.CorBindToRuntimeByCfg
          - api: mscoree.CorBindToCurrentRuntime
          - api: ole32.CoCreateInstance
          - basic block:
            - and:
              - or:
                - string: "CorBindToRuntime"
                - string: "CorBindToRuntimeEx"
                - string: "CorBindToRuntimeHost"
                - string: "CorBindToRuntimeByCfg"
                - string: "CorBindToCurrentRuntime"
                - string: "CoCreateInstance"
              - match: link function at runtime on Windows
        - bytes: 23 67 2F CB 3A AB D2 11 9C 40 00 C0 4F A3 0A 3E = CLSID_CorRuntimeHost
        - bytes: 22 67 2F CB 3A AB D2 11 9C 40 00 C0 4F A3 0A 3E = IID_ICorRuntimeHost
      - and:
        - description: .NET Framework version 4.x
        - or:
          - api: mscoree.CLRCreateInstance
          - basic block:
            - and:
              - string: "CLRCreateInstance"
              - match: link function at runtime on Windows
        - bytes: 8D 18 80 92 8E 0E 67 48 B3 0C 7F A8 38 84 E8 DE = CLSID_CLRMetaHost
        - bytes: 9E DB 32 D3 B3 B9 25 41 82 07 A1 48 84 F5 32 16 = IID_ICLRMetaHost

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/dotnet/load-windows-common-language-runtime.yml
----------------------------------------------
rule:
  meta:
    name: access PE header
    namespace: load-code/pe
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Execution::Shared Modules [T1129]
    examples:
      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x1400018E0
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - api: RtlImageNtHeader
        - api: RtlImageNtHeaderEx

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/access-pe-header.yml
----------------------------------------------
rule:
  meta:
    name: enumerate PE sections
    namespace: load-code/pe
    authors:
      - '@Ana06'
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Discovery::Code Discovery::Enumerate PE Sections [B0046.001]
    references:
      - https://0x00sec.org/t/reflective-dll-injection/3080
      - https://www.ired.team/offensive-security/code-injection-process-injection/reflective-dll-injection
    examples:
      - E4C33AC3638EEF68311F8AC0D72483C7:0x401510
    capa/nursery: false
  features:
    - and:
      - os: windows
      # there should be some complexity to functions like this
      - count(basic blocks): 3 or more
      - optional:
        - offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew
      - instruction:
        - or:
          - mnemonic: mov
          - mnemonic: movzx
        - operand[1].offset: 0x6 = IMAGE_NT_HEADERS.FileHeader.NumberOfSections
      - basic block:
        - or:
          - and:
            - description: IMAGE_FIRST_SECTION(nt_header)
            - instruction:
              - or:
                - mnemonic: add
                - mnemonic: mov
                - mnemonic: movzx
              - operand[1].offset: 0x14 = IMAGE_NT_HEADERS.FileHeader.SizeOfOptionalHeader
            - operand[1].offset: 0x18 = FileHeader.SizeOfOptionalHeader
          - and:
            - description: (DWORD)dll_raw + dos_header->e_lfanew + sizeof(IMAGE_NT_HEADERS) + sizeof(IMAGE_SECTION_HEADER) * i
            - number: 0x28 = sizeof(IMAGE_SECTION_HEADER)
            - or:
              - and:
                - arch: i386
                - operand[1].offset: 0xF8 = sizeof(IMAGE_NT_HEADERS32)
              - and:
                - arch: amd64
                - operand[1].offset: 0x108 = sizeof(IMAGE_NT_HEADERS64)
      - 2 or more:
        - operand[1].offset: 0xC = IMAGE_SECTION_HEADER.VirtualAddress
        - operand[1].offset: 0x14 = IMAGE_SECTION_HEADER.PointerToRawData
        - operand[1].offset: 0x10 = IMAGE_SECTION_HEADER.SizeOfRawData
        # there's also offset 0x8 = IMAGE_SECTION_HEADER.Misc.PhysicalAddress, but it's likely too common
      - not:
        # non-zeroing XOR was observed in FPs
        - characteristic: nzxor

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/enumerate-pe-sections.yml
----------------------------------------------
rule:
  meta:
    name: inject DLL reflectively
    namespace: load-code/pe
    authors:
      - '@Ana06'
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Process Injection::Dynamic-link Library Injection [T1055.001]
      - Defense Evasion::Reflective Code Loading [T1620]
    references:
      - https://0x00sec.org/t/reflective-dll-injection/3080
      - https://www.ired.team/offensive-security/code-injection-process-injection/reflective-dll-injection
    examples:
      - E4C33AC3638EEF68311F8AC0D72483C7:0x401510
    capa/nursery: false
  features:
    - and:
      - os: windows
      - match: enumerate PE sections
      - match: rebuild import table
      - basic block:
        - and:
          - offset: 0x28 = IMAGE_NT_HEADERS.OptionalHeader.AddressOfEntryPoint
          - number: 0x1 = DLL_PROCESS_ATTACH
          - characteristic: indirect call = call entry point
      - optional:
        - match: inspect section memory permissions

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/inject-dll-reflectively.yml
----------------------------------------------
rule:
  meta:
    name: inspect section memory permissions
    namespace: load-code/pe
    authors:
      - '@Ana06'
    description: "translate section memory permissions (specified in the 'Characteristics' field of the image section header) into page protection constants"
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Discovery::Code Discovery::Inspect Section Memory Permissions [B0046.002]
    examples:
      - E4C33AC3638EEF68311F8AC0D72483C7:0x401480
    capa/nursery: false
  features:
    - and:
      - os: windows
      - 3 or more:
        - and:
          - number: 0x40000000 = IMAGE_SCN_MEM_READ
          - number: 0x2 = PAGE_READONLY
        - and:
          - number: 0x20000000 = IMAGE_SCN_MEM_EXECUTE
          - number: 0x10 = PAGE_EXECUTE
        - and:
          - or:
            - number: 0x60000000 = IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_EXECUTE
            - and:
              - number: 0x40000000 = IMAGE_SCN_MEM_READ
              - number: 0x20000000 = IMAGE_SCN_MEM_EXECUTE
          - number: 0x20 = PAGE_EXECUTE_READ
        - and:
          - or:
            - number: 0xC0000000 = IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_WRITE
            - and:
              - number: 0x40000000 = IMAGE_SCN_MEM_READ
              - number: 0x80000000 = IMAGE_SCN_MEM_WRITE
          - number: 0x4 = PAGE_READWRITE
        - and:
          - or:
            - number: 0xE0000000 = IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_WRITE | IMAGE_SCN_MEM_EXECUTE
            - and:
              - number: 0x40000000 = IMAGE_SCN_MEM_READ
              - number: 0x80000000 = IMAGE_SCN_MEM_WRITE
              - number: 0x20000000 = IMAGE_SCN_MEM_EXECUTE
          - number: 0x40 = PAGE_EXECUTE_READWRITE
      - optional:
        - number: 0x1 = PAGE_NOACCESS

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/inspect-section-memory-permissions.yml
----------------------------------------------
rule:
  meta:
    name: parse PE header
    namespace: load-code/pe
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Execution::Shared Modules [T1129]
    examples:
      - 9324D1A8AE37A36AE560C37448C9705A:0x403DD0
    capa/nursery: false
  features:
    - and:
      - os: windows
      - and:
        - mnemonic: cmp
        - or:
          - number: 0x4550 = IMAGE_NT_SIGNATURE (PE)
          - and:
            - number: 0x50
            - number: 0x45
        - or:
          - number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ)
          - and:
            - number: 0x4D
            - number: 0x5A
        - optional:
          - and:
            - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew
            - or:
              - and:
                - arch: i386
                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage
                - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase
              - and:
                - arch: amd64
                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage
                - operand[1].offset: 0x30 = IMAGE_NT_HEADERS64.OptionalHeader.ImageBase
          - basic block:
            - and:
              - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew
              - 3 or more:
                - operand[1].offset: 0x4 = IMAGE_NT_HEADERS.FileHeader.Machine
                - operand[1].offset: 0x6 = IMAGE_NT_HEADERS.FileHeader.NumberOfSections
                - operand[1].offset: 0x14 = IMAGE_NT_HEADERS.FileHeader.SizeOfOptionalHeader
                - operand[1].offset: 0x16 = IMAGE_NT_HEADERS.FileHeader.Characteristics
                - operand[1].offset: 0x28 = IMAGE_NT_HEADERS.OptionalHeader.AddressOfEntryPoint  # for 32 and 64 bit
                - or:
                  - and:
                    - arch: i386
                    - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase
                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage
                  - and:
                    - arch: amd64
                    - operand[1].offset: 0x30 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase
                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/parse-pe-header.yml
----------------------------------------------
rule:
  meta:
    name: rebuild import table
    namespace: load-code/pe
    authors:
      - '@Ana06'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Defense Evasion::Hijack Execution Flow::Import Address Table Hooking [F0015.003]
    references:
      - https://0x00sec.org/t/reflective-dll-injection/3080
      - https://www.ired.team/offensive-security/code-injection-process-injection/reflective-dll-injection
    examples:
      - E4C33AC3638EEF68311F8AC0D72483C7:0x401510
    capa/nursery: false
  features:
    - and:
      - os: windows
      - offset: 0x7C = IMAGE_NT_HEADERS.OptionalHeader.DataDirectory.Size
      - offset: 0x78 = IMAGE_NT_HEADERS.OptionalHeader.DataDirectory.VirtualAddress
      - basic block:
        - and:
          - offset: 0xC = IMAGE_IMPORT_DESCRIPTOR.Name
          - api: LoadLibraryA
      - offset: 0x10 = IMAGE_IMPORT_DESCRIPTOR.FirstThunk
      - api: GetProcAddress
      - optional:
        - description: import by ordinal
        - or:
          - and:
            - arch: i386
            - number: 0x80000000 = IMAGE_SNAP_BY_ORDINAL32
          - and:
            - arch: amd64
            - number: 0x8000000000000000 = IMAGE_SNAP_BY_ORDINAL64
          - number: 0xFFFF = IMAGE_ORDINAL
          - number: 0x2 = thunk->u1.AddressOfData

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/rebuild-import-table.yml
----------------------------------------------
rule:
  meta:
    name: resolve function by parsing PE exports
    namespace: load-code/pe
    authors:
      - sara-rn
    scopes:
      static: function
      dynamic: unsupported
    examples:
      - 73CE04892E5F39EC82B00C02FC04C70F:0x406BA1
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - characteristic: loop
        - mnemonic: movzx
      - and:
        - offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew
        - or:
          - and:
            - arch: i386
            - offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]
          - and:
            - arch: amd64
            - offset: 0x88 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]
        - 3 or more:
          - offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions
          - offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals
          - offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames
          - offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames
          - offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions
      - optional:
        - or:
          - api: LoadLibrary
          - api: strcmp

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/pe/resolve-function-by-parsing-pe-exports.yml
----------------------------------------------
rule:
  meta:
    name: execute shellcode via CopyFile2
    namespace: load-code/shellcode
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://github.com/S4R1N/AlternativeShellcodeExec/blob/master/CopyFile2/CopyFile2.cpp
    examples:
      - c2bb17c12975ea61ff43a71afd9c3ff111d018af161859abae0bdb0b3dae98f9:0x140001010
    capa/nursery: false
  features:
    - and:
      - match: allocate or change RWX memory
      - api: CopyFile2
      - api: DeleteFileW
      - number: 0x00000001 = COPY_FILE_FAIL_IF_EXISTS
      - number: 0x20 = sizeof(COPYFILE2_EXTENDED_PARAMETERS)

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/shellcode/execute-shellcode-via-copyfile2.yml
----------------------------------------------
rule:
  meta:
    name: execute shellcode via CreateThreadpoolWait
    namespace: load-code/shellcode
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://github.com/S4R1N/AlternativeShellcodeExec/blob/master/CreateThreadPoolWait/CreateThreadPoolWait.cpp
    examples:
      - a4f1f09a2b9bc87de90891da6c0fca28e2f88fd67034648060cef9862af9a3bf:0x10001010
    capa/nursery: false
  features:
    - and:
      - match: allocate or change RWX memory
      - api: CreateEvent
      - api: CreateThreadpoolWait
      - api: SetThreadpoolWait
      - or:
        - api: WaitForSingleObject
        - api: WaitForThreadpoolWaitCallbacks

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/shellcode/execute-shellcode-via-createthreadpoolwait.yml
----------------------------------------------
rule:
  meta:
    name: execute shellcode via Windows callback function
    namespace: load-code/shellcode
    authors:
      - ervin.ocampo@mandiant.com
      - jakub.jozwiak@mandiant.com
      - still@teamt5.org
    description: Detect usage of various WinAPI functions that accept callback functions as parameters in order to execute arbitrary shellcode
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Reflective Code Loading [T1620]
    mbc:
      - Defense Evasion::Hijack Execution Flow::Abuse Windows Function Calls [F0015.006]
    references:
      - https://github.com/ChaitanyaHaritash/Callback_Shellcode_Injection
      - https://www.trendmicro.com/en_us/research/22/k/earth-preta-spear-phishing-governments-worldwide.html
      - http://ropgadget.com/posts/abusing_win_functions.html
      - https://github.com/aahmad097/AlternativeShellcodeExec/
      - https://osandamalith.com/2021/04/01/executing-shellcode-via-callbacks/
    examples:
      - 10cd7afd580ee9c222b0a87ff241d306:0x10008BE0
      - 268d61837aa248c1d49a973612a129ce:0x1000CEC0
      - 4a2992b4c7a1573bf7c74065e3bf5b0d:0x1000D050
      - 43db867967c71bd3aaba9a9a3084e7fa:0x140001000
    capa/nursery: false
  features:
    - and:
      - match: allocate or change RWX memory
      - or:
        - api: AddPropSheetPageProc
        - api: CallWindowProc
        - api: CertEnumSystemStore
        - api: CertEnumSystemStoreLocation
        - api: CreateTimerQueueTimer
        - api: CryptEnumOIDInfo
        - and:
          - api: DPA_Create
          - api: DPA_SetPtr
          - api: DPA_EnumCallback
        - and:
          - api: DSA_Create
          - api: DSA_InsertItem
          - api: DSA_EnumCallback
        - api: DrawState
        - api: EnumCalendarInfo
        - api: EnumCalendarInfoEx
        - api: EnumChildWindows
        - api: EnumDateFormats
        - api: EnumDesktops
        - api: EnumDesktopWindows
        - api: EnumDirTree
        - api: EnumDisplayMonitors
        - api: EnumFontFamilies
        - api: EnumFontFamiliesEx
        - api: EnumFonts
        - api: EnumLanguageGroupLocales
        - and:
          - or:
            - api: GetDC
            - api: GetDCEx
          - api: EnumObjects
        - api: EnumProps
        - api: EnumPropsEx
        - api: EnumPwrSchemes
        - api: EnumResourceTypes
        - api: EnumSystemCodePages
        - api: EnumSystemGeoID
        - api: EnumSystemGeoNames
        - api: EnumSystemLanguageGroups
        - api: EnumSystemLocales
        - api: EnumThreadWindows
        - api: EnumTimeFormats
        - api: EnumUILanguages
        - api: EnumWindows
        - api: EnumWindowStations
        - api: EnumerateLoadedModules
        - api: GrayString
        - api: ImmEnumInputContext
        - api: LineDDA
        - and:
          - api: SymInitialize
          - or:
            - api: SymEnumProcesses
            - api: SymRegisterCallback
        - api: VerifierEnumerateResource

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/shellcode/execute-shellcode-via-windows-callback-function.yml
----------------------------------------------
rule:
  meta:
    name: execute shellcode via Windows fibers
    namespace: load-code/shellcode
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Defense Evasion::Process Injection::Injection via Windows Fibers [E1055.m05]
    references:
      - https://www.ired.team/offensive-security/code-injection-process-injection/executing-shellcode-with-createfiber
      - https://github.com/S4R1N/AlternativeShellcodeExec/blob/master/FiberContextEdit/Source.cpp
    examples:
      - f03bdb9fa52f7b61ef03141fefff1498ad2612740b1fdbf6941f1c5af5eee70a:0x4026E0
    capa/nursery: false
  features:
    - and:
      - match: allocate or change RWX memory
      - api: ConvertThreadToFiber
      - api: CreateFiber
      - api: SwitchToFiber

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/shellcode/execute-shellcode-via-windows-fibers.yml
----------------------------------------------
rule:
  meta:
    name: spawn thread to RWX shellcode
    namespace: load-code/shellcode
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Memory::Allocate Memory [C0007]
      - Process::Create Thread [C0038]
    examples:
      - Practical Malware Analysis Lab 19-02.exe_:0x401230
    capa/nursery: false
  features:
    - and:
      - match: allocate or change RWX memory
      - match: create thread

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/load-code/shellcode/spawn-thread-to-rwx-shellcode.yml
----------------------------------------------
rule:
  meta:
    name: match known PlugX module
    namespace: malware-family/plugx
    maec/malware-family: PlugX
    authors:
      - still@teamt5.org
    description: the sample references known PlugX watermarks (hexified YYYYMMDD + command opcode)
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://circl.lu/assets/files/tr-12/tr-12-circl-plugx-analysis-v1.pdf
      - https://www.fireeye.com/blog/threat-research/2014/07/pacific-ring-of-fire-plugx-kaba.html
      - https://www.avira.com/en/blog/new-wave-of-plugx-targets-hong-kong
    examples:
      - 64E9F62840DB2F65FC717CFAF99081F9:0x10024BCB
    capa/nursery: false
  features:
    - and:
      - instruction:
        - description: module timestamp
        - mnemonic: mov
        - operand[0].offset: 0
        - or:
          - operand[1].number: 0x20120225
          - operand[1].number: 0x20120324
          - operand[1].number: 0x20121107
          - operand[1].number: 0x20140613
          - operand[1].number: 0x20190301
          - operand[1].number: 0x20190520
          - operand[1].number: 0x20200208
          - operand[1].number: 0x88888888 # scrubbed timestamp
      - instruction:
        - description: command id
        - mnemonic: mov
        - operand[0].offset: 4
        - or:
          - operand[1].number: 0x1001 = get system information
          - operand[1].number: 0x1002 = start pipe comms
          - operand[1].number: 0x1003 = echo input
          - operand[1].number: 0x1005 = restart self
          - operand[1].number: 0x2000 = lock workstation
          - operand[1].number: 0x2001 = shutdown workstation (forced)
          - operand[1].number: 0x2002 = reboot workstation
          - operand[1].number: 0x2003 = shutdown workstation (graceful)
          - operand[1].number: 0x2005 = show messagebox
          - operand[1].number: 0x3000 = get disk information
          - operand[1].number: 0x3001 = search directory for files
          - operand[1].number: 0x3004 = read file
          - operand[1].number: 0x3007 = write file
          - operand[1].number: 0x300A = create directory
          - operand[1].number: 0x300B = check if file exists
          - operand[1].number: 0x300C = create a new Windows desktop
          - operand[1].number: 0x300D = PerformSH_FileOperation
          - operand[1].number: 0x300E = ExpandEnvironmentVariable
          - operand[1].number: 0x300F = get current PlugX module directory
          - operand[1].number: 0x4000 = create remote desktop thread
          - operand[1].number: 0x4004 = send mouse event
          - operand[1].number: 0x4005 = send keyboard event
          - operand[1].number: 0x4006 = send CTRL-Alt-Delete
          - operand[1].number: 0x4100 = take screenshot
          - operand[1].number: 0x5000 = create process
          - operand[1].number: 0x5001 = enumerate processes
          - operand[1].number: 0x5002 = kill process
          - operand[1].number: 0x6000 = query service config
          - operand[1].number: 0x6001 = change service config (forced)
          - operand[1].number: 0x6002 = start service
          - operand[1].number: 0x6003 = control service
          - operand[1].number: 0x6004 = delete service
          - operand[1].number: 0x7002 = create remote shell
          - operand[1].number: 0x7100 = create telnet server
          - operand[1].number: 0x9000 = enumerate registry keys
          - operand[1].number: 0x9001 = create registry key
          - operand[1].number: 0x9002 = delete registry key
          - operand[1].number: 0x9003 = copy registry key
          - operand[1].number: 0x9004 = enumerate registry values
          - operand[1].number: 0x9005 = set registry value
          - operand[1].number: 0x9006 = delete registry value
          - operand[1].number: 0x9007 = get registry value
          - operand[1].number: 0xA000 = enumerate network resources
          - operand[1].number: 0xB000 = start port mapping
          - operand[1].number: 0xC000 = get sql data source information
          - operand[1].number: 0xC001 = get sql driver description
          - operand[1].number: 0xC002 = execute sql statement
          - operand[1].number: 0xD000 = get TCP table
          - operand[1].number: 0xD001 = get UDP table
          - operand[1].number: 0xD002 = set TCP entry
          - operand[1].number: 0xE000 = start keylogger thread

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/malware-family/plugx/match-known-plugx-module.yml
----------------------------------------------
rule:
  meta:
    name: bypass hidden API restrictions via JNI on Android
    namespace: host-interaction/bypass
    authors:
      - mehunhoff@google.com
    description: Starting in Android 9 (API level 28), the platform restricts which non-SDK interfaces your app can use
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://stackoverflow.com/questions/55970137/bypass-androids-hidden-api-restrictions
  features:
    - and:
      - os: android
      - string: "dalvik/system/VMRuntime"
      - string: "getRuntime"
      - string: "setHiddenApiExemptions"
      - string: "java/lang/String"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/bypass-hidden-api-restrictions-via-jni-on-android.yml
----------------------------------------------
rule:
  meta:
    name: bypass UAC via scheduled task environment variable
    namespace: host-interaction/uac/bypass
    authors:
      - anamaria.martinezgom@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Abuse Elevation Control Mechanism::Bypass User Account Control [T1548.002]
    references:
      - https://www.tiraniddo.dev/2017/05/exploiting-environment-variables-in.html
      - https://enigma0x3.net/2016/07/22/bypassing-uac-on-windows-10-using-disk-cleanup
  features:
    - and:
      - string: "schtasks.exe"
      - string: /Microsoft\\Windows\\DiskCleanup\\SilentCleanup/i
      - match: host-interaction/process/create
      - optional:
        - or:
          - string: "Environment"
          - string: "windir"
          - match: set registry value

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/bypass-uac-via-scheduled-task-environment-variable.yml
----------------------------------------------
rule:
  meta:
    name: capture network configuration via ifconfig
    namespace: collection/network
    authors:
      - joakim@intezeer.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Discovery::System Network Configuration Discovery [T1016]
  features:
    - and:
      - os: linux
      - api: system
      - substring: "ifconfig"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/capture-network-configuration-via-ifconfig.yml
----------------------------------------------
rule:
  meta:
    name: capture screenshot in Go
    namespace: collection/screenshot
    authors:
      - joakim@intezer.com
    description: Detects screenshot capability via WinAPI for Go files.
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Collection::Screen Capture [T1113]
    mbc:
      - Collection::Screen Capture::WinAPI [E1113.m01]
  features:
    - and:
      - match: compiled with Go
      - and:
        - string: "syscall.NewLazyDLL"
          description: Dynamic loading of DLLs
        - or:
          - and:
            - substring: "user32.dll"
            - or:
              - substring: "GetWindowDC"
              - substring: "GetDC"
          - and:
            - substring: "gdi32.dll"
            - or:
              - substring: "BitBlt"
              - substring: "GetDIBits"
        - substring: "CreateCompatibleDC"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/capture-screenshot-in-go.yml
----------------------------------------------
rule:
  meta:
    name: capture webcam video
    namespace: collection/webcam
    authors:
      - '@johnk3r'
    description: Rule that detects a system's webcam being used to capture video
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Collection::Video Capture [T1125]
  features:
    - or:
      # static
      - and:
        - os: windows
        - api: capCreateCaptureWindow
        - basic block:
          - and:
            - api: SendMessage
            - number: 0x43E = WM_CAP_SEQUENCE
        - or:
          - basic block:
            - and:
              - api: SendMessage
              - number: 0x417 = WM_CAP_FILE_SAVEAS
          - basic block:
            - and:
              - api: SendMessage
              - number: 0x414 = WM_CAP_FILE_SET_CAPTURE_FILE
      # dynamic
      - and:
        - os: windows
        - api: capCreateCaptureWindow
        - call:
          - and:
            - api: SendMessage
            - number: 0x43E = WM_CAP_SEQUENCE
        - or:
          - call:
            - and:
              - api: SendMessage
              - number: 0x417 = WM_CAP_FILE_SAVEAS
          - call:
            - and:
              - api: SendMessage
              - number: 0x414 = WM_CAP_FILE_SET_CAPTURE_FILE

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/capture-webcam-video.yml
----------------------------------------------
rule:
  meta:
    name: change memory permission on Linux
    namespace: host-interaction/memory
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: call
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: mprotect
        - api: pkey_mprotect

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/change-memory-permission-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: check file permission on Linux
    namespace: host-interaction/file-system
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: call
  features:
    - and:
      - or:
        - os: android
        - os: linux
      - or:
        - api: access
        - api: faccessat

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-file-permission-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: check for incoming call in .NET on Android
    namespace: host-interaction
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - property/read: Android.Content.Intent::Action
      - string: "android.intent.action.PHONE_STATE"
      - property/read: Android.Telephony.TelephonyManager::ExtraStateRinging

Reason: property (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-incoming-call-in-dotnet-on-android.yml
----------------------------------------------
rule:
  meta:
    name: check for minimum number of windows on screen
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - echernofsky@google.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    references:
      - https://www.crowdstrike.com/blog/guloader-dissection-reveals-new-anti-analysis-techniques-and-code-injection-redundancy/
      - https://elis531989.medium.com/dancing-with-shellcodes-cracking-the-latest-version-of-guloader-75083fb15cb4
  features:
    - and:
      - api: EnumWindows
      - instruction:
        - mnemonic: cmp
        - number: 0xC = minimum number of windows expected

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-minimum-number-of-windows-on-screen.yml
----------------------------------------------
rule:
  meta:
    name: check for outgoing call in .NET on Android
    namespace: host-interaction
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - property/read: Android.Content.Intent::Action
      - string: "android.intent.action.NEW_OUTGOING_CALL"

Reason: property (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-outgoing-call-in-dotnet-on-android.yml
----------------------------------------------
rule:
  meta:
    name: check for process debug object
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::NtQueryInformationProcess [B0001.012]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtQueryInformationProcess_ProcessDebugObject.cpp
  features:
    - and:
      - or:
        - api: kernel32.GetCurrentProcess
        - api: System.Diagnostics.Process::GetCurrentProcess
      - or:
        - basic block:
          - and:
            - or:
              - api: NtQueryInformationProcess
              - api: ZwQueryInformationProcess
            - number: 0x1E = ProcessDebugObjectHandle
        - call:
          - and:
            - or:
              - api: NtQueryInformationProcess
              - api: ZwQueryInformationProcess
            - number: 0x1E = ProcessDebugObjectHandle

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-process-debug-object.yml
----------------------------------------------
rule:
  meta:
    name: check for sandbox via MAC address OUIs in .NET
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - jonathanlepore@google.com
    description: detects sandbox detection via mac address organizationally unique identifiers (OUIs). Based off publicly available CSharpShooter/CheckPlease.cs
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]
    references:
      - https://github.com/mdsecactivebreach/SharpShooter/blob/9aea0b7a723b61c01c21f1e4b55409edf39a5a3b/CSharpShooter/CheckPlease.cs
  features:
    - and:
      - format: dotnet
      - basic block:
        - and:
          - 3 or more:
            - string: /00[:-]?0c[:-]?29/i
            - string: /00[:-]?1c[:-]?14/i
            - string: /00[:-]?50[:-]?56/i
              description: VMware OUIs
            - string: /08[:-]?00[:-]?27/i
              description: PCS Systemtechnik GmbH OUI, potentially related to VirtualBox
          - api: System.Net.NetworkInformation.NetworkInterface::GetPhysicalAddress
          - api: System.Net.NetworkInformation.NetworkInterface::GetAllNetworkInterfaces

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-sandbox-via-mac-address-ouis-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: check for VM using instruction VPCEXT
    # Please be aware: Vivisect does not support "VPCEXT" currently, so this rule works in IDA only.
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - richard.weiss@mandiant.com
    description: Detects virtualization using VPCEXT (visual property container extender) instruction. Execution of this instruction will cause an illegal instruction exception outside of a virtual environment otherwise return 0
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion [T1497]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection::Instruction Testing [B0009.029]
    references:
      - https://unprotect.it/technique/vpcext/
      - https://research.nccgroup.com/2017/12/13/hidden-cobra-volgmer-a-technical-analysis/
      - https://shasaurabh.blogspot.com/2017/07/virtual-machine-detection-techniques.html
  features:
    # vpcext imm8 imm8
    # result in ebx
    # if ebx == 0: Virtual PC detected, else: illegal instruction exception
    - mnemonic: vpcext

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-vm-using-instruction-vpcext.yml
----------------------------------------------
rule:
  meta:
    name: check for Windows sandbox via mutex
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]
    references:
      - https://github.com/LloydLabs/wsb-detect
  features:
    - and:
      - match: check mutex on Windows
      - string: "WindowsSandboxMutex"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-for-windows-sandbox-via-mutex.yml
----------------------------------------------
rule:
  meta:
    name: check if process is running under Android emulator on Android
    namespace: anti-analysis/anti-emulation/android
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: call
    references:
      - https://github.com/happylishang/AntiFakerAndroidChecker/blob/master/antifake/src/main/jni/emulator/emcheck64.c
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - string: "com/snail/antifake/jni/EmulatorDetectUtil"
      - optional:
        - string: "getSystemArch"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-if-process-is-running-under-android-emulator-on-android.yml
----------------------------------------------
rule:
  meta:
    name: check ProcessDebugFlags
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::NtQueryInformationProcess [B0001.012]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtQueryInformationProcess_ProcessDebugFlags.cpp
  features:
    - and:
      - api: NtQueryInformationProcess
      - number: 0x1F = ProcessDebugFlags

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-processdebugflags.yml
----------------------------------------------
rule:
  meta:
    name: check SystemKernelDebuggerInformation
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection [B0001]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtQuerySystemInformation_SystemKernelDebuggerInformation.cpp
  features:
    - and:
      - or:
        - api: NtQuerySystemInformation
        - api: NtQuerySystemInformationEx
        - api: ZwQuerySystemInformation
        - api: ZwQuerySystemInformationEx
      - number: 0x23 = SystemKernelDebuggerInformation

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-systemkerneldebuggerinformation.yml
----------------------------------------------
rule:
  meta:
    name: check thread suspend count exceeded
    authors:
      - ervinocampo@google.com
    scopes:
      static: file
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Debugger Evasion [T1622]
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection [B0001]
    references:
      - https://secret.club/2021/01/04/thread-stuff.html
      - https://research.checkpoint.com/2023/raspberry-robin-anti-evasion-how-to-exploit-analysis/
  features:
    - and:
      - match: create thread bypassing process freeze
      - function:
        - and:
          - or:
            - api: ntdll.NtSuspendThread
            - string: "NtSuspendThread"
          - basic block:
            - and:
              - number: 0xc000004a = STATUS_SUSPEND_COUNT_EXCEEDED
              - mnemonic: cmp

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-thread-suspend-count-exceeded.yml
----------------------------------------------
rule:
  meta:
    name: check thread yield allowed
    namespace: anti-analysis/anti-debugging/debugger-detection
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Anti-Behavioral Analysis::Debugger Detection::NtYieldExecution/SwitchToThread [B0001.015]
    references:
      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtYieldExecution.cpp
  features:
    - and:
      - api: NtYieldExecution
      - match: contain loop
      - instruction:
        - mnemonic: cmp
        - number: 0x40000024 = STATUS_NO_YIELD_PERFORMED

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/check-thread-yield-allowed.yml
----------------------------------------------
rule:
  meta:
    name: collect ssh keys
    namespace: collection
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Credential Access::Unsecured Credentials::Private Keys [T1552.004]
  features:
    - and:
      - match: host-interaction/file-system/read
      - or:
        - substring: "/.ssh/id_rsa"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/collect-ssh-keys.yml
----------------------------------------------
rule:
  meta:
    name: communicate with kernel module via Netlink socket on Linux
    namespace: host-interaction/kernel
    authors:
      - michael.hunhoff@mandiant.com
    description: Netlink is used to transfer information between the kernel and user-space processes (https://man7.org/linux/man-pages/man7/netlink.7.html)
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - os: linux
      - api: socket
      - number: 0x10 = AF_NETLINK

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/communicate-with-kernel-module-via-netlink-socket-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: compiled with ExeScript
    namespace: compiler/exescript
    authors:
      - jonathanlepore@google.com
    scopes:
      static: file
      dynamic: file
    references:
      - https://www.hide-folder.com/overview/hf_7.html
  features:
    - and:
      - format: pe
      - section: .rsrc
      - 9 or more:
        - string: "ExeScript Host"
        - string: "Everstrike Software"
        - string: "#ES.exe.pathname"
        - string: "#ES.script.path"
        - string: "<!-- ----- ExeScript Options Begin -----"
        - string: "----- ExeScript Options End ----- -->"
        - string: "wscript.exe"
        - string: "mshta.exe"
        - string: "cscript.exe"
        - string: "powershell.exe"
        - string: " -Command -"
      - match: execute VBScript Javascript or JScript in memory

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/compiled-with-exescript.yml
----------------------------------------------
rule:
  meta:
    name: compiled with Xamarin
    namespace: compiler/xamarin
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: file
      dynamic: file
  features:
    - or:
      - namespace: Xamarin.Essentials

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "namespace" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/compiled-with-xamarin.yml
----------------------------------------------
rule:
  meta:
    name: contain a thread local storage (.tls) section in .NET
    namespace: executable/pe/section/tls
    authors:
      - michael.hunhoff@mandiant.com
    description: .NET file contains uncommon TLS section
    scopes:
      static: file
      dynamic: file
    references:
      - https://washi.dev/blog/posts/entry-points/
  features:
    - and:
      - match: contain a thread local storage (.tls) section
      - format: dotnet

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/contain-a-thread-local-storage-tls-section-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: covertly decode and write data to Windows directory using indirect calls
    namespace: data-manipulation/encoding/xor
    authors:
      - dan.kelly@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]
      - Data::Encode Data::XOR [C0026.002]
  features:
    - and:
      - match: write file on Windows
      - match: encode data using XOR
      - match: create or open file
      - match: reference absolute stream path on Windows
      - match: contain loop
      - characteristic: indirect call

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/covertly-decode-and-write-data-to-windows-directory-using-indirect-calls.yml
----------------------------------------------
rule:
  meta:
    name: create thread bypassing process freeze
    authors:
      - ervinocampo@google.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Debugger Evasion [T1622]
    mbc:
      - Anti-Behavioral Analysis::Debugger Evasion [B0002]
    references:
      - https://secret.club/2021/01/04/thread-stuff.html
      - https://research.checkpoint.com/2023/raspberry-robin-anti-evasion-how-to-exploit-analysis/
      - https://www.pinvoke.dev/ntdll/ntcreatethreadex
      - https://github.com/winsiderss/systeminformer/blob/master/phnt/include/ntpsapi.h
  features:
    - and:
      - or:
        - api: ntdll.NtCreateThreadEx
        - string: "NtCreateThreadEx"
      - number: 0x40 = Undocumented thread creation flag dubbed as THREAD_CREATE_FLAGS_BYPASS_PROCESS_FREEZE

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/create-thread-bypassing-process-freeze.yml
----------------------------------------------
rule:
  meta:
    name: decode data using Base64 via VBMI lookup table
    namespace: data-manipulation/encoding/base64
    authors:
      - still@teamt5.org
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]
      - Data::Encode Data::Base64 [C0026.001]
    references:
      - https://github.com/powturbo/Turbo-Base64/blob/50fdf37b8517160c772dba357684ea6144befaa9/turbob64v512.c#L124
  features:
    - or:
      - and:
        - mnemonic: shl
        - or:
          - mnemonic: sar
          - mnemonic: shr
        - match: contain loop
        - 3 or more:
          - number: 0x1C1B1A40
          - number: 0x201F1E1D
          - number: 0x40191817
          - number: 0x1211100F
          - number: 0x6050403
          - number: 0x16151413
      - and:
        - or:
          - mnemonic: vmovdqa64
          - mnemonic: vmovdqu64
          - mnemonic: vpmaddubsw
        - match: contain loop
        - or:
          - bytes: 80 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18 19 80 80 80 80 80 80 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 80 80 80 80 80
          - bytes: 02 01 00 06 05 04 0a 09 08 0e 0d 0c 12 11 10 16 15 14 1a 19 18 1e 1d 1c 22 21 20 26 25 24 2a 29 28 2e 2d 2c 32 31 30 36 35 34 3a 39 38 3e 3d 3c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/decode-data-using-base64-via-vbmi-lookup-table.yml
----------------------------------------------
rule:
  meta:
    name: delete file on Linux
    namespace: host-interaction/file-system/delete
    authors:
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - File System::Delete File [C0047]
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: unlink
        - api: unlinkat

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/delete-file-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: delete Windows backup catalog
    namespace: impact/inhibit-system-recovery
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Impact::Inhibit System Recovery [T1490]
  features:
    - and:
      - os: windows
      - string: /wbadmin(\.exe)?\s+delete\s+catalog/i

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/delete-windows-backup-catalog.yml
----------------------------------------------
rule:
  meta:
    name: disable automatic Windows recovery features
    namespace: impact/inhibit-system-recovery
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Impact::Inhibit System Recovery [T1490]
  features:
    - and:
      - os: windows
      - or:
        - string: /bcdedit(\.exe)?\s+/set\s+{default}\s+bootstatuspolicy\s+ignoreallfailures/i
          description: ignore errors and boot normally even if there is a failed boot, shutdown, or checkpoint
        - string: /bcdedit(\.exe)?\s+/set\s+{default}\s+recoveryenabled\s+no/i
          description: disable automatic repair

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/disable-automatic-windows-recovery-features.yml
----------------------------------------------
rule:
  meta:
    name: display service notification message box
    namespace: host-interaction/gui
    authors:
      - anushka.virgaonkar@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - number: 0x200000 = service notification
      - api: System.Windows.Forms.MessageBox::Show

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/display-service-notification-message-box.yml
----------------------------------------------
rule:
  meta:
    name: enable safe mode boot
    namespace: host-interaction/bootloader
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Impair Defenses::Safe Mode Boot [T1562.009]
  features:
    - and:
      - os: windows
      - or:
        - substring: "bootcfg /raw /a /safeboot:network"
          description: XP-era method for safe mode
        - string: "bcdedit /set {current} safeboot minimal"
          description: modern-era method for safe mode, no internet
        - string: "bcdedit /set {current} safeboot network"
          description: modern-era method for safe mode, with internet

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enable-safe-mode-boot.yml
----------------------------------------------
rule:
  meta:
    name: encrypt data using AES via x86 extensions
    namespace: data-manipulation/encryption/aes
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Defense Evasion::Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05]
      - Cryptography::Encrypt Data::AES [C0027.001]
  features:
    - or:
      - mnemonic: aesenc = Perform One Round of an AES Encryption Flow
      - mnemonic: vaesenc
      - mnemonic: aesenclast = Perform Last Round of an AES Encryption Flow
      - mnemonic: vaesenclast
      - mnemonic: aesimc = Perform the AES InvMixColumn Transformation
      - mnemonic: vaesimc
      - mnemonic: aeskeygenassist = AES Round Key Generation Assist
      - mnemonic: vaeskeygenassist

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "mnemonic" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/encrypt-data-using-aes-via-x86-extensions.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: encrypt data using FAKEM cipher
    namespace: data-manipulation/encryption
    authors:
      - michael.hunhoff@mandiant.com
    description: Detect custom encryption cipher used by FAKEM malware family
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Cryptography::Decrypt Data [C0031]
      - Cryptography::Encrypt Data [C0027]
    references:
      - https://attack.mitre.org/software/S0076/
  features:
    - and:
      - characteristic: tight loop
      - count(mnemonic(ror)): 5
      - count(mnemonic(xor)): 5
      - number: 0x59 = Y
      - number: 0x48 = H
      - number: 0x43 = C
      - number: 0x52 = R
      - number: 0x41 = A

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/encrypt-data-using-fakem-cipher.yml
----------------------------------------------
rule:
  meta:
    name: enter debug mode in .NET
    namespace: host-interaction/process/modify
    authors:
      - '@v1bh475u'
    description: Often used by debuggers and malware to attach to and modify other processes.
    scopes:
      static: basic block
      dynamic: call
    references:
      - https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.process.enterdebugmode?view=net-8.0
  features:
    - and:
      - api: System.Diagnostics.Process::EnterDebugMode
      - format: dotnet

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enter-debug-mode-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: enumerate browser history
    namespace: host-interaction/browser/history/list
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - api: ole32.CoCreateInstance
      - bytes: 11 DC A0 AF 13 C3 D0 11 83 1A 00 C0 4F D5 AE 38 = IUrlHistoryStg2
      - bytes: 40 4A 37 3C E4 BA CF 11 BF 7D 00 AA 00 69 46 EE = CUrlHistory
      - offset: 28 = IUrlHistoryStg2.EnumUrls, enumerate IE URLs
      - optional:
        - offset: 20 = IEnumSTATURL.Reset, reset iterator to start of IE URLs
        - offset: 12 = IEnumSTATURL.Next

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enumerate-browser-history.yml
----------------------------------------------
rule:
  meta:
    name: enumerate device drivers on Linux
    namespace: collection
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::Device Driver Discovery [T1652]
  features:
    - and:
      - os: linux
      - api: system
      - or:
        - substring: "lsmod"
        - substring: "modinfo"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enumerate-device-drivers-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: enumerate disk volumes
    namespace: host-interaction/hardware/storage
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
  features:
    - and:
      - match: contain loop
      - or:
        - and:
          - api: kernel32.FindFirstVolume
          - api: kernel32.FindNextVolume
          - optional:
            - api: kernel32.FindVolumeClose
        - and:
          - api: kernel32.FindFirstVolumeMountPoint
          - api: kernel32.FindNextVolumeMountPoint
          - optional:
            - api: kernel32.FindVolumeMountPointClose

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enumerate-disk-volumes.yml
----------------------------------------------
rule:
  meta:
    name: enumerate network shares
    namespace: host-interaction/network
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::Network Share Discovery [T1135]
  features:
    - and:
      - or:
        - api: netapi32.NetShareEnum
        - api: mpr.WNetEnumResource
      - match: contain loop

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enumerate-network-shares.yml
----------------------------------------------
rule:
  meta:
    name: enumerate PE sections in .NET
    namespace: load-code/pe
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Discovery::Code Discovery::Enumerate PE Sections [B0046.001]
  features:
    - and:
      - format: dotnet
      - optional:
        - api: System.Diagnostics.Process::GetCurrentProcess
        - property/read: System.Diagnostics.ProcessModule::BaseAddress
        - api: System.IntPtr::ToInt32
      - api: System.Runtime.InteropServices.Marshal::ReadInt32
      - number: 0x3C = IMAGE_DOS_HEADER.e_lfanew
      - number: 0x6 = IMAGE_NT_HEADERS.FileHeader.NumberOfSections

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enumerate-pe-sections-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: enumerate processes via procfs
    namespace: host-interaction/process/list
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::Process Discovery [T1057]
      - Discovery::Software Discovery [T1518]
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/files/list
      - string: "/proc"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/enumerate-processes-via-procfs.yml
----------------------------------------------
rule:
  meta:
    name: execute shellcode via indirect call
    namespace: load-code/shellcode
    authors:
      - ronnie.salomonsen@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Memory::Allocate Memory [C0007]
  features:
    - and:
      - match: allocate or change RWX memory
      - or:
        - characteristic: indirect call
        - characteristic: cross section flow

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/execute-shellcode-via-indirect-call.yml
----------------------------------------------
rule:
  meta:
    name: execute syscall
    namespace: anti-analysis
    authors:
      - '@kulinacs'
      - '@mr-tz'
      - mehunhoff@google.com
      - still@teamt5.org
    description: may be used to evade hooks or hinder analysis
    scopes:
      static: basic block
      dynamic: unsupported
    references:
      - https://github.com/j00ru/windows-syscalls
      - https://codemachine.com/articles/system_call_instructions.html
      - https://www.felixcloutier.com/x86/sysenter
  features:
    - or:
      - and:
        - or:
          - os: linux
          - os: android
        - api: syscall # https://man7.org/linux/man-pages/man2/syscall.2.html
      - and:
        - or:
          - mnemonic: sysenter
          - mnemonic: syscall
          - instruction:
            - mnemonic: int
            - operand[0].number: 0x2e
        - or:
          - mnemonic: ret
          - mnemonic: retn

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/execute-syscall.yml
----------------------------------------------
rule:
  meta:
    name: generate random numbers using the Delphi LCG
    namespace: data-manipulation/prng/lcg
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    mbc:
      - Cryptography::Generate Pseudo-random Sequence [C0021]
    references:
      - https://en.wikipedia.org/wiki/Linear_congruential_generator
      - https://community.osr.com/discussion/130410/generating-random-numbers
  features:
    - and:
      - instruction:
        - mnemonic: imul
        - number: 0x8088405 = multiplier a
      - mnemonic: inc = increment c

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/generate-random-numbers-using-the-delphi-lcg.yml
----------------------------------------------
rule:
  meta:
    name: get client handle via SChannel
    namespace: data-manipulation/encryption
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/secauthn/getting-schannel-credentials
      - https://docs.microsoft.com/en-us/windows/win32/api/credssp/ns-credssp-credssp_cred
      - https://docs.microsoft.com/en-us/windows/win32/api/credssp/ne-credssp-credspp_submit_type
  features:
    - and:
      - match: get outbound credentials handle via CredSSP
      - number: 4 = CredsspSchannelCreds
      - optional:
        - string: "Microsoft Unified Security Protocol Provider"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-client-handle-via-schannel.yml
----------------------------------------------
rule:
  meta:
    name: get current PID on Linux
    namespace: host-interaction/process
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: getpid
        - api: getppid

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-current-pid-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get current process command line
    namespace: host-interation/process
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - os: linux
      - api: open
      - string: "/proc/self/cmdline"
      - api: read

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-current-process-command-line.yml
----------------------------------------------
rule:
  meta:
    name: get current process file path
    namespace: host-interation/process
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - os: linux
      - api: readlink
      - string: "/proc/self/exe"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-current-process-file-path.yml
----------------------------------------------
rule:
  meta:
    name: get current process filesystem mounts on Linux
    namespace: host-interation/process
    authors:
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - match: create or open file
      - string: "/proc/self/mounts"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-current-process-filesystem-mounts-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get current process memory mapping on Linux
    namespace: host-interation/process
    authors:
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - match: create or open file
      - string: "/proc/self/maps"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-current-process-memory-mapping-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get disk information via IOCTL
    namespace: host-interaction/hardware/storage
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Discovery::System Information Discovery [T1082]
    mbc:
      - Discovery::System Information Discovery [E1082]
    references:
      - https://www.crowdstrike.com/blog/the-anatomy-of-wiper-malware-part-3/
      - http://www.ioctls.net/
  features:
    - and:
      - or:
        - match: interact with driver via IOCTL
        - characteristic: indirect call
      - or:
        - number: 0x70050 = IOCTL_DISK_GET_DRIVE_LAYOUT_EX
        - number: 0x24050 = IOCTL_DISK_GET_DRIVE_GEOMETRY_EX
        - number: 0x2d1080 = IOCTL_STORAGE_GET_DEVICE_NUMBER

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-disk-information-via-ioctl.yml
----------------------------------------------
rule:
  meta:
    name: get file system information on Linux
    namespace: host-interaction/file-system
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - os: linux
      - or:
        - api: statfs
        - api: fstatfs

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-file-system-information-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get HTTP request URI
    namespace: communication/http
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    mbc:
      - Communication::HTTP Communication [C0002]
  features:
    - and:
      - api: wininet.HttpQueryInfo
      - number: 0xD = HTTP_QUERY_URI

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-http-request-uri.yml
----------------------------------------------
rule:
  meta:
    name: get inbound credentials handle via CredSSP
    namespace: data-manipulation/encryption
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea
      - https://docs.microsoft.com/en-us/windows/win32/secauthn/getting-schannel-credentials
  features:
    - and:
      - api: secur32.AcquireCredentialsHandle
      - number: 1 = SECPKG_CRED_INBOUND

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-inbound-credentials-handle-via-credssp.yml
----------------------------------------------
rule:
  meta:
    name: get MAC address on Linux
    namespace: collection/network
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/read
      - string: /\/sys\/class\/net\/\S+\/address/
        description: pseudo-file path like /sys/class/net/eth0/address

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-mac-address-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get ntoskrnl base address
    namespace: linking/runtime-linking
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Execution::Shared Modules [T1129]
    references:
      - https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b5/Source/Furutaka/sup.c#L76
      - https://www.geoffchappell.com/studies/windows/km/ntoskrnl/api/ex/sysinfo/query.htm
  features:
    - and:
      - basic block:
        - and:
          - description: returns RTL_PROCESS_MODULES structure
          - number: 0xB = SystemModuleInformation
          - match: get system information on Windows
      - and:
        - arch: i386
        - offset: 0xC = RTL_PROCESS_MODULES.Modules[0].ImageBase
      - and:
        - arch: amd64
        - offset: 0x18 = RTL_PROCESS_MODULES.Modules[0].ImageBase

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-ntoskrnl-base-address.yml
----------------------------------------------
rule:
  meta:
    name: get OS version in .NET on Android
    namespace: host-interaction/os/info
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - class: Android.OS.Build

Reason: class (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-os-version-in-dotnet-on-android.yml
----------------------------------------------
rule:
  meta:
    name: get OS version in .NET
    namespace: host-interaction/os/version
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Discovery::System Information Discovery [T1082]
  features:
    - or:
      - property/read: System.Environment::OSVersion
      - property/read: System.Environment::Is64BitOperatingSystem
      - property/read: System.OperatingSystem::Version
      - property/read: Microsoft.VisualBasic.Devices.ComputerInfo::OSFullName
      - property/read: System.Runtime.InteropServices.RuntimeInformation::OSDescription

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "property" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-os-version-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: get password database entry on Linux
    namespace: host-interaction/session
    authors:
      - michael.hunhoff@mandiant.com
      - jonathanlepore@google.com
    scopes:
      static: instruction
      dynamic: call
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: getpwuid
        - api: getpwuid_r
        - api: getpwnam
        - api: getpwnam_r
        - api: getpwent
        - api: fgetpwent
        - api: getpwent_r
        - api: fgetpwent_r

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-password-database-entry-on-linux.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: get process image filename
    namespace: host-interaction/process
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: span of calls
  features:
    - or:
      - and:
        - os: windows
        - or:
          - api: kernel32.K32GetProcessImageFileName
          - api: kernel32.GetProcessImageFileName
      - and:
        - api: System.Diagnostics.Process::GetCurrentProcess
        - property/read: System.Diagnostics.Process::MainModule
        - property/read: System.Diagnostics.ProcessModule::FileName

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-process-image-filename.yml
----------------------------------------------
rule:
  meta:
    name: get remote cert context via SChannel
    namespace: data-manipulation/encryption
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/secauthn/querycontextattributes--schannel
  features:
    - and:
      - api: secur32.QueryContextAttributes
      - number: 0x53 = SECPKG_ATTR_REMOTE_CERT_CONTEXT

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-remote-cert-context-via-schannel.yml
----------------------------------------------
rule:
  meta:
    name: get shadow password file entry on Linux
    namespace: collection
    authors:
      - jonathanlepore@google.com
    scopes:
      static: instruction
      dynamic: call
    references:
      - https://manpages.ubuntu.com/manpages/noble/man3/getspent.3.html
  features:
    - and:
      - os: linux
      - or:
        - api: getspent
        - api: getspent_r
        - api: fgetspent
        - api: fgetspent_r
        - api: getspnam
        - api: getspnam_r

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-shadow-password-file-entry-on-linux.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: get storage device properties
    namespace: host-interaction/hardware/storage
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://docs.microsoft.com/en-us/windows/win32/api/winioctl/ni-winioctl-ioctl_storage_query_property
  features:
    - and:
      - or:
        - characteristic: indirect call
        - match: interact with driver via IOCTL
      - number: 0x2D1400 = IOCTL_STORAGE_QUERY_PROPERTY
      - optional:
        - string: "\\\\.\\PhysicalDrive0"

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-storage-device-properties.yml
----------------------------------------------
rule:
  meta:
    name: get system information on Linux
    namespace: host-interaction/os/info
    authors:
      - joakim@intezer.com
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Information Discovery [T1082]
  features:
    - and:
      - os: linux
      - or:
        - api: sysconf
        - and:
          - api: system
          - string: "lshw"
        - api: sysinfo

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-system-information-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: get system property on Android
    namespace: host-interation/process
    authors:
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - os: android
      - api: __system_property_get

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-system-property-on-android.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: get token privileges
    namespace: host-interaction/session
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - or:
        - basic block:
          - and:
            - api: advapi32.GetTokenInformation
            - number: 0x3 = TokenPrivileges
        - call:
          - and:
            - api: advapi32.GetTokenInformation
            - number: 0x3 = TokenPrivileges
      - optional:
        - api: advapi32.LookupPrivilegeName

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-token-privileges.yml
----------------------------------------------
rule:
  meta:
    name: get volume information via IOCTL
    namespace: host-interaction/hardware/storage
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Discovery::System Information Discovery [T1082]
    mbc:
      - Discovery::System Information Discovery [E1082]
    references:
      - https://www.crowdstrike.com/blog/the-anatomy-of-wiper-malware-part-3/
  features:
    - and:
      - or:
        - match: interact with driver via IOCTL
        - characteristic: indirect call
      - number: 0x90064 = FSCTL_GET_NTFS_VOLUME_DATA

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/get-volume-information-via-ioctl.yml
----------------------------------------------
rule:
  meta:
    name: hash data using aphash
    namespace: data-manipulation/hashing/aphash
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Non-Cryptographic Hash [C0030]
    references:
      - https://www.partow.net/programming/hashfunctions/
  features:
    - and:
      - number: 0xaaaaaaaa
      - instruction:
        - description: hash << 7
        - mnemonic: shl
        - number: 7
      - instruction:
        - description: hash << 11
        - mnemonic: shl
        - number: 11
      - instruction:
        - description: hash >> 5
        - mnemonic: shr
        - number: 5
      - instruction:
        - description: hash >> 3
        - mnemonic: shr
        - number: 3
      - instruction:
        - description: iterator & 1
        - mnemonic: and
        - number: 1
      - characteristic: nzxor
      - characteristic: loop

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-aphash.yml
----------------------------------------------
rule:
  meta:
    name: hash data using CRC32b
    namespace: data-manipulation/checksum/crc32
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - number: 0x4C11DB7
      - characteristic: nzxor

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-crc32b.yml
----------------------------------------------
rule:
  meta:
    name: hash data using jshash
    namespace: data-manipulation/hashing/jshash
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Non-Cryptographic Hash [C0030]
    references:
      - https://www.partow.net/programming/hashfunctions/
  features:
    - and:
      - number: 0x4e67c6a7
      - instruction:
        - description: hash << 5
        - mnemonic: shl
        - number: 5
      - instruction:
        - description: hash >> 2
        - mnemonic: shr
        - number: 2
      - characteristic: nzxor
      - characteristic: loop

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-jshash.yml
----------------------------------------------
rule:
  meta:
    name: hash data using MD4
    namespace: data-manipulation/hashing/md4
    authors:
      - anamaria.martinezgom@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - number: 0x8002 = CALG_MD4
      - api: advapi32.CryptCreateHash

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-md4.yml
----------------------------------------------
rule:
  meta:
    name: hash data using murmur2
    namespace: data-manipulation/hashing/murmur
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: instruction
      dynamic: unsupported
    references:
      - https://github.com/abrandoned/murmur2/blob/master/MurmurHash2.c
  features:
    - and:
      - mnemonic: imul
      - or:
        - number: 0xc6a4a7935bd1e995 = 64-bit mixing constant m
        - number: 0x5bd1e995 = 32-bit mixing constant m

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-murmur2.yml
----------------------------------------------
rule:
  meta:
    name: hash data using RIPEMD128
    namespace: data-manipulation/hashing/ripemd128
    authors:
      - raymond.leong@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    references:
      - https://en.wikipedia.org/wiki/RIPEMD-128
  features:
    - and:
      - function:
        - and:
          - or:
            - and:
              - description: Magic initialization constants used in RIPEMD-128
              - number: 0x67452301 = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
              - number: 0xEFCDAB89 = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
              - number: 0x98BADCFE = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
              - number: 0x10325476 = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
            - bytes: 01 23 45 67 89 AB CD EF FE DC BA 98 76 54 32 10
          - not:
            - or:
              - number: 0x76543210 = RIPEMD-256 and RIPEMD-320 constant
              - number: 0xFEDCBA98 = RIPEMD-256 and RIPEMD-320 constant
              - number: 0xC3D2E1F0 = RIPEMD-160, RIPEMD-320, SHA1 constant
              - number: 0x3C2D1E0F = RIPEMD-320 constant
      - function:
        - and:
          - description: Magic K-array constants not present in MD5
          - number: 0xA953FD4E
          - number: 0x50A28BE6
          - number: 0x5C4DD124
          - number: 0x6D703EF3

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-ripemd128.yml
----------------------------------------------
rule:
  meta:
    name: hash data using RIPEMD256
    namespace: data-manipulation/hashing/ripemd256
    authors:
      - raymond.leong@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://en.wikipedia.org/wiki/RIPEMD-256
  features:
    - and:
      - or:
        - and:
          - description: Magic initialization constants used in RIPEMD-256
          - number: 0x67452301 = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
          - number: 0xEFCDAB89 = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
          - number: 0x98BADCFE = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
          - number: 0x10325476 = also used in MD5, SHA1, RIPEMD-128, RIPEMD-256, and RIPEMD-320
          - number: 0x76543210 = also used in RIPEMD-320
          - number: 0xFEDCBA98 = also used in RIPEMD-320
          - number: 0x89ABCDEF = also used in RIPEMD-320
          - number: 0x01234567 = also used in RIPEMD-320
        - bytes: 01 23 45 67 89 AB CD EF FE DC BA 98 76 54 32 10 10 32 54 76 98 BA DC FE EF CD AB 89 67 45 23 01
      - not:
        - or:
          - number: 0xC3D2E1F0 = RIPEMD-160, RIPEMD-320, SHA1 constant
          - number: 0x3C2D1E0F = RIPEMD-320 constant

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-ripemd256.yml
----------------------------------------------
rule:
  meta:
    name: hash data using rshash
    namespace: data-manipulation/hashing/rshash
    authors:
      - '@_re_fox'
    scopes:
      static: function
      dynamic: unsupported
    mbc:
      - Data::Non-Cryptographic Hash [C0030]
    references:
      - https://www.partow.net/programming/hashfunctions/
  features:
    - and:
      - number: 0x5c6b7
      - number: 0xf8c9
      - characteristic: loop

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-rshash.yml
----------------------------------------------
rule:
  meta:
    name: hash data using SHA1 via WinCrypt
    namespace: data-manipulation/hashing/sha1
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - or:
      - and:
        - match: initialize hashing via WinCrypt
        - number: 0x8004 = CALG_SHA1
        - api: advapi32.CryptHashData

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-sha1-via-wincrypt.yml
----------------------------------------------
rule:
  meta:
    name: hash data using sha1 via x86 extensions
    namespace: data-manipulation/hashing/sha1
    authors:
      - '@_re_fox'
    scopes:
      static: basic block
      dynamic: unsupported
  features:
    - or:
      - mnemonic: sha1rnds4 = Perform Four Rounds of SHA1 Operation
      - mnemonic: sha1nexte = Calculate SHA1 State Variable E after Four Rounds
      - mnemonic: sha1msg1 = Perform an Intermediate Calculation for the Next Four SHA1 Message Dwords
      - mnemonic: sha1msg2 = Perform a Final Calculation for the Next Four SHA1 Message Dwords

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "mnemonic" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-sha1-via-x86-extensions.yml
----------------------------------------------
rule:
  meta:
    name: hash data using sha256 via x86 extensions
    namespace: data-manipulation/hashing/sha256
    authors:
      - '@_re_fox'
    scopes:
      static: basic block
      dynamic: unsupported
  features:
    - or:
      - mnemonic: sha256rnds2 = Perform Two Rounds of SHA256 Operation
      - mnemonic: sha256msg1 = Perform an Intermediate Calculation for the Next Four SHA256 Message Dwords
      - mnemonic: sha256msg2 = Perform a Final Calculation for the Next Four SHA256 Message Dwords

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "mnemonic" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hash-data-using-sha256-via-x86-extensions.yml
----------------------------------------------
rule:
  meta:
    name: hook routines via dlsym RTLD_NEXT
    namespace: linking/hooking
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    references:
      - https://stackoverflow.com/questions/71695007/hook-library-function-using-custom-method-using-dlsym
      - https://liveoverflow.com/hooking-on-linux-with-ld_preload-pwn-adventure-3/
  features:
    - and:
      - api: dlsym
      - or:
        - and:
          - arch: i386
          - number: 0xFFFFFFFF = RTLD_NEXT
        - and:
          - arch: amd64
          - number: 0xFFFFFFFFFFFFFFFF = RTLD_NEXT

Reason: arch (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/hook-routines-via-dlsym-rtld_next.yml
----------------------------------------------
rule:
  meta:
    name: implement UI automation client in .NET
    namespace: host-interaction/ui/automation
    authors:
      - mehunhoff@google.com
    scopes:
      static: file
      dynamic: unsupported
    references:
      - https://learn.microsoft.com/en-us/dotnet/api/system.windows.automation?view=windowsdesktop-8.0
  features:
    - or:
      - namespace: System.Windows.Automation

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "namespace" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/implement-ui-automation-client-in-dotnet.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: inspect load icon resource
    namespace: anti-analysis
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
  features:
    # check if call to LoadIcon fails when first argument is NULL
    # and second argument is not a valid predefined icon - LoadIcon
    # should return NULL here, but some sandboxes/emulation may instead
    # return a valid handle
    - and:
      - api: user32.LoadIcon
      - number: 0x0
      - mnemonic: test
      - not:
        - or:
          - description: predefined icon identifiers
          - number: 0x7F05 = IDI_WINLOGO
          - number: 0x7F06 = IDI_SHIELD
          - number: 0x7F02 = IDI_QUESTION
          - number: 0x7F00 = IDI_APPLICATION
          - number: 0x7F04 = (IDI_ASTERISK | IDI_INFORMATION)
          - number: 0x7F01 = (IDI_ERROR | IDI_HAND)
          - number: 0x7F03 = (IDI_EXCLAMATION | IDI_WARNING)

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/inspect-load-icon-resource.yml
----------------------------------------------
rule:
  meta:
    name: interact with iptables
    namespace: host-interaction/firewall
    authors:
      - joakim@intezer.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Discovery::Software Discovery::Security Software Discovery [T1518.001]
      - Defense Evasion::Impair Defenses::Disable or Modify System Firewall [T1562.004]
  features:
    - and:
      - os: linux
      - api: system
      - substring: "iptables"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/interact-with-iptables.yml
----------------------------------------------
rule:
  meta:
    name: interact with shortcut via IWshShortcut in .NET
    namespace: host-interaction/shortcut
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: unsupported
    references:
      - https://stackoverflow.com/questions/4897655/create-a-shortcut-on-desktop
  features:
    - or:
      - class: IWshRuntimeLibrary.IWshShortcut

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "class" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/interact-with-shortcut-via-iwshshortcut-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: interact with Windows Scripting Host in .NET
    namespace: host-interaction/wsh
    authors:
      - mehunhoff@google.com
    scopes:
      static: file
      dynamic: unsupported
    references:
      - https://stackoverflow.com/questions/4897655/create-a-shortcut-on-desktop
  features:
    - or:
      - namespace: IWshRuntimeLibrary

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "namespace" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/interact-with-windows-scripting-host-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: invoke .NET assembly method
    namespace: load-code/dotnet
    authors:
      - anushka.virgaonkar@mandiant.com
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Defense Evasion::Reflective Code Loading [T1620]
  features:
    - and:
      - format: dotnet
      - optional:
        - api: System.Reflection.Module::GetMethod
        - api: System.Reflection.Module::GetMethodImpl
        - api: System.Reflection.Module::GetMethods
        - api: System.Reflection.Module::ResolveMethod
        - api: System.Type::GetMethod
        - api: System.Type::GetMethodImpl
        - api: System.Type::GetMethods
      - or:
        - api: System.Delegate::DynamicInvoke
        - api: System.Delegate::DynamicInvokeImpl
        - api: System.Type::InvokeMember
        - api: System.Reflection.MethodInfo::Invoke
        - api: System.Reflection.MethodBase::Invoke
        - api: System.Reflection.ConstructorInfo::Invoke

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/invoke-dotnet-assembly-method.yml
----------------------------------------------
rule:
  meta:
    name: link function at runtime on Linux
    namespace: linking/runtime-linking
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Execution::Shared Modules [T1129]
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: dlsym
        - api: dlvsym

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/link-function-at-runtime-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: linked against Go static asset library
    namespace: executable/resource
    authors:
      - joakim@intezer.com
    description: Detects if the Go file includes an static assets.
    scopes:
      static: file
      dynamic: file
    references:
      - https://github.com/rakyll/statik
      - https://github.com/gobuffalo/packr
      - https://github.com/gobuffalo/packr
      - https://github.com/GeertJohan/go.rice
      - https://github.com/kevinburke/go-bindata
      - https://github.com/lu4p/binclude
      - https://github.com/lu4p/binclude
      - https://github.com/omeid/go-resources
      - https://github.com/pyros2097/go-embed
  features:
    - and:
      - match: compiled with Go
      - or:
        - or:
          - string: "github.com/rakyll/statik/fs.IsDefaultNamespace"
          - string: "github.com/rakyll/statik/fs.RegisterWithNamespace"
          - string: "github.com/rakyll/statik/fs.NewWithNamespace"
          - string: "github.com/rakyll/statik/fs.Register"
        - and:
          - string: "github.com/gobuffalo/packr.NewBox"
        - or:
          - string: "github.com/markbates/pkger.Open"
          - string: "github.com/markbates/pkger.Include"
          - string: "github.com/markbates/pkger.Parse"
        - or:
          - string: "github.com/GeertJohan/go.rice.FindBox"
          - string: "github.com/GeertJohan/go.rice.MustFindBox"
        - and:
          - substring: "/bindata.go"
            description: go-bindata
          - substring: ".Asset"
        - and:
          - string: "github.com/lu4p/binclude.Include"
        - and:
          - string: "github.com/omeid/go-resources"
        - and:
          - string: "github.com/pyros2097/go-embed"

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/linked-against-go-static-asset-library.yml
----------------------------------------------
rule:
  meta:
    name: linked against hp-socket
    namespace: linking/static/hp-socket
    authors:
      - still@teamt5.org
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Command and Control::Non-Application Layer Protocol [T1095]
    references:
      - https://github.com/ldcsaa/HP-Socket/
    examples:
      - 4c46fdafceba8e450deb93cdb82a177e
  features:
    - or:
      - substring: "HP-Socket for Linux v%d.%d.%d [BN:%02d]"
      - 3 or more:
        - substring: "global/helper.cpp"
        - substring: "src/HttpServer.cpp"
        - substring: "src/TcpServer.cpp"
        - substring: "src/common/IODispatcher.cpp"
        - substring: "src/common/Thread.cpp"
        - substring: "/HP-Socket/Linux/"
      # in theory the following should be present for Windows version; untested
      - 3 or more:
        - substring: "Client Send Fail [SOCK: %d, SEQ: %d]"
        - substring: "(%Iu) Send OK -->"
        - substring: "<%s#%d> OP: %d, CODE: %d (DATA: 0x%X, LEN: %d>"
        - substring: "---------------> Client Worker Thread 0x%08X stoped <---------------"
        - substring: "<C-CNNID: %Iu> OnSend() event should not return 'HR_ERROR' !!"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "Some" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/linked-against-hp-socket.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: list drag and drop files
    namespace: host-interaction/clipboard
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Collection::Clipboard Data [T1115]
  features:
    - and:
      - api: shell32.DragQueryFile
      - and:
        - api: user32.GetClipboardData
        - number: 0xF = HDROP

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/list-drag-and-drop-files.yml
----------------------------------------------
rule:
  meta:
    name: load packed DEX via Jiagu on Android
    namespace: anti-analysis
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://github.com/Frezrik/Jiagu
  features:
    - and:
      - os: android
      - string: "NDK_JIAGU"
      - string: "[-]get %s handle failed:%s"
      - string: "[-]ANONYMOUS mmap failed:%s"
      - string: "[-]g_sdk_int Update cookie failed"
      - string: "dalvik/system/InMemoryDexClassLoader"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/load-packed-dex-via-jiagu-on-android.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: log keystrokes via raw input data
    namespace: collection/keylog
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Collection::Input Capture::Keylogging [T1056.001]
  features:
    - and:
      - basic block:
        - description: get raw input
        - and:
          - api: user32.GetRawInputData
          - number: 0x10000003 = RID_INPUT
          - number: 0x10 = sizeof(RAWINPUTHEADER)
      - instruction:
        - description: check raw data is keyboard keydown
        - mnemonic: cmp
        - offset: 0x18 = RAWINPUT->data.Message
        - number: 0x100 = WM_KEYDOWN
      - instruction:
        - description: check raw data is keyboard
        - mnemonic: cmp
        - offset: 0x0 = RAWINPUT->header.dwType
        - number: 0x1 = RIM_TYPEKEYBOARD
      - optional:
        - offset: 0x16 = RAWINPUT->data.VKey

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/log-keystrokes-via-raw-input-data.yml
----------------------------------------------
rule:
  meta:
    name: manipulate unmanaged memory in .NET
    namespace: host-interaction/memory
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - or:
      - class: System.Runtime.InteropServices.Marshal

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "class" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/manipulate-unmanaged-memory-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: map or unmap memory on Linux
    namespace: host-interaction/memory
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: call
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: mmap
        - api: munmap

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/map-or-unmap-memory-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: mark thread detached on Linux
    namespace: host-interaction/thread
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - os: linux
      - api: pthread_detach

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/mark-thread-detached-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: mixed mode
    namespace: runtime
    authors:
      - michael.hunhoff@mandiant.com
    description: file contains managed and unmanaged (native) code, often seen in .NET
    scopes:
      static: file
      dynamic: unsupported
  features:
    - or:
      - characteristic: mixed mode

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "characteristic" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/mixed-mode.yml
----------------------------------------------
rule:
  meta:
    name: modify API blacklist or denylist via JNI on Android
    namespace: host-interaction/bypass
    authors:
      - mehunhoff@google.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - os: android
      - string: "com/android/internal/os/ZygoteInit"
      - or:
        - string: "setApiBlacklistExemptions"
        - string: "setApiDenylistExemptions"
      - string: "java/lang/String"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/modify-api-blacklist-or-denylist-via-jni-on-android.yml
----------------------------------------------
rule:
  meta:
    name: obfuscated with KoiVM
    namespace: anti-analysis/obfuscation
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Obfuscated Files or Information [T1027]
    mbc:
      - Anti-Static Analysis::Executable Code Obfuscation [B0032]
  features:
    - or:
      - namespace: KoiVM.Runtime
      - class: KoiVM.Runtime.VMEntry

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "class" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/obfuscated-with-koivm.yml
----------------------------------------------
rule:
  meta:
    name: packaged as a NSIS installer
    namespace: executable/installer/nsis
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: file
      dynamic: file
    references:
      - https://nsis.sourceforge.io/Main_Page
  features:
    - or:
      - substring: "http://nsis.sf.net"

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "substring" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/packaged-as-a-nsis-installer.yml
----------------------------------------------
rule:
  meta:
    name: persist via BITS job
    namespace: persistence
    authors:
      - j.j.vannielen@utwente.nl
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Persistence::BITS Jobs [T1197]
    references:
      - https://cloud.google.com/blog/topics/threat-intelligence/attacker-use-of-windows-background-intelligent-transfer-service/
  features:
    - and:
      - match: host-interaction/process/create
      - or:
        - and:
          - string: /bitsadmin(|\.exe) /i
          - string: /\/SetNotifyCmdLine/i
        - and:
          - or:
            - string: /Set-BitsTransfer /i
            - string: /Start-BitsTransfer /i
          - string: / -NotifyCmdLine /i

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/persist-via-bits-job.yml
----------------------------------------------
rule:
  meta:
    name: persist via GNOME autostart on Linux
    namespace: persistence
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/write
      - substring: "X-GNOME-Autostart-enabled=true"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/persist-via-gnome-autostart-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: power down monitor
    namespace: host-interaction/hardware/monitor
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - api: user32.SendMessage
      - number: 0x112 = WM_SYSCOMMAND
      - number: 0xF170 = SC_MONITORPOWER
      - number: 2 = the display is being shut off

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/power-down-monitor.yml
----------------------------------------------
rule:
  meta:
    name: read and send data from client to server
    namespace: communication/c2/file-transfer
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - match: host-interaction/file-system/read
      - match: send data

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/read-and-send-data-from-client-to-server.yml
----------------------------------------------
rule:
  meta:
    name: receive and write data from server to client
    namespace: communication/c2/file-transfer
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
  features:
    - and:
      - match: receive data
      - match: host-interaction/file-system/write

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/receive-and-write-data-from-server-to-client.yml
----------------------------------------------
rule:
  meta:
    name: reference processor manufacturer constants
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection::Instruction Testing - CPUID [B0009.034]
    references:
      - https://en.wikipedia.org/wiki/CPUID
  features:
    - and:
      - mnemonic: cmp
      - or:
        - number: 0x61774D56 = 'awMV' (VMware)
        - number: 0x566E6558 = 'VneX' (Xen HVM)
        - number: 0x7263694D = 'rciM' (Microsoft Hyper-V)
        - number: 0x4B4D564B = 'KMVK' (KVM)
        - number: 0x70726C20 = 'prl ' (Parallels)
        - number: 0x786F4256 = 'xoBV' (VirtualBox)
      - optional:
        - mnemonic: cpuid

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/reference-processor-manufacturer-constants.yml
----------------------------------------------
rule:
  meta:
    name: reference the VMWare IO port
    namespace: anti-analysis/anti-vm/vm-detection
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
    mbc:
      - Anti-Behavioral Analysis::Virtual Machine Detection::Unique Hardware/Firmware Check - I/O Communication Port [B0009.025]
  features:
    - and:
      - mnemonic: in
      - number: 0x564D5868 = VMXh
      - number: 0x5658 = VX

Reason: mnemonic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/reference-the-vmware-io-port.yml
----------------------------------------------
# generated using capa explorer for IDA Pro
rule:
  meta:
    name: resize volume shadow copy storage
    namespace: impact/inhibit-system-recovery
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - or:
        - match: interact with driver via IOCTL
        - characteristic: indirect call
      - number: 0x53C028 = IOCTL_VOLSNAP_SET_MAX_DIFF_AREA_SIZE

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/resize-volume-shadow-copy-storage.yml
----------------------------------------------
rule:
  meta:
    name: schedule task via ITaskService
    namespace: persistence/scheduled-tasks
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Persistence::Scheduled Task/Job::Scheduled Task [T1053.005]
  features:
    - and:
      - basic block:
        - and:
          - api: ole32.CoCreateInstance
          - bytes: 9F 36 87 0F E5 A4 FC 4C BD 3E 73 E6 15 45 72 DD = CLSID_TaskScheduler
          - bytes: C7 A4 AB 2F A9 4D 13 40 96 97 20 CC 3F D4 0F 85 = IID_ITaskService
      - offset: 0x24 = ppv->NewTask

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/schedule-task-via-itaskservice.yml
----------------------------------------------
rule:
  meta:
    name: search for credit card data
    namespace: collection/credit-card
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - instruction:
        - mnemonic: cmp
        - number: 0x5E = '^' (Track 1 separator)
      - instruction:
        - mnemonic: cmp
        - number: 0x3D = '=' (Track 2 separator)
      - instruction:
        - mnemonic: cmp
        # seen in 518185ED134F93DF708590E74473DA8E and 05B2D1AF23CF96E295BBBFC6CDC76E1F
        - number: 0x44 = 'D' (Unknown separator)
      - match: read process memory

Reason: Depending on myself = basic block (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/search-for-credit-card-data.yml
----------------------------------------------
rule:
  meta:
    name: send SMS on Android
    namespace: communication/sms
    authors:
      - '@mr-tz'
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - os: android
      # ... = (*env)->FindClass(env, "android/telephony/SmsManager");
      - string: "android/telephony/SmsManager"
      - optional:
        - or:
          - and:
            - arch: i386
            - offset: 0x30 = (*env)->FindClass
          - and:
            - arch: amd64
            - offset: 0x1C = (*env)->FindClass
      # ... = (*env)->GetMethodID(env, ..., "sendTextMessage" ...);
      - string: "sendTextMessage"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/send-sms-on-android.yml
----------------------------------------------
rule:
  meta:
    name: set global application hook
    namespace: host-interaction/gui
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - api: user32.SetWindowsHookEx
      - number: 0x3 = WM_GETMESSAGE
      - number: 0x0 = dwThreadId

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/set-global-application-hook.yml
----------------------------------------------
rule:
  meta:
    name: set HTTP User-Agent in .NET
    namespace: communication/http
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - or:
      - property/write: System.Net.HttpWebRequest::UserAgent

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "property" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/set-http-user-agent-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: set shadow password file entry on Linux
    namespace: host-interaction/file-system/write
    authors:
      - jonathanlepore@google.com
    scopes:
      static: instruction
      dynamic: call
    references:
      - https://manpages.ubuntu.com/manpages/noble/man3/putspent.3.html
  features:
    - and:
      - os: linux
      - or:
        - api: putspent

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/set-shadow-password-file-entry-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: set thread name on Linux
    namespace: host-interaction/thread
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: basic block
      dynamic: span of calls
  features:
    - and:
      - or:
        - os: linux
        - os: android
      - or:
        - api: pthread_setname_np
        - and:
          - api: prctl
          - number: 0xF = PR_SET_NAME

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/set-thread-name-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: set web proxy in .NET
    namespace: communication/http
    authors:
      - michael.hunhoff@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - property/write: System.Net.WebRequest::Proxy
      - optional:
        - api: System.Net.WebProxy::ctor

Reason: property (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/set-web-proxy-in-dotnet.yml
----------------------------------------------
rule:
  meta:
    name: terminate process by name
    namespace: host-interaction/process/terminate
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
  features:
    - and:
      - match: terminate process
      - match: enumerate processes
      - or:
        - offset: 0x24 = pe.szExeFile (x32)

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/terminate-process-by-name.yml
----------------------------------------------
rule:
  meta:
    name: truncate file on Linux
    namespace: host-interaction/file-system/truncate
    authors:
      - mehunhoff@google.com
    scopes:
      static: basic block
      dynamic: call
  features:
    - and:
      - or:
        - os: android
        - os: linux
      - api: ftruncate

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/truncate-file-on-linux.yml
----------------------------------------------
rule:
  meta:
    name: unmount volume via IOCTL
    namespace: host-interaction/hardware/storage
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    references:
      - https://www.crowdstrike.com/blog/the-anatomy-of-wiper-malware-part-3/
  features:
    - and:
      - or:
        - match: interact with driver via IOCTL
        - characteristic: indirect call
      - and:
        - number: 0x90018 = FSCTL_LOCK_VOLUME
        - number: 0x90020 = FSCTL_DISMOUNT_VOLUME

Reason: characteristic (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/unmount-volume-via-ioctl.yml
----------------------------------------------
rule:
  meta:
    name: use .NET library SimpleJSON
    namespace: data-manipulation/json
    authors:
      - mehunhoff@google.com
    scopes:
      static: file
      dynamic: unsupported
    references:
      - https://github.com/mhallin/SimpleJSON.NET
  features:
    - or:
      - class: Json.SimpleJson

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "class" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/use-dotnet-library-simplejson.yml
----------------------------------------------
rule:
  meta:
    name: use .NET library websocket-sharp
    namespace: communication/websocket
    authors:
      - mehunhoff@google.com
    scopes:
      static: file
      dynamic: unsupported
    references:
      - https://github.com/sta/websocket-sharp
  features:
    - or:
      - namespace: WebSocketSharp

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "namespace" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/nursery/use-dotnet-library-websocket-sharp.yml
----------------------------------------------
rule:
  meta:
    name: create shortcut via IShellLink
    namespace: persistence
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Persistence::Boot or Logon Autostart Execution::Shortcut Modification [T1547.009]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/shell/links#creating-a-shortcut-and-a-folder-shortcut-to-a-file
    examples:
      - 7f403f7d643d90c7cbadf3ccfc68bd1badf06f89a35af5fc7811920e820bbcc9:0x10001380
    capa/nursery: false
  features:
    - and:
      - bytes: 01 14 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 = CLSID_ShellLink
      - or:
        - bytes: EE 14 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 = IID_IShellLinkA
        - bytes: F9 14 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 = IID_IShellLinkW
      - bytes: 0B 01 00 00 00 00 00 00 C0 00 00 00 00 00 00 46 = IID_IPersistFile
      - offset: 0x50 = psl->SetPath
      - offset: 0x18 = ppf->Save
      - api: ole32.CoCreateInstance

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/create-shortcut-via-ishelllink.yml
----------------------------------------------
rule:
  meta:
    name: persist via .desktop autostart
    namespace: persistence
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Boot or Logon Autostart Execution::XDG Autostart Entries [T1547.013]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x407D11
    capa/nursery: false
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/write
      - or:
        - string: /\/\.config\/autostart\/.+\.desktop/
        - substring: "/etc/xdg/autostart"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/persist-via-desktop-autostart.yml
----------------------------------------------
rule:
  meta:
    name: persist via shell profile or rc file
    namespace: persistence
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Event Triggered Execution::Unix Shell Configuration Modification [T1546.004]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x407D11
    capa/nursery: false
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/write
      - or:
        - substring: "/.bash_profile"
        - substring: "/.bash_login"
        - substring: "/.bashrc"
        - substring: "/.profile"
        - substring: "/etc/profile.d/"
        - string: "/etc/profile"

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/persist-via-shell-profile-or-rc-file.yml
----------------------------------------------
rule:
  meta:
    name: act as Exchange transport agent
    namespace: persistence/exchange
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Server Software Component::Transport Agent [T1505.002]
    references:
      - https://learn.microsoft.com/en-us/exchange/mail-flow/transport-agents/transport-agents?view=exchserver-2019
      - https://learn.microsoft.com/en-us/exchange/client-developer/transport-agents/how-to-create-a-deliveryagent-transport-agent-for-exchange-2013
    examples:
      - a301eadd2b665b696803e143dd4d657d71c56bbded2a3a1b96c5bcb83cc6796a:0x600000E
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - or:
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnConnectEvent
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnHeloCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnEhloCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnStartTlsCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnAuthCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnProcessAuthentication
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnEndOfAuthentication
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnXSessionParamsCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnMailCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnRcptToCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnDataCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnEndOfHeaders
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnProxyInboundMessage
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnEndOfData
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnHelpCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnNoopCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnReject
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnRsetCommand
        - api: Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent::add_OnDisconnectEvent
        - api: Microsoft.Exchange.Data.Transport.Routing.RoutingAgent::add_OnSubmittedMessage
        - api: Microsoft.Exchange.Data.Transport.Routing.RoutingAgent::add_OnResolvedMessage
        - api: Microsoft.Exchange.Data.Transport.Routing.RoutingAgent::add_OnRoutedMessage
        - api: Microsoft.Exchange.Data.Transport.Routing.RoutingAgent::add_OnCategorizedMessage
        - api: Microsoft.Exchange.Data.Transport.Delivery.DeliveryAgent::add_OnCloseConnection
        - api: Microsoft.Exchange.Data.Transport.Delivery.DeliveryAgent::add_OnDeliverMailItem
        - api: Microsoft.Exchange.Data.Transport.Delivery.DeliveryAgent::add_OnOpenConnection

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/exchange/act-as-exchange-transport-agent.yml
----------------------------------------------
rule:
  meta:
    name: persist via IIS module
    namespace: persistence
    authors:
      - william.ballenthin@mandiant.com
    description: IIS 7.0 introduced modules that provide the same unrestricted access to HTTP requests and responses as ISAPI extensions and filters.
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Persistence::Server Software Component::IIS Components [T1505.004]
    examples:
      - 22d0a2e4c9c2163b2bf5f0e41a2e1762
    capa/nursery: false
  features:
    - and:
      - os: windows
      - export: RegisterModule
      - substring: "CHttpModule"
        description: C++ super class provided by Microsoft

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/iis/persist-via-iis-module.yml
----------------------------------------------
rule:
  meta:
    name: persist via ISAPI extension
    namespace: persistence
    authors:
      - william.ballenthin@mandiant.com
    description: Internet Server Application Programming Interface (ISAPI) extensions and filters can be installed to examine and/or modify incoming and outgoing IIS web requests.
    scopes:
      static: file
      dynamic: file
    att&ck:
      - Persistence::Server Software Component::IIS Components [T1505.004]
    examples:
      - 22d0a2e4c9c2163b2bf5f0e41a2e1762
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - export: GetExtensionVersion
        - export: GetFilterVersion
        - export: HttpExtensionProc
        - export: HttpFilterProc
        - export: TerminateExtension
        - export: TerminateFilter

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/iis/persist-via-isapi-extension.yml
----------------------------------------------
rule:
  meta:
    name: act as Office COM add-in
    namespace: persistence/office
    authors:
      - jakub.jozwiak@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    att&ck:
      - Persistence::Office Application Startup::Add-ins [T1137.006]
    references:
      - https://labs.withsecure.com/publications/add-in-opportunities-for-office-persistence
      - https://learn.microsoft.com/en-us/dotnet/api/extensibility.idtextensibility2?view=visualstudiosdk-2022
    examples:
      - 0831bb382211a67c57a392955138808526aa15e55531091841706aae2cb89613
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - class: Extensibility.IDTExtensibility2
      - or:
        - string: "OnAddInsUpdate"
        - string: "OnBeginShutdown"
        - string: "OnConnection"
        - string: "OnDisconnection"
        - string: "OnStartupComplete"

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/office/act-as-office-com-add-in.yml
----------------------------------------------
rule:
  meta:
    name: disable AppInit_DLLs code signature enforcement
    namespace: persistence/registry/appinitdlls
    authors:
      - william.ballenthin@fireye.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Event Triggered Execution::AppInit DLLs [T1546.010]
      - Defense Evasion::Subvert Trust Controls::Code Signing Policy Modification [T1553.006]
    references:
      - https://docs.microsoft.com/en-us/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2
    examples:
      - 58ADC2E97FBEE01B71073CCD7FF1B9A4:0x401350
    capa/nursery: false
  features:
    - and:
      - string: /RequireSignedAppInit_DLLs/i
        description: disable DLL code signature enforcement
      - number: 0 = state disabled
      - or:
        - match: set registry value
        - number: 0x80000002 = HKEY_LOCAL_MACHINE
      - or:
        - string: /Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows/i
        - string: /Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows/i

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/registry/appinitdlls/disable-appinit_dlls-code-signature-enforcement.yml
----------------------------------------------
rule:
  meta:
    name: schedule task via at
    namespace: persistence/scheduled-tasks
    authors:
      - joren485
    scopes:
      static: function
      dynamic: call
    att&ck:
      - Persistence::Scheduled Task/Job::At [T1053.002]
    examples:
      - 0ce3bfa972ced61884ae7c1d77c7d4c45e17c7d767e669610cf2ef72b636b464:0x4051AF
    capa/nursery: false
  features:
    - and:
      - match: host-interaction/process/create
      - string: /at(|\.exe)/i
      - or:
        - string: "//every:/i"
        - string: "//next:/i"
        - string: "/\\d:\\d/i"

Reason: needed sub-rule not converted (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/scheduled-tasks/schedule-task-via-at.yml
----------------------------------------------
rule:
  meta:
    name: schedule task via ITaskScheduler
    namespace: persistence/scheduled-tasks
    authors:
      - moritz.raabe@mandiant.com
    scopes:
      static: function
      dynamic: unsupported
    att&ck:
      - Persistence::Scheduled Task/Job::Scheduled Task [T1053.005]
    examples:
      - 2B8BEC5BCB1777EAA155D832F7AFC797:0x405887
    capa/nursery: false
  features:
    - and:
      - api: ole32.CoCreateInstance
      - bytes: 2A D5 8B 14 AB A2 CE 11 B1 1F 00 AA 00 53 05 03 = CLSID_CTaskScheduler
      - bytes: 27 D5 8B 14 AB A2 CE 11 B1 1F 00 AA 00 53 05 03 = IID_ITaskScheduler
      - or:
        - offset: 0x20 = pts->NewWorkItem
        - offset: 0x24 = pts->AddWorkItem

Reason: offset (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/scheduled-tasks/schedule-task-via-itaskscheduler.yml
----------------------------------------------
rule:
  meta:
    name: persist via rc script
    namespace: persistence/service
    authors:
      - joakim@intezer.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Boot or Logon Initialization Scripts::RC Scripts [T1037.004]
    examples:
      - 7351f8a40c5450557b24622417fc478d:0x407D11
    capa/nursery: false
  features:
    - and:
      - os: linux
      - match: host-interaction/file-system/write
      - or:
        - substring: "/etc/init.d/"
        - string: /\/etc\/rc[0-9].d\//

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/service/persist-via-rc-script.yml
----------------------------------------------
rule:
  meta:
    name: get startup folder
    namespace: persistence/startup-folder
    authors:
      - matthew.williams@mandiant.com
    scopes:
      static: basic block
      dynamic: call
    att&ck:
      - Persistence::Boot or Logon Autostart Execution::Registry Run Keys / Startup Folder [T1547.001]
    examples:
      - 07F7846BBCDA782E5639292AD93907EB:0x40121A
    capa/nursery: false
  features:
    - and:
      - or:
        - number: 0x07 = CSIDL_STARTUP
        - number: 0x18 = CSIDL_COMMON_STARTUP
      - or:
        - api: shell32.SHGetFolderPath
        - api: shell32.SHGetFolderLocation
        - api: shell32.SHGetSpecialFolderPath
        - api: shell32.SHGetSpecialFolderLocation

Reason: Number too short (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/startup-folder/get-startup-folder.yml
----------------------------------------------
rule:
  meta:
    name: write file to startup folder
    namespace: persistence/startup-folder
    authors:
      - matthew.williams@mandiant.com
      - j.j.vannielen@utwente.nl
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Persistence::Boot or Logon Autostart Execution::Registry Run Keys / Startup Folder [T1547.001]
    examples:
      - 07F7846BBCDA782E5639292AD93907EB:0x401040
    capa/nursery: false
  features:
    - or:
      - and:
        - match: get startup folder
        - or:
          - match: copy file
          - match: move file
          - match: write file on Windows
      - call:
        - and:
          - string: /Start Menu\\Programs\\Startup/i
          - or:
            - match: copy file
            - match: move file
            - match: write file on Windows

Reason: Multiple statements inside "- or:" where all unsupported, the last one was "And" (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/persistence/startup-folder/write-file-to-startup-folder.yml
----------------------------------------------
rule:
  meta:
    name: compiled with .NET AoT
    namespace: runtime/dotnet
    authors:
      - still@teamt5.org
    description: compiled using .NET Ahead-of-Time (AoT) compilation
    scopes:
      static: file
      dynamic: file
    references:
      - https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/
    examples:
      - 684cc28e6a7fbd12f23dbc563f06306555ebb870bd727ad60839d4ff26e7f3b2
    capa/nursery: false
  features:
    - and:
      - substring: ".NETCoreApp,Version="
      - 2 or more:
        - substring: "AotAnalysis4IL"
        - substring: "https://aka.ms/nativeaot-compatibilit"
        - substring: "removed by the AOT compiler"
        - substring: "\\native\\"
          description: During compilation, the output by default contains the path "native," which is then in turn included in the PDB path.

Reason: substring (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/runtime/dotnet/compiled-with-dotnet-aot.yml
----------------------------------------------
rule:
  meta:
    name: execute via .NET startup hook
    namespace: runtime/dotnet
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: file
      dynamic: unsupported
    references:
      - https://rastamouse.me/net-startup-hooks/
      - https://github.com/dotnet/runtime/blob/main/docs/design/features/host-startup-hook.md
    examples:
      - 1ee70f829fa4f21b97fea53412383b4c83be1aaf8bab2f4b692549f8ceb4388f
    capa/nursery: false
  features:
    - and:
      - format: dotnet
      - function-name: "StartupHook::Initialize"

Reason: format (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/runtime/dotnet/execute-via-dotnet-startup-hook.yml
----------------------------------------------
rule:
  meta:
    name: identify system language via API
    namespace: targeting/language
    authors:
      - william.ballenthin@mandiant.com
    scopes:
      static: function
      dynamic: span of calls
    att&ck:
      - Discovery::System Location Discovery::System Language Discovery [T1614.001]
    examples:
      - 9b7ccaa2ae6a5b96e3110ebcbc4311f6:0x10001F96
    capa/nursery: false
  features:
    - and:
      - os: windows
      - or:
        - api: GetUserDefaultUILanguage
        - api: GetSystemDefaultUILanguage
        - api: GetUserDefaultLangID

Reason: os (there might be multiple unsupported things in this rule, this is the 1st one encountered)
https://github.com/mandiant/capa-rules/blob/master/E:/PROGRAMMING/Github/capa/capa/tests/rules/targeting/language/identify-system-language-via-api.yml
----------------------------------------------
